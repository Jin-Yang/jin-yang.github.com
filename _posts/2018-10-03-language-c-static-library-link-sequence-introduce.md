---
title: C 静态链接顺序
layout: post
comments: true
language: chinese
category: [program]
keywords: c,static
description: C 语言的静态库实际上就是将编译得到的目标文件 `.o`，打包在一起，并修改目标文件中函数调用地址偏移量。 当一个项目中有多个静态库时，就可能会由于链接顺序不同导致 `undefined reference` 的报错。 这里简单介绍其原因，解决方法，以及最佳实践。
---

C 语言的静态库实际上就是将编译得到的目标文件 `.o`，打包在一起，并修改目标文件中函数调用地址偏移量。

当一个项目中有多个静态库时，就可能会由于链接顺序不同导致 `undefined reference` 的报错。

这里简单介绍其原因，解决方法，以及最佳实践。

<!-- more -->

## 算法

链接器在查找符号时，针对的是单个目标文件 `.o` ，而非整个静态库。也就是说，如果在某个目标文件中找到了所需的符号，那么就会将整个目标文件单独从静态库中提取出来，而非将整个链接库添加。

链接器在工作过程中，维护 3 个列表：A) 需要参与连接的目标文件列表 E；B) 一个未解析符号列表 U；C) 一个在 E 中所有目标文件定义过的所有符号列表 D 。

<!--
在项目开发过层中尽量让lib是垂直关系，避免循环依赖；越是底层的库，越是往后面写！

静态库的链接问题
https://segmentfault.com/a/1190000006911973
-->


{% highlight text %}
{% endhighlight %}
