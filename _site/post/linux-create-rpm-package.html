<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <meta name="baidu-site-verification" content="B786jeR0MV" />
  <meta name="msvalidate.01" content="29F791E7F785800340E37AD7C714D2A7" />
  <meta name="google-site-verification" content="p7jJ5d3kF9yxRhpIo5GgHXAZ1ATKVyZhV2kf6mEGOv0" />
  <title>RPM 包制作|JinYang's Blog</title>
  <meta name="keywords" content="linux,rpm,制作">
  <meta name="description" content="RPM Package Manager 简称 RPM，这一文件格式在历史名称上虽然打着 RedHat 标志，但其原始设计理念是开放式的，现在包括 OpenLinux、SuSE、Turbo Linux 等多个 Linux 分发版本都有采用，可以算是公认的行业标准了。在此介绍下如何制作 RPM 包，尤其是如何写 .spec 配置文件，以及常见的技巧。">

  <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">
  !window.jQuery && document.write('<script src="/static/js/jquery.min.js"><\/script>');
  </script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  !$('body').popover && document.write('<script src="/static/js/bootstrap.min.js"><\/script>');
  </script>
  <script type="text/javascript" src="/static/js/main.js"></script>
  <!-- <link rel="stylesheet prefetch" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/bootstrap.min.css">
  <!-- <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/font-awesome.min.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/pygments.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/screen.css">
  <style type="text/css">
  
    .post-container > p {text-indent: 2em;}
  
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124556620-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124556620-1');
</script>

</head>

<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top navbar-wrapper">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/">Jin-Yang</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li  ><a href="/"> Home </a></li>
        <li  ><a href="/archives.html"> Archive </a></li>
        <li  ><a href="/categories.html"> Categories </a></li>
        <li  ><a href="/projects.html"> Projects </a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Others <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">常用网站</li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.rtems.org/">www.rtems.org</a></li>
            <li><a href="http://www.gnu.org/">www.gnu.org</a></li>
            <li><a href="https://www.kernel.org/">www.kernel.org</a></li>
            <li><a href="https://www.arduino.cc/">www.arduino.cc</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li  ><a href="/about.html"> About </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
    <li data-target="#myCarousel" data-slide-to="4"></li>
  </ol>
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>KISS</h1>
          <h2>Keep It Simple and Stupid.</h2>
          <!--<a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a>-->
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Seize The Day</h1><h1>And Get Busy Living</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Stay hungry</h1><h1>Stay foolish</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
	  <h2>Ever tried, ever failed</h2><h2>No matter, try again</h2><h2>Fail again, fail better</h2>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Nothing is true</h1><h1>Every is permitted</h1>
        </div>
      </div>
    </div>
  </div>
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div><!-- /.carousel -->

<div class="container">
  <div class="row">
    <div class="col-lg-9 blog-main" style="min-width: 500px">
    
<div class="post-container">
  <div class="blog-header">
    <h1>RPM 包制作</h1>
    <div class="post-description">
      <i class="fa fa-calendar"></i> 2015-10-21 Wednesday &nbsp; &nbsp;
      <i class="fa fa-tags"></i>  linux ,  misc  
      
    </div>
  </div>
  <hr>
  <p>RPM Package Manager 简称 RPM，这一文件格式在历史名称上虽然打着 RedHat 标志，但其原始设计理念是开放式的，现在包括 OpenLinux、SuSE、Turbo Linux 等多个 Linux 分发版本都有采用，可以算是公认的行业标准了。</p>

<p>在此介绍下如何制作 RPM 包，尤其是如何写 .spec 配置文件，以及常见的技巧。</p>

<!-- more -->

<h2 id="简介">简介</h2>

<p>若要构建一个标准的 RPM 包，需要创建 .spec 文件，其中包含软件打包的全部信息。然后，使用 rpmbuild 命令，按照 spec 文件的配置，系统会按照步骤生成最终的 RPM 包。</p>

<p>另外，需要注意的是，在使用时，需要使用普通用户，一定不要用 root 用户。</p>

<p>结下来，看看如何编译制作 RPM 包。</p>

<h2 id="环境配置">环境配置</h2>

<p>接下来，看看如何配置一步步制作 RPM 包。</p>

<h3 id="安装工具">安装工具</h3>

<p>首先，在 CentOS 中配置环境。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 安装环境，需要rpm-build工具来打包，该包只依赖于gdb以及rpm版本
# yum install rpm-build -y

----- 新建所需目录
$ mkdir -pv ~/rpm-maker/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}</code></pre></figure>

<h3 id="配置环境">配置环境</h3>

<p>打包相关的配置保存在宏文件 (macrofiles) 中，默认使用 <code>$HOME/rpmbuild</code> 目录，用户配置文件保存在 <code>$HOME/.rpmmacros</code>；而制作包时的操作实际都在 topdir 指定的目录下，可以通过如下方式查看。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">--- 查看所有的配置文件顺序
$ rpmbuild --showrc | grep macros

--- 确认上述的根工作目录，两种方式相同
$ rpmbuild --showrc | grep &#39;: _topdir&#39;
$ rpm --eval &#39;%_topdir&#39;

--- 设置topdir变量，然后再次验证下，确认已经修改为目标目录
$ echo &quot;%_topdir %{getenv:HOME}/rpm-maker&quot; &gt; ~/.rpmmacros
$ rpm --eval &#39;%_topdir&#39;
--- 也可以在制作rpm包时通过--define指定
$ rpmbuild --define &#39;_topdir rpm-maker&#39; -ba package.spec</code></pre></figure>

<p>下载 MySQL 的源码，并保存在 SPECS 目录下，整体目录结构如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ tree ~/rpm-maker
.
|-- BUILD                      ← 解压后的tar.gz包
|-- BUILDROOT                  ← 临时安装目录，会打包该目录下文件
|-- RPMS                       ← 编译后的RPM包
|-- SOURCES                    ← 所需的文件
|   `-- mysql-xxx.tar.gz       ← 包括了源码包
|-- SPECS                      ← *.spec编译脚本
|   |-- mysql-xxx.spec
|   `-- mysql-yyy.spec
`-- SRPMS                      ← src格式的rpm包存放的位置</code></pre></figure>

<h3 id="执行命令">执行命令</h3>

<p>接下来，看看如何生成 rpm 包，也就是使用 rpmbuild 命令，过程可以分为多个阶段。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ rpmbuild --bb mysql.spec   

使用参数：
   -bb 制作成二进制RPM包
   -bs 制作源码的RPM包
   -ba 源码和二进制两种形式的RPM包
   -bl 检测BUILDROOT没有包含到rpm包中的文件

   -bp 执行到pre
   -bc 执行到build段
   -bi 执行install段

   --quiet 默认会输出每次执行的shell命令，此时忽略

----- 通过源码包重新编译
$ rpmbuild --rebuild package-0.0-0.src.rpm

----- 编译时指定参数
$ rpmbuild -bb SPECS/librdkafka.spec --define &quot;__version 0.9.4&quot; --define &quot;__release 1&quot;</code></pre></figure>

<p>一般来说，执行的顺序为 <code>rpmbuild -bp</code>，再 <code>-bc</code> 再 <code>-bi</code>，如果没问题，<code>rpmbuild -ba</code> 生成 src 包与二进制包，使用时通过 <code>rpm -ivh xxx.rpm;</code> 以及 <code>rpm -e xxx.rpm</code> 进行安装卸载。</p>

<h3 id="执行步骤">执行步骤</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">1. 在 %prep 段中，通过 %setup -q 宏解压、打补丁，一般是从 SOURCES 目录下解压到 BUILD 目录下，一般目录是 &quot;NAME-VERSION&quot; 。
2. 通过 %build 段定义了如何进行编译，编译目录就是上述的 BUILD/NAME-VERSION 。
   2.1 首先通过 %configure %cmake 进行配置。
   2.2 然后利用 %{__make} %{?_smp_mflags} 进行并行编译。
3. 接着就是安装，也就是 %install 字段，一般会在 BUILDROOT/NAME-VERSION-RELEASE-ARCH 目录下。
   3.1 通常为了清理环境会先使用 rm -rf %{buildroot} 清理。
   3.2 接着通过 %{__make} install DESTDIR=%{buildroot} 命令进行安装，其中 DESTDIR 相当于是根目录了。
   3.3 通过上步安装的文件，需要都打包到 RPM 包中，如果不需要那么就先清理掉。
   3.4 编译没有生成的也可以通过 %{__install} %{__mv} %{__rm} 命令直接复制。
4. 执行检查规范，对应了 %test 段，一般执行一些单元测试。
5. 开始打包
6. 在 %clean 段处理清理操作，通常会通过 rm -rf %{buildroot} 删除编译的中间内容。</code></pre></figure>

<p>另外，还有 <code>%check</code> 字段，用于做些检查。</p>

<!--
%check
ctest -V %{?_smp_mflags}
%{!?el5:-N}
-->

<h2 id="spec-文件">SPEC 文件</h2>

<p>接下来准备 spec 文件，也是核心的内容，该文件包括三部分：介绍部分，编译部分，files 部分。接下来，是一个简单的示例，可以看看到底是如何制作 RPM 包的。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">### 0.define section                ← ###自定义宏段(可选)，方便后续引用
%define mysql_user mysql                            ← 定义宏，方便后续引用
%define _topdir /home/jinyang/databases/rpm-maker

### 1.The introduction section      ← ###介绍区域段
Name:           mysql                               ← 包名称，通常会在指定源码压缩包时引用
Version:        5.7.17                              ← 版本号，同上
Release:        1%{?dist}                           ← 释出号，每次制作rpm包时递增该数字
Summary:        MySQL from FooBar.                  ← 软件包简介，最好不要超过50字符
License:        GPLv2+ and BSD                      ← 许可，GPL、BSD、MIT等，也可以使用or

Group:          Applications/Databases              ← 程序组名，从/usr/share/doc/rpm-VER/GROUPS选择
URL:            http://kidding.com                  ← 一般为官网
Source0:        %{name}-boost-%{version}.tar.gz     ← 源码包名称(可以使用URL)，可以用SourceN指定多个，如配置文件
#Patch0:         some-bugs.patch                    ← 如果需要打补丁，则依次填写
BuildRequires:  gcc,make                            ← 制作过程中用到的软件包
Requires:       pcre,pcre-devel,openssl,chkconfig   ← 安装时所需软件包，可使用bash &gt;= 1.1.1
Requires(pre):  test                                ← 指定不同阶段的依赖

BuildRoot:      %_topdir/BUILDROOT                  ← 会打包该目录下文件，可查看安装后文件路径
Packager:       FooBar &lt;foobar@kidding.com&gt;
Vendor:         kidding.com

%description                        ← ###软件包的详细描述，可以撒丫子写了
It is a MySQL from FooBar.

#--- 2.The Prep section             ← ###准备阶段，主要是解压源码，并切换到源码目录下
%prep
%setup -q                                           ← 宏的作用是解压并切换到目录
#%patch0 -p1                                        ← 如果需要打补丁，则依次写

#--- 3.The Build Section            ← ###编译制作阶段，主要目的就是编译
%build

make %{?_smp_mflags}                                ← 多核则并行编译

#--- 4.Install section              ← ###安装阶段
%install
if [-d %{buildroot}]; then
   rm -rf %{buildroot}                              ← 清空下安装目录，实际会自动清除
fi
make install DESTDIR=%{buildroot}                   ← 安装到buildroot目录下
%{__install} -Dp -m0755 contrib/init.d %{buildroot}%{_initrddir}/foobar
%{__install} -d %{buildroot}%{_sysconfdir}/foobar.d/

#--- 4.1 scripts section            ← ###没必要可以不填
%pre                                                ← 安装前执行的脚本
%post                                               ← 安装后执行的脚本
%preun                                              ← 卸载前执行的脚本
%postun                                             ← 卸载后执行的脚本
%pretrans                                           ← 在事务开始时执行脚本
%posttrans                                          ← 在事务结束时执行脚本

#--- 5. Clean section               ← ###清理段，可以通过--clean删除BUILD
%clean
rm -rf %{buildroot}

#--- 6. File section                ← ###打包时要包含的文件，注意同时需要在%install中安装
%files
%defattr (-,root,root,0755)                         ← 设定默认权限
%config(noreplace) /etc/my.cnf                      ← 表明是配置文件，noplace表示替换文件
%doc %{src_dir}/Docs/ChangeLog                      ← 表明这个是文档
%attr(644, root, root) %{_mandir}/man8/mysqld.8*    ← 分别是权限，属主，属组
%attr(755, root, root) %{_sbindir}/mysqld

#--- 7. Chagelog section            ← ###记录SPEC的修改日志段
%changelog
* Fri Dec 29 2012 foobar &lt;foobar@kidding.com&gt; - 1.0.0-1
- Initial version</code></pre></figure>

<p>对于 <code>%config(noreplace)</code> 表示为配置文件，且不能覆盖，新安装时如果配置文件存在则会将原文件保存为 <code>*.rpmsave</code> ，升级时则不会覆盖原文件，直接将包中的文件命名为 <code>*.rpmnew</code>，更详细内容可以参考 <a href="http://people.ds.cam.ac.uk/jw35/docs/rpm_config.html">RPM, %config, and (noreplace)</a> 。</p>

<!-- /reference/linux/rpm-config-noreplace.maff -->

<!--
###  4.1 scripts section #没必要可以不写 %pre        #rpm安装前制行的脚本 if [ $1 == 1 ];then    #$1==1 代表的是第一次安装，2代表是升级，0代表是卸载         /usr/sbin/useradd -r nginx 2> /dev/null  ##其实这个脚本写的不完整fi %post       #安装后执行的脚本  %preun      #卸载前执行的脚本 if [ $1 == 0 ];then         /usr/sbin/userdel -r nginx 2> /dev/null fi %postun     #卸载后执行的脚本  ###  5.clean section 清理段,删除buildroot  %clean rm -rf %{buildroot}      ###  6.file section 要包含的文件 %files  %defattr (-,root,root,0755)   #设定默认权限，如果下面没有指定权限，则继承默认 /etc/           #下面的内容要根据你在%{rootbuild}下生成的来写     /usr/ /var/      ###  7.chagelog section  改变日志段 %changelog *  Fri Dec 29 2012 laoguang <ibuler@qq.com> - 1.0.14-1 - Initial version


<figure class="highlight"><pre><code class="language-text" data-lang="text">%global mysqldatadir /var/lib/mysql
%define _topdir /home/jinyang/databases/rpm-maker
Name:           mysql
Version:        5.7.17
Release:        1%{?dist}
Summary:        MySQL from FooBar.

Group:          Applications/Databases
License:        GPLv2+ and BSD
URL:            http://kidding.com
Source0:        %{name}-boost-%{version}.tar.gz
#BuildRequires:
#Requires:

%description
It is a MySQL from FooBar.

%prep
#%setup -q -T -D

%build
#(
#    if ! [ -d release ]; then
#        mkdir release
#    fi
#    pushd release
#    cmake ../%{name}-%{version}                  \
#        -DCMAKE_INSTALL_PREFIX=/opt/mysql-5.7      \
#        -DCMAKE_BUILD_TYPE=Debug                   \
#        -DWITH_EMBEDDED_SERVER=OFF                 \
#        -DWITH_EXAMPLE_STORAGE_ENGINE=ON           \
#        -DWITH_SAFEMALLOC=OFF                      \
#        -DWITH_BOOST=../%{name}-%{version}/boost
#    make %{?_smp_mflags}
#    popd
#)

%install
### Cleanup
##if [-d %{buildroot}]; then
##   rm -rf %{buildroot}
##fi</code></pre></figure>

-->

<p>关于脚本部分，通常所有安装脚本和触发器脚本都是使用 <code>/bin/sh</code> 来执行的，如果想使用其他脚本，如 Lua，可使用 <code>-p /usr/bin/lua</code> 来告诉 rpm 使用 lua 解释器。如</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">%post -p /usr/bin/lua
# lua script here
%postun -p /usr/bin/perl
$ perl sciprt here</code></pre></figure>

<p>另外，如果只执行一条命令，也使用 <code>-p</code> 选项可直接执行，如 <code>%post -p /sbin/ldconfig</code> 。</p>

<p>一般最后一条命令的 exit 状态就是脚本的 exit 状态，除一些特殊情况，一般脚本都是以 <code>exit 0</code> 状态退出，所以大部分小脚本片段都会使用 <code>"||:"</code> 退出。</p>

<h3 id="prep">%prep</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">%setup -q -T -a 0 -a 7 -a 10 -c -n %{src_dir}
参数列表：
    -T 禁止自动解压源码文件
    -D 解压前不删除目录
    -a 切换目录前，解压指定Source文件，例如-a 0表示解压Source0
    -b 切换目录后，解压指定Source文件，例如-a 0表示解压Source0
    -n 解压后目录名称与RPM名称不同，则通过该参数指定切换目录
    -c 解压缩之前先生成目录</code></pre></figure>

<!--
%patch 最简单的补丁方式，自动指定patch level。
%patch 0 使用第0个补丁文件，相当于%patch ?p 0。
%patch -s 不显示打补丁时的信息。
%patch -T 将所有打补丁时产生的输出文件删除。
-->

<h3 id="systemd">systemd</h3>

<p>spec 脚本中提供了与 systemd 相关的脚本，关于脚本的详细内容可以查看 <a href="https://cgit.freedesktop.org/systemd/systemd/tree/src/core/macros.systemd.in">macros.systemd.in</a>，实用方式很简单，如下：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 安装结束后，实际执行systemctl preset，执行服务预设的内容
%systemd_post foobar.service

----- 执行卸载前，systemctl disable
%systemd_preun foobar.service

----- 卸载后执行重启操作，daemon-reload+try-restart
%systemd_postun_with_restart foobar.service

----- 如果不需要重启，例如有状态链接的(D-Bus)，执行systemctl daemon-reload
%systemd_postun foobar.service</code></pre></figure>

<p>关于安装升级的各个操作步骤详见 <a href="http://meinit.nl/rpm-spec-prepostpreunpostun-argument-values">RPM SPEC pre/post/preun/postun argument values</a> 以及 <a href="https://fedoraproject.org/wiki/Packaging:Scriptlets">Fedora Packaging Guidelines for RPM Scriptlets</a> 。</p>

<h3 id="校验">校验</h3>

<p>在安装完 RPM 包之后，可以通过 <code>--verify</code> 或者 <code>-V</code> 进行校验，正常不会显示任何信息，可以通过 <code>--verbose</code> 或者 <code>-v</code> 显示每个文件的信息；文件丢失显示 <code>missing</code>，属性方面的修改内容如下：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">SM5DLUGT c filename
属性：
  S: 文件大小;
  M: 权限;
  5: MD5检查和;
  D: 主从设备号;
  L: 符号连接;
  U: 属主;
  G: 属组;
  T: 最后修改时间。
类型：
  c: 配置文件；
  d: 文档文件。</code></pre></figure>

<h2 id="增加签名">增加签名</h2>

<p>当制作 RPM 包之后，为了防止被篡改，可以使用私钥进行签名，然后将公钥开放出去，然后用户下载完软件包可以通过公钥进行验证签名，从而确保文件的原始性。</p>

<p>可以通过如下步骤进行操作。</p>

<h3 id="1-生成密钥对">1. 生成密钥对</h3>

<p>首先，需要使用 gpp 来生成公私钥对，一般可以使用 RSA 非对称加密。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ gpg --gen-key</code></pre></figure>

<p>此时会在 <code>~/.gnupg</code> 目录下创建相关文件，创建完后可以通过如下命令查看当前的密钥对。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ gpg --list-keys
/home/foobar/.gnupg/pubring.gpg
------------------------------
pub   2048R/860FB269 2017-01-13
uid                  foobar (just for test) &lt;foobar@example.com&gt;</code></pre></figure>

<p>其中 UID 分别对应了用户名、注释、邮箱。</p>

<!-- Repository Signer (OSSXP) -->

<h3 id="2-软件包签名">2. 软件包签名</h3>

<p>修改 RPM 宏，使用上述生成的密钥对。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ echo %_signature gpg &gt;&gt; ~/.rpmmacros
$ echo &quot;%_gpg_name foobar (just for test)&quot; &gt;&gt; ~/.rpmmacros</code></pre></figure>

<p>对已有 rpm 软件包进行签名。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ rpm --addsign package_name.rpm
Enter pass phrase:
Pass phrase is good.
package_name.rpm</code></pre></figure>

<p>如果失败，则会出现如下的错误。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ rpm --addsign package_name.rpm
Enter pass phrase:
Pass phrase check failed.</code></pre></figure>

<p>此时需要仔细检查密钥名称和写入 rpm 宏里面的是否一致，最好是将 <code>--list-keys</code> 显示的内容整体复制出来。</p>

<p>当然也可以在通过 <code>rpmbuild --sign</code> 打包时自动包含签名。</p>

<h3 id="3-增加签名">3. 增加签名</h3>

<p>生成签名使用的是私钥，验证签名需要使用公钥。简单来说需要执行：1)将 gpg 产生的公钥导出到一个文件；2) 将这个公钥文件导入到 RPM 数据库里；3) 使用 rpm 命令进行检验。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 导出公钥到一个文本文档
$ gpg --export -a &quot;foobar (just for test)&quot; &gt; RPM-GPG-KEY-FOOBAR

----- 查看rpm数据库中已有的公钥
$ rpm -q gpg-pubkey-*
gpg-pubkey-f4a80eb5-53a7ff4b
gpg-pubkey-352c64e5-52ae6884
gpg-pubkey-442df0f8-4783f24a

----- 将公钥导入到RPM数据库，注意需要root用户执行
# rpm --import RPM-GPG-KEY-FOOBAR</code></pre></figure>

<p>通过上述命令重新查看公钥时，会发现新增了一个 <code>gpg-pubkey-860fb269-5a65a0ad</code> 公钥，其中 <code>860FB269</code> 与上述 gpg 生成的密钥信息相同。</p>

<p>如果不需要，可以通过 <code>rpm -e gpg-pubkey-860fb269-5a65a0ad</code> 删除即可。</p>

<h3 id="4-签名验证">4. 签名验证</h3>

<p>通过 <code>rpm -K package_name.rpm</code> 命令对签名验证即可，如下是验证成功以及失败时输出的内容。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">package_name.rpm: rsa sha1 (md5) pgp md5 OK
package_name.rpm: RSA sha1 (MD5) (PGP) (MD5) (PGP) md5 NOT OK (MISSING KEYS: PGP#c0eb63c7 PGP#c0eb63c7)</code></pre></figure>

<h3 id="其它">其它</h3>

<p>如果导入公钥失败，那么在安装时会生成一个类似 <code>Header V3 RSA/SHA1 signature: NOKEY, key ID c0eb63c7</code> 的告警信息。</p>

<p>如果要在 YUM 中验证签名，可以将公钥复制到系统 RPM 公钥目录，一般如下操作即可。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># cp RPM-GPG-KEY-FOOBAR /etc/pki/rpm-gpg/</code></pre></figure>

<p>在源配置文件中通过如下两行来指定 gpg key 检验：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-FOOBAR</code></pre></figure>

<p>这样在通过 YUM 安装软件包时，当下载完毕以后会首先使用公钥进行签名验证。</p>

<h2 id="常用设置">常用设置</h2>

<p>接下来，看看一些常用的实用技巧。</p>

<p>在一个 SPEC 文件中可以同时打包多个 RPM 包，当然也可以通过 <code>%package -n foobar</code> 指定子模块 (subpackage) 的名称 。</p>

<!--
http://ftp.rpm.org/max-rpm/s1-rpm-subpack-building-subpackages.html
http://ftp.rpm.org/max-rpm/s1-rpm-subpack-spec-file-changes.html
http://ftp.rpm.org/max-rpm/ch-rpm-b-command.html
-->

<h3 id="宏定义">宏定义</h3>

<p>在定义文件的安装路径时，通常会使用类似 <code>%_sharedstatedir</code> 的宏，这些宏一般会在 <code>/usr/lib/rpm/macros</code> 中定义，当然部分会同时在不同平台上覆盖配置，可以直接 <code>grep</code> 查看。</p>

<p>RPM 内建宏定义在 <code>/usr/lib/rpm/redhat/macros</code> 文件中，这些宏基本上定义了目录路径或体系结构等等；同时也包含了一组用于调试 spec 文件的宏，关于 Macro 详细可以查看 <a href="http://rpm.org/user_doc/macros.html">Macro syntax</a>，其中常用如下：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">%dump                 打印宏的值，包括一些内建的宏定义，也可以通过rpm --showrc查看
%{echo:message}       打印信息到标准输出
%{warn:message}       打印信息到标准错误
%{error:message}      打印信息到标准错误，然后返回BADSPEC
%{expand:expression}  类似Bash中的eval内置命令</code></pre></figure>

<p>另外常用的是根据宏来设置变量。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">%{?foobar:expr} 如果宏 foobar 存在则使用 expand expr，否则为空；也可以取反 %{!?foobar:expr}
%{?macro}       只测试该宏是否存在，存在就用该宏的值，反之则不用，如 %configure %{?_with_foobar}</code></pre></figure>

<p>另外，在判断宏的 Bool 值时，可以通过如下方式测试，如果 <code>variable</code> 定义，则为 <code>01</code> 也就是 <code>true</code> 否则为 <code>0</code> 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">%if 0%{?variable:1}
... ...
%endif</code></pre></figure>

<h3 id="配置脚本">配置脚本</h3>

<p>很多制作 RPM 包的操作都是通过宏定义设置的，如下简单列举一下常见的宏定义操作。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">__os_install_post
    安装完之后的操作，例如去除二进制文件中的注释等；
__spec_install_pre
    在安装前的操作，设置一些环境变量，然后删除BUILDROOT中的文件(如果文件多时耗时增加)；</code></pre></figure>

<p>如果想取消某些操作，可以将这些操作设置为 <code>%{nil}</code> 即可。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 查看对应的命令
$ rpm --showrc | grep -A 4 &#39;: __os_install_post&#39;
-14: __os_install_post
    /usr/lib/rpm/redhat/brp-compress
    %{!?__debug_package:
    /usr/lib/rpm/redhat/brp-strip %{__strip}
    /usr/lib/rpm/redhat/brp-strip-comment-note %{__strip} %{__objdump}

----- 在SPEC文件头部添加如下内容
%global __os_install_post %{nil}

----- 在用户的~/.rpmmacros文件中添加如下配置
%__os_install_post %{nil}</code></pre></figure>

<!--
或者在全局配置文件中添加如下配置
/etc/rpm/macros
%__os_install_post %{nil}       
-->

<h3 id="define-vs-global">define vs. global</h3>

<p>两者都可以用来进行变量定义，不过在细节上有些许差别，简单列举如下：</p>

<ul>
  <li>define 用来定义宏，global 用来定义变量；</li>
  <li>如果定义带参数的宏 (类似于函数)，必须要使用 define；</li>
  <li>在 <code>%{}</code> 内部，必须要使用 global 而非 define；</li>
  <li>define 在使用时计算其值，而 global 则在定义时就计算其值；</li>
</ul>

<p>可以简单参考如下的示例。</p>

<figure class="highlight"><pre><code class="language-spec" data-lang="spec"><span class="c">#--- %prep之前的参数是必须要有的</span>
<span class="gh">Name</span><span class="p">:</span>           mysql
<span class="gh">Version</span><span class="p">:</span>        5.7.17
<span class="gh">Release</span><span class="p">:</span>        1<span class="nv">%{?dist}</span>
<span class="gh">Summary</span><span class="p">:</span>        MySQL from FooBar.
<span class="gh">License</span><span class="p">:</span>        GPLv2+ and BSD

<span class="nd">%description</span>
It is a MySQL from FooBar.

<span class="nd">%prep</span>
<span class="c">#--- 带参数时，必须使用%define定义</span>
<span class="cp">%define myecho() echo %1 %2</span>
<span class="cp">%{!?bar: %define bar defined}</span>

echo 1: <span class="kc">%{bar}</span>
%{myecho 2: <span class="kc">%{bar}</span>}
echo 3: <span class="kc">%{bar}</span>

<span class="c"># 如下是输出内容</span>
<span class="c">#1: defined</span>
<span class="c">#2: defined</span>
<span class="c">#3: %{bar}</span></code></pre></figure>

<p>显然 3 的输出是不符合预期的，可以将 <code>%define</code> 修改为 <code>global</code> 即可。</p>

<h3 id="变量使用">变量使用</h3>

<p>define 定义的变量类似于局部变量，只在 <code>%{!?foo: ... }</code> 区间有效，不过 SPEC 并不会自动清除该变量，只有再次遇到 <code>%{}</code> 时才会清除，WTF!!!</p>

<p>在命令行中通过 <code>--define 'with_ssl bundled'</code> 进行定义，在 SPEC 脚本中，使用 <code>%{?with_ssl: }</code> 处理上述参数，或者通过 <code>%{!?with_ssl: }</code> 处理未定义参数时的情况。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">#--- 根据传入的变量，设置好相应的ssl_option变量
%{?with_ssl: %global ssl_option -DWITH_SSL=%{with_ssl}}

#--- 接下来，通过如下方式使用上述定义的变量
%{?ssl_option}</code></pre></figure>

<p>在 RPM 中，问号 <code>?</code> 用于条件检测，默认如果对应的变量值不存在，那么 RPM 会原样保留字符串，通过问号表示，如果不存在则移除。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ rpm --eval=&#39;foo:%{foo}&#39;$&#39;\n&#39;&#39;bar:%{?bar}&#39;
foo:%{foo}
bar:

$ rpm --define=&#39;foo foov&#39; --eval=&#39;foo:%{foo}&#39;$&#39;\n&#39;&#39;bar:%{?bar}&#39;
foo:foov
bar:

$ rpm --define=&#39;foo foov&#39; --define=&#39;bar barv&#39; --eval=&#39;foo:%{foo}&#39;$&#39;\n&#39;&#39;bar:%{?bar}&#39;
foo:foov
bar:barv</code></pre></figure>

<p>除了上述的表示方法外，还可以使用如下内容：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">%define _without_foobar            1
# enabled by default
%define with_foobar 0%{!?_without_foobar:1}</code></pre></figure>

<p>如果 <code>_without_foobar</code> 变量不存在，那么默认 <code>with_foobar</code> 为 01 也就是 true，否则就是 0 也就是 false；可以通过如下命令行进行测试。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ rpm --define=&#39;with_foobar 0%{!?_without_foobar:1}&#39; --eval=&#39;foobar:%{with_foobar}&#39;
foobar:01
$ rpm --define=&#39;_without_foobar 1&#39; --define=&#39;with_foobar 0%{!?_without_foobar:1}&#39; --eval=&#39;foobar:%{with_foobar}&#39;
foobar:0</code></pre></figure>

<h3 id="测试脚本">测试脚本</h3>

<p>如下是一个测试用的脚本，可以用来生成简单的测试 SPEC 脚本，并执行。</p>

<p>该脚本会将 <code>/tmp/foobar</code> 目录作为工作目录，然后生成一个简单的 Hello world 程序，也可以直接下载 <a href="/reference/linux/package-rpm.sh">package-rpm.sh</a> 脚本文件。</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="nv">WORKSPACE</span><span class="o">=</span>/tmp/foobar

<span class="nb">echo</span> <span class="s2">&quot;0. Prepare dirs&quot;</span>
mkdir -pv <span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span>/<span class="o">{</span>BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS,Workspace/foobar-1.0.0<span class="o">}</span>

<span class="nb">echo</span> <span class="s2">&quot;1. Generate tar&quot;</span>
<span class="nb">cd</span> <span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span>/Workspace/foobar-1.0.0
cat <span class="s">&lt;&lt; EOF &gt; main.c</span>
<span class="s">#include &lt;stdio.h&gt;</span>

<span class="s">int main(int argc, char *argv)</span>
<span class="s">{</span>
<span class="s">    printf(&quot;Hello World!!!\n&quot;);</span>
<span class="s">        return 0;</span>
<span class="s">}</span>
<span class="s">EOF</span>
cat &lt;&lt; <span class="s2">&quot;EOF&quot;</span> &gt; Makefile
all: main.c
	gcc -o foobar <span class="nv">$&lt;</span> -Wall
install:
	install -m <span class="m">755</span> foobar <span class="k">${</span><span class="nv">DESTDIR</span><span class="k">}</span>/usr/bin/foobar
EOF
<span class="nb">cd</span> <span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span>/Workspace
tar -jcf foobar-1.0.0.tar.bz2 foobar-1.0.0
<span class="c">#[ &quot;${WORKSPACE}/BUILD&quot; != &quot;/&quot; ] &amp;&amp; rm -rf &quot;${WORKSPACE}/BUILD/&quot;</span>
rm -rf <span class="s2">&quot;${WORKSPACE}/SOURCES/foobar-1.0.0.tar.bz2&quot;</span>
mv foobar-1.0.0.tar.bz2 <span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span>/SOURCES/

<span class="nb">echo</span> <span class="s2">&quot;2. Prepare spec-file&quot;</span>
<span class="nb">cd</span> <span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span>
cat <span class="s">&lt;&lt; EOF &gt; SPECS/foobar-1.0.0.spec</span>
<span class="s">### 0. The define section</span>
<span class="s">%global _topdir ${WORKSPACE}</span>

<span class="s">### 1.The introduction section</span>
<span class="s">Name:           foobar</span>
<span class="s">Version:        1.0.0</span>
<span class="s">Release:        1%{?dist}</span>
<span class="s">Summary:        Just a RPM example</span>
<span class="s">License:        GPLv2+ and BSD</span>
<span class="s">BuildRequires:  gcc,make</span>
<span class="s">Source0:        %{name}-%{version}.tar.bz2</span>
<span class="s">BuildRoot:      %_topdir/BUILDROOT</span>

<span class="s">%description</span>
<span class="s">It is a RPM example.</span>

<span class="s">#--- 2.The Prep section</span>
<span class="s">%prep</span>
<span class="s">%setup -q</span>
<span class="s">#%patch0 -p1</span>

<span class="s">#--- 3.The Build Section</span>
<span class="s">%build</span>
<span class="s">make %{?_smp_mflags}</span>
<span class="s">#echo %{_sysconfdir}</span>

<span class="s">%install</span>
<span class="s">#/usr/bin/</span>
<span class="s">install -d -m 0751 %{buildroot}/%{_bindir}</span>
<span class="s">make install DESTDIR=%{buildroot}</span>
<span class="s">#--- 4.1 scripts section</span>
<span class="s">%pre</span>
<span class="s">echo &quot;pre&quot; &gt;&gt; /tmp/foobar</span>
<span class="s">%post</span>
<span class="s">echo &quot;post&quot; &gt;&gt; /tmp/foobar</span>
<span class="s">%preun</span>
<span class="s">echo &quot;preun&quot; &gt;&gt; /tmp/foobar</span>
<span class="s">%postun</span>
<span class="s">echo &quot;postun&quot; &gt;&gt; /tmp/foobar</span>

<span class="s">#--- 5.clean section</span>
<span class="s">%clean</span>
<span class="s">rm -rf %{buildroot}</span>

<span class="s">#--- 6.file section</span>
<span class="s">%files</span>
<span class="s">%defattr(-,root,root,-)</span>
<span class="s">%attr(755, root, root) %{_bindir}/foobar</span>

<span class="s">#--- 7.chagelog section</span>
<span class="s">%changelog</span>
<span class="s">* Fri Dec 28 2012 foobar foobar@kidding.com - 1.0.0-1</span>
<span class="s">- Initial version</span>
<span class="s">EOF</span>

<span class="nb">echo</span> <span class="s2">&quot;3. Perform rpmbuild&quot;</span>
<span class="nb">cd</span> <span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span>
rpmbuild --clean --define <span class="s1">&#39;_topdir /tmp/foobar&#39;</span> -ba SPECS/foobar-1.0.0.spec</code></pre></figure>

<h3 id="参考示例">参考示例</h3>

<p>如上介绍了手动如何编译生成 rpm 包，这里通过 collectd 看看，如何使用一些常见的工具，更加方便的制作 rpm 包，可以参考 <a href="http://giovannitorres.me/how-to-build-rpms-collectd-example.html">collectd 创建的示例</a> 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># yum install rpmdevtools yum-utils

----- 配置环境，生成topdir工作目录~/rpmbuild，以及配置文件~/.rpmmacros
$ rpmdev-setuptree

----- 下载collectd源码，并解压
$ mkdir ~/src &amp;&amp; cd ~/src &amp;&amp; curl --progress https://collectd.org/files/collectd-5.5.3.tar.gz | tar xz</code></pre></figure>

<p>也可以参考 <a href="/reference/linux/how_to_build_rpms.html">本地文档</a> 。</p>

<h2 id="其它-1">其它</h2>

<p>如下是 <code>%if</code> 判断的使用。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">%if 0%{?rhel} == 6
%global compatver             5.1.17
BuildRequires:  systemd
%else
%global compatver             5.1.17
BuildRequires:  sysv
%endif</code></pre></figure>

<p>可以使用 Requires(pre)、Requires(post) 等都是针对不同阶段的依赖设置；可以通过 <code>%package PACKAGE-NAME</code> 设置生成不同的 RPM 分支包。</p>

<p>另外，可以生成 GPG 签名，在此不再赘述。</p>

<h3 id="添加用户">添加用户</h3>

<p>可以在 <code>%pre</code> 段中添加如下内容。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">/usr/sbin/groupadd -g 66 -o -r monitor &gt;/dev/null 2&gt;&amp;1 || :

参数：
  --gid/-g
    指定group id；
  --non-unique/-o
    group id可以不唯一，此时相当于指定了一个 alias；
  --system/-r
    创建系统分组；

/usr/sbin/useradd -M %{!?el5:-N} -g monitor -o -r -d %{_libdir}/%{name} -s /bin/false \
    -c &quot;Uagent Server&quot; -u 66 monitor &gt;/dev/null 2&gt;&amp;1 || :
参数：
  --no-create-home/-M
    不创建HOME目录；
  --no-user-group/-N
    不创建相同用户名的分组；
  --non-unique/-o
    user id可以不唯一，此时相当于指定了一个 alias；
  --system/-r
    创建系统用户；
  --home-dir/-d HOME_DIR
    指定HOME目录，如果不存在则会创建；
  --shell/-s SHELL
    指定默认的shell；</code></pre></figure>

<h3 id="初始宏定义">初始宏定义</h3>

<p>很多的宏，是在 <code>/etc/rpm</code> 目录下定义的，如上面的 <code>dist</code> 在 <code>/etc/rpm/macros.dist</code> 文件中定义。</p>

<h3 id="rpm包查看">RPM包查看</h3>

<p>对于生成的 RPM 包，只能查看头部信息和脚本内容，指令分别如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ rpm --info -qp XXX.rpm
$ rpm --scripts -qp XXX.rpm</code></pre></figure>

<h3 id="变量定义">变量定义</h3>

<p>在定义 <code>Version</code> 时，如果使用 <code>%{?package_version:1.0.0}</code> 可以工作但是，使用 <code>%{!?package_version:1.0.0}</code> 却无效。</p>

<p>而且这里的参数不能通过类似 <code>rpmbuld --define='package_version 1.9.1' foobar.spec</code> 的方式传入。</p>

<h2 id="依赖检查">依赖检查</h2>

<p>如果在安装时有些环境或者平台的检查，例如只支持某些平台，那么需要添加到 <code>%pre</code> 段中，其退出码非 0 ；注意，如果使用 <code>%post</code> 不会生效。</p>

<p>另外，在卸载时，如果 <code>%preun</code> 的退出码非 0 则会导致卸载失败；与安装类似，如果使用 <code>%postun</code> 同样不会生效。</p>

<p>对于如上场景可以使用 <code>--noscripts</code> 忽略，该参数等价于 <code>--nopre</code> <code>--nopost</code> <code>--nopreun</code> <code>--nopostun</code>，例如。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># rpm --noscripts -ivh foobar-1.0.0-1.x86_64.rpm
# rpm --noscripts -evh foobar</code></pre></figure>

<p>如果想查看执行的是那些脚本，可以通过 <code>rpm -q --scripts package</code> 命令查看，当机器上有多个版本时，如果要删除所有版本可以使用 <code>--allmatches</code> 参数。</p>

<h3 id="debuginfo">debuginfo</h3>

<p>rpmbuild 默认会生成 debuginfo 包，如果要关闭，可以通过如下的几种方式设置。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 修改配置文件，可以是用户级别，或者是全局的/etc/rpm/macros
$ echo &#39;%debug_package %{nil}&#39; &gt;&gt; ~/.rpmmacros
$ echo &#39;%define debug_package %{nil}&#39; &gt;&gt; ~/.rpmmacros

----- 也可以在命令行中添加参数
$ rpmbuild --define &quot;debug_package %{nil}&quot;</code></pre></figure>

<p>注意，如果要使用 rpm 的 debuginfo 包，在编译的时候就需要添加 <code>-g</code> 参数，否则即使生成了 debuginfo 包，也有可能会导致没有提取到完整的 debuginfo 包，在使用 gdb 时会报如下的错误。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">separate debug info file has no debug info</code></pre></figure>

<h2 id="参考">参考</h2>

<p>很多关于 RPM 的介绍可以参考文档 <a href="http://rpm.org/max-rpm-snapshot/index.html">Maximum RPM</a>；另外，还可以参考下 MySQL 源码包中的相关示例 <a href="/reference/databases/mysql/mysql.spec">mysql.spec</a> 。</p>

<!--
http://fedoraproject.org/wiki/How_to_create_an_RPM_package

包含生成GPG签名
http://laoguang.blog.51cto.com/6013350/1103628

rpm mock
https://leo108.com/pid-2207.asp
-->


  <hr>
  <nav>
    <ul class="pager">
         <li class="previous"><a href="/post/kernel-memory-proc-filesystem_init.html" title="Linux 内存 Proc">&larr; Older</a></li> 
         <li class="next"><a href="/post/linux-security-enhance_init.html" title="Linux 安全加固">Newer &rarr;</a></li> 
    </ul>
  </nav><br>
<!--
  <hr><div id="section-donate"><span>赏</span></div><br>
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p><br>
  <div class="row" style="text-align:center;" >
    <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
    <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
  </div><br><hr>
-->
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p>
  <div id="donate_module">
    <style type="text/css">
      .donate_bar a.btn_donate{
        display: inline-block;
        position:      relative;
        text-align:    center;
        width: 82px;
        height: 82px;
        background: url("/images/misc/btn_reward.gif") no-repeat;
        _background: url("/images/misc/btn_reward.gif") no-repeat;
        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
      }
      .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
      .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
      }
    </style>
    <div id="donate_board" class="donate_bar row" style="text-align:center;" >
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    </div>
    <div id="donate_guide" class="donate_bar center hidden">
      <div class="row" style="text-align:center;" >
        <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
        <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function(){
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
    </script>
  </div>

  <hr>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      id: '1445356800',
      owner: 'Jin-Yang',
      repo: 'jin-yang.github.com',
      oauth: {
          client_id: '6d89d48ce689192bf95d',
          client_secret: 'c9a720aafb8e3084e3feb46cadee80b03cdc792f',
      },
  });
  gitment.render('gitmentContainer');
  </script>

  <!-- 多说评论框 start -->
  <!--<div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>-->
  <!--
  <div class="ds-thread" data-thread-key="/post/linux-create-rpm-package.html" data-title="RPM 包制作" data-url="/post/linux-create-rpm-package.html"></div>
  -->
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <!--
  <script type="text/javascript">
      var duoshuoQuery = {short_name:"jinyangposts"};
      (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
  </script>
  -->
  <!-- 多说公共JS代码 end -->
</div>

    </div>
    <div class="col-lg-3 visible-lg blog-sidebar">
    <center><a href="/"><img src="/images/system/linux-liberty.png" width="200" /></a></center>
<h2>About This Blog</h2>
<div class="sidebar-module">
<p style="text-indent:0em;margin:0px;padding:0px;">This is a personal weblog ^_^ generated with Jekyll, if you like it or have some questions,
just feel free to contact me :)</p>
</div><!-- end of "node" "about" -->



<h2>Recent Posts</h2>
<div class="list-group">
  
    <a class="list-group-item" href="/post/linux-program-cpu-cache-introduce_init.html">CPU Cache</a>
  
    <a class="list-group-item" href="/post/artificial-intelligence-decision-tree-introduce.html">决策树</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-bcc-tools-introduce.html">BCC 工具使用</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-basic-usage-introduce.html">eBPF 简介</a>
  
    <a class="list-group-item" href="/post/math-monte-carlo-sample-introduce.html">采样算法</a>
  
</div>

<h2>Categories</h2>
<ul class="list-group" style="margin:0px;">
  
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#bash"> bash</a>
    <span class="badge">2</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#database"> database</a>
    <span class="badge">86</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#golang"> golang</a>
    <span class="badge">28</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#linux"> linux</a>
    <span class="badge">301</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#misc"> misc</a>
    <span class="badge">244</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#mysql"> mysql</a>
    <span class="badge">79</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#network"> network</a>
    <span class="badge">49</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#postgresql"> postgresql</a>
    <span class="badge">4</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#program"> program</a>
    <span class="badge">138</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#python"> python</a>
    <span class="badge">25</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#react"> react</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#rtems"> rtems</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#sql"> sql</a>
    <span class="badge">10</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#tools"> tools</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#webserver"> webserver</a>
    <span class="badge">25</span>
  </li>
  
</ul><!-- end of "node" "categories" -->

<h2>Related Links</h2>
<ul class="list-group" style="margin:0px">
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.rtems.org" title="To RTEMS"><img class="img-thumbnail img-responsive" src="/images/system/rtems.png"  alt="RTEMS"/></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>RTEMS</strong><br>
        <div class="sidebar-description">Real-Time Executive for Multiprocessor System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.gnu.org" title="To GNU">
       <img class="img-thumbnail img-responsive" src="/images/system/gnu.jpg" alt="GNU" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>GNU</strong><br>
        <div class="sidebar-description">A Unix-linux Operating System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://www.kernel.org" title="To Linux Kernel">
    <img class="img-thumbnail img-responsive" src="/images/system/linux.png"  alt="LINUX" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Linux Kernel</strong><br>
        <div class="sidebar-description">Maintained by Linux Kernel Organization</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://arduino.cc" title="To Arduino">
    <img class="img-thumbnail img-responsive" src="/images/system/arduino.png"  alt="ARDUINO" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Arduino</strong><br>
        <div class="sidebar-description">Open-source Electronic Prototyping Platform</div>
      </div>
    </div>
  </li>
</ul>

<h2>Search</h2>
<div class="sidebar-module">
  <form class="search" method="GET" action="https://www.google.com.hk/search">
    <input type="text" name="q" class="search-query" placeholder=" Search on Google">
    <input type="hidden" name="ie" value="utf-8">
    <input type="submit" name="sa" value="Search" />
  </form><br>
  <input type="text" class="search-field" placeholder=" Search This Site">
  <div class="search-results"></div>
</div>



    </div>
  </div>
<hr><p class="text-center">This Site was built by Jin Yang, generated with Jekyll, and hosted on GitHub Pages<br/> &copy;2013-2019 &ndash; Jin Yang</p><div class="footer-logo"></div>

</div>
</body>
</html>
