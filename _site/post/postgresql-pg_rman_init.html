<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <meta name="baidu-site-verification" content="B786jeR0MV" />
  <meta name="msvalidate.01" content="29F791E7F785800340E37AD7C714D2A7" />
  <meta name="google-site-verification" content="p7jJ5d3kF9yxRhpIo5GgHXAZ1ATKVyZhV2kf6mEGOv0" />
  <title>PG 备份|JinYang's Blog</title>
  <meta name="keywords" content="">
  <meta name="description" content="">

  <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">
  !window.jQuery && document.write('<script src="/static/js/jquery.min.js"><\/script>');
  </script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  !$('body').popover && document.write('<script src="/static/js/bootstrap.min.js"><\/script>');
  </script>
  <script type="text/javascript" src="/static/js/main.js"></script>
  <!-- <link rel="stylesheet prefetch" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/bootstrap.min.css">
  <!-- <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/font-awesome.min.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/pygments.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/screen.css">
  <style type="text/css">
  
    .post-container > p {text-indent: 2em;}
  
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124556620-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124556620-1');
</script>

</head>

<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top navbar-wrapper">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/">Jin-Yang</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li  ><a href="/"> Home </a></li>
        <li  ><a href="/archives.html"> Archive </a></li>
        <li  ><a href="/categories.html"> Categories </a></li>
        <li  ><a href="/projects.html"> Projects </a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Others <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">常用网站</li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.rtems.org/">www.rtems.org</a></li>
            <li><a href="http://www.gnu.org/">www.gnu.org</a></li>
            <li><a href="https://www.kernel.org/">www.kernel.org</a></li>
            <li><a href="https://www.arduino.cc/">www.arduino.cc</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li  ><a href="/about.html"> About </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
    <li data-target="#myCarousel" data-slide-to="4"></li>
  </ol>
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>KISS</h1>
          <h2>Keep It Simple and Stupid.</h2>
          <!--<a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a>-->
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Seize The Day</h1><h1>And Get Busy Living</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Stay hungry</h1><h1>Stay foolish</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
	  <h2>Ever tried, ever failed</h2><h2>No matter, try again</h2><h2>Fail again, fail better</h2>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Nothing is true</h1><h1>Every is permitted</h1>
        </div>
      </div>
    </div>
  </div>
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div><!-- /.carousel -->

<div class="container">
  <div class="row">
    <div class="col-lg-9 blog-main" style="min-width: 500px">
    
<div class="post-container">
  <div class="blog-header">
    <h1>PG 备份</h1>
    <div class="post-description">
      <i class="fa fa-calendar"></i> 2016-09-26 Monday &nbsp; &nbsp;
      <i class="fa fa-tags"></i>  sql  
      
    </div>
  </div>
  <hr>
  <!-- more -->

<h1 id="简介">简介</h1>

<p>pg_rman 支持全量、增量、归档三种备份模式，支持压缩以及备份集的管理。源码可以参考 <a href="https://github.com/ossc-db/pg_rman">github rman</a>，需要选择相应的版本。</p>

<h1 id="step-by-step">Step By Step</h1>

<p>接下来，我们看看如何一步步进行测试。</p>

<h2 id="0-准备环境">0. 准备环境</h2>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ pg_ctl -D /var/lib/pgsql/data init
$ mkdir /tmp/archive
$ cat data/postgresql.conf
wal_level = archive
archive_mode = on
archive_command = &#39;cp %p /tmp/archive/%f&#39;
$ pg_ctl -D /var/lib/pgsql/data -l logfile start

SELECT name, setting FROM pg_settings WHERE name IN (&#39;wal_level&#39;, &#39;archive_mode&#39;, &#39;archive_command&#39;);
CREATE TABLE foobar(id INT);
INSERT INTO foobar VALUES(generate_series(1, 1000000));

$ mkdir /tmp/backup</code></pre></figure>

<h2 id="1-初始化">1. 初始化</h2>

<p>实际上就是需要一个目录，用于存放备份的文件以及一些元数据，如备份的配置文件、数据库的 systemid、时间线文件历史等等。该命令只需要两个参数：备份目录、数据库的 $PGDATA 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ pg_rman -B /tmp/backup -D /var/lib/pgsql/data init
$ tree /tmp/backup/
|-- backup/
|   |-- pg_xlog/
|   `-- srvlog/
|-- pg_rman.ini            # 生成的配置文件
|-- system_identifier      # 数据库system-id
`-- timeline_history/

$ cat pg_rman.ini
ARCLOG_PATH=&#39;/tmp/archive&#39;
SRVLOG_PATH=&#39;/var/lib/pgsql/data/pg_log&#39;

$ cat system_identifier
SYSTEM_IDENTIFIER=&#39;6340953224459249572&#39;</code></pre></figure>

<p>其中 system_identifier 用于区分备份的数据库是不是一个数据库，防止被冲。</p>

<h2 id="2-全量备份">2. 全量备份</h2>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ pg_rman backup --backup-path=/tmp/backup --pgdata=/var/lib/pgsql/data \
    --arclog-path=/tmp/archive --srvlog-path=/var/lib/pgsql/data/pg_log \
    --backup-mode=full --with-serverlog --compress-data --smooth-checkpoint \
    --keep-data-days=10 \
    --keep-arclog-files=15 --keep-arclog-days=10 \
    --keep-srvlog-files=10 --keep-srvlog-days=15 \
    --verbose --progress \
    -h 127.0.0.1 -U postgres -d postgres</code></pre></figure>

<p>pg_rman 在备份时会记录每个备份文件的 crc 校验码，保存在 file_database.txt 文件中，内容为：路径、文件类型、大小、CRC校验值、权限、时间。</p>

<p>此时，可以通过如下命令查看当前备份的状态，正常来说应该是 DONE，需要再执行一次 validate 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ pg_rman show -B /tmp/backup</code></pre></figure>

<p>每个备份集都包含了一个备份状态文件 backup.ini，这个文件中包含了很重要的信息，如 LSN，后面 LSN 将用于比对增量备份时对比数据块的 LSN 是否发生了变化，是否需要备份。</p>

<h2 id="3-数据校验">3. 数据校验</h2>

<p>每次备份完，必须要做一次校验，否则备份集不可用来恢复，也不会用来做增量的比较。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ pg_rman validate -B /tmp/backup</code></pre></figure>

<p>备份时，会记录每个备份文件的 CRC 校验，用来 validate 做校验，每个目录会对应着一个校验文件。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ ls /tmp/backup/20160826/105229/file_*.txt
file_arclog.txt  file_database.txt  file_srvlog.txt

$ cat /tmp/backup/20160826/105229/file_database.txt
... ...
global/2397 F 18446744073709551615 0 0600 2016-08-26 10:45:19
global/2676 F 18446744073709551615 0 0600 2016-08-26 10:45:18
global/2677 F 18446744073709551615 0 0600 2016-08-26 10:45:18
global/2694 F 18446744073709551615 0 0600 2016-08-26 10:45:18
global/2695 F 18446744073709551615 0 0600 2016-08-26 10:45:18
global/2697 F 18446744073709551615 0 0600 2016-08-26 10:45:18
global/2698 F 18446744073709551615 0 0600 2016-08-26 10:45:18
... ...</code></pre></figure>

<p>每行分别对应了路径、文件类型、大小、CRC 校验值、权限、时间等值。另外，每个备份目录下还包括了一个 backup.ini 文件，保存了这个备份的状态，含有一些重要的信息，如 LSN 等。</p>

<h2 id="4-增量备份">4. 增量备份</h2>

<p>实际上与上述的全量备份相同，只需要修改 backup-mode 即可。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 插入一部分数据
INSERT INTO foobar VALUES(generate_series(1, 1000000));

$ pg_rman backup --backup-path=/tmp/backup --pgdata=/var/lib/pgsql/data \
    --arclog-path=/tmp/archive --srvlog-path=/var/lib/pgsql/data/pg_log \
    --backup-mode=incremental --with-serverlog --compress-data --smooth-checkpoint \
    --keep-data-days=10 \
    --keep-arclog-files=15 --keep-arclog-days=10 \
    --keep-srvlog-files=10 --keep-srvlog-days=15 \
    --verbose --progress \
    -h 127.0.0.1 -U postgres -d postgres

$ pg_rman validate -B /tmp/backup

----- 查看当前的备份集
$ pg_rman show -B /tmp/backup</code></pre></figure>

<h2 id="5-按指定时间从catalog删除备份集">5. 按指定时间从catalog删除备份集</h2>

<p>例如只需要我的备份集能恢复到 2016-08-26 19:59:00，在这个时间点以前，不需要用来恢复到这个时间点的备份全删掉。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ pg_rman delete &quot;2016-09-22 23:12:14&quot; -B /tmp/backup

----- 物理删除已从catalog删除的备份集
$ pg_rman purge -B /tmp/backup</code></pre></figure>

<h2 id="6-恢复">6. 恢复</h2>

<p>数据恢复时有两个必要的要素：1) 新的 $PGDATA；2) 备份目录。备份恢复的时候有几个参数，实际上与 PG 的恢复配置文件 recovery.conf 中的意思对齐。</p>

<p>在恢复时，可以选择原地恢复，或者使用新的 $PGDATA 目录，不过不管是哪种恢复方式，如果在本机恢复，可能会覆盖原有的数据文件，所以最好先将原数据目录重命名。</p>

<!--

如果不指定时间线，则使用$PGDATA/global/pg_control，如果没有$PGDATA/global/pg_control，则使用最新的全量备份集的时间线。

--recovery-target-timeline TIMELINE
Specifies recovering into a particular timeline. If not specified, the current timeline from ($PGDATA/global/pg_control) is used.

如果不指定，则恢复到最新时间

--recovery-target-time TIMESTAMP
This parameter specifies the time stamp up to which recovery will proceed. If not specified, continue recovery to the latest time.

如果不指定，则恢复到最新xid

--recovery-target-xid XID
This parameter specifies the transaction ID up to which recovery will proceed. If not specified, continue recovery to the latest xid.

如果不指定，则默认使用true，即恢复到包含恢复目标XID的commit record为止，或者第一笔commit record ts>指定ts的 commit redo record为止；
如果是false则不apply恢复目标XID的commit record，或者不apply第一笔commit record ts>=指定ts的 commit redo record。

--recovery-target-inclusive
Specifies whether we stop just after the specified recovery target (true), or just before the recovery target (false). Default is true.

是否使用硬链接复制archive log，而不需要拷贝文件

The following parameter determines the behavior of restore.
--hard-copy
The archive WAL are copied to archive WAL storage area. If not specified, pg_rman makes symbolic link to archive WAL where are in the backup catalog directory.
-->

<h3 id="51-在本机恢复的例子">5.1 在本机恢复的例子</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 1. 停库
$ pg_ctl -D /var/lib/pgsql/data -l logfile stop

----- 2. 重命名原数据相关目录，PGDATA、PG_XLOG、表空间、归档目录
$ mv /var/lib/pgsql/{data,data.bak}
$ mv /tmp/{archive,archive.bak}

----- 3. 恢复数据，并修改权限
$ pg_rman restore -B /tmp/backup -D /var/lib/pgsql/data
$ chmod 700 /var/lib/pgsql/data

----- 4. 启动恢复目标数据库
$ pg_ctl start -D /var/lib/pgsql/data

----- 5. 查看恢复的状态
postgres=# select pg_is_in_recovery();
 pg_is_in_recovery
-------------------
 f
(1 row)</code></pre></figure>

<p>恢复时可以指定 $PGDATA，从而恢复到新目录，但是 arch_log、表空间、pg_xlog 目录无法指定新的位置，所以原地还原时，必须注意这些目录可能被覆盖，最好是重命名。</p>

<h1 id="pg_rman-源码浅析">pg_rman 源码浅析</h1>

<p>可以直接从官方下载相应的源码包，然后可以简单通过如下的命令进行安装。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># yum install pam-devel
$ make</code></pre></figure>

<p>实际上，pg_rman 的源码非常简单，开始会做基本的参数解析，对于不同的子命令会调用应用的 do_XXX() 函数，如 do_init()、do_show() 等等。</p>

<p>pg_rman 会将备份数据保存到 DATE/TIME 目录下，其中备份结果会保存到 backup.ini 文件中，实际上在内存中通过 struct pgBackup 结构体表示。</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">pgBackup</span>
<span class="p">{</span>
    <span class="cm">/* Backup Level */</span>
    <span class="n">BackupMode</span>  <span class="n">backup_mode</span><span class="p">;</span>
    <span class="kt">bool</span>        <span class="n">with_serverlog</span><span class="p">;</span>
    <span class="kt">bool</span>        <span class="n">compress_data</span><span class="p">;</span>
    <span class="kt">bool</span>        <span class="n">full_backup_on_error</span><span class="p">;</span>

    <span class="cm">/* Status - one of BACKUP_STATUS_xxx */</span>
    <span class="n">BackupStatus</span>    <span class="n">status</span><span class="p">;</span>

    <span class="cm">/* Timestamp, etc. */</span>
    <span class="n">TimeLineID</span>  <span class="n">tli</span><span class="p">;</span>

    <span class="n">XLogRecPtr</span>  <span class="n">start_lsn</span><span class="p">;</span>      <span class="c1">// pg_start_backup()调用返回值</span>
    <span class="n">XLogRecPtr</span>  <span class="n">stop_lsn</span><span class="p">;</span>       <span class="c1">// pg_stop_backup()调用返回值</span>

    <span class="kt">time_t</span>      <span class="n">start_time</span><span class="p">;</span>
    <span class="kt">time_t</span>      <span class="n">end_time</span><span class="p">;</span>
    <span class="kt">time_t</span>      <span class="n">recovery_time</span><span class="p">;</span>
    <span class="n">uint32</span>      <span class="n">recovery_xid</span><span class="p">;</span>

    <span class="cm">/* Size (-1 means not-backup&#39;ed) */</span>
    <span class="n">int64</span>       <span class="n">total_data_bytes</span><span class="p">;</span>
    <span class="n">int64</span>       <span class="n">read_data_bytes</span><span class="p">;</span>
    <span class="n">int64</span>       <span class="n">read_arclog_bytes</span><span class="p">;</span>
    <span class="n">int64</span>       <span class="n">read_srvlog_bytes</span><span class="p">;</span>
    <span class="n">int64</span>       <span class="n">write_bytes</span><span class="p">;</span>

    <span class="cm">/* data/wal block size for compatibility check */</span>
    <span class="n">uint32</span>      <span class="n">block_size</span><span class="p">;</span>
    <span class="n">uint32</span>      <span class="n">wal_block_size</span><span class="p">;</span>

    <span class="cm">/* if backup from standby or not */</span>
    <span class="kt">bool</span>        <span class="n">is_from_standby</span><span class="p">;</span>

<span class="p">}</span> <span class="n">pgBackup</span><span class="p">;</span></code></pre></figure>

<h2 id="增量备份">增量备份</h2>

<p>上次备份后，数据块的 LSN 是否发生变化，若从上次备份的 start_lsn 以来没有发生变化，则不备份。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">do_backup()
  |-fgets()                    # 获取备份目录下system_identifier的值
  |-read_control_file()        # 读取当前数据库的system_identifier值
  |=========================== backup start
  |
  |-do_backup_database()       # 备份数据库数据
  | |                          ===== INFO: copying database files等待时间有点长
  | |-pg_start_backup()
  | |
  | |-parray_new()             # 新建需要复制文件的数组
  | |-dir_list_file()          # 获取所有需要复制的目录列表
  | |-dir_print_mkdirs_sh()    # 非check模式，则创建mkdirs.sh脚本
  | |-parray_free()            # 清空目录列表
  | |
  | |-backup_files()           # 执行文件备份过程
  | | |-backup_data_file()     # 会校验lsn是否需要复制
  | |
  | |-pg_stop_backup()
  |   |-wait_for_archive()
  |                            ===== database backup completed
  |
  |-do_backup_arclog()         # 备份WAL日志
  |-do_backup_srvlog()         # 备份系统日志
  |
  |-pgBackupWriteIni()         # 备份完成将相应信息保存到backup.ini文件中
  |
  |-pgBackupDelete()           # 清除老的备份数据</code></pre></figure>

<p>在启动时，会读取备份目录下的 system_identifier 文件的内容，与数据库中 global/pg_control 文件保存的相应的标示做对比，该文件保存格式为 ControlFileData 。</p>

<p>StartupXLOG()
readRecoveryCommandFile()    # 读取恢复文件中的配置项，可以判断保存的变量</p>

<h1 id="注意事项">注意事项</h1>

<ul>
  <li>
    <p>PG 会从配置文件中读取 log_directory、archive_command 的值，所以如果这两个配置项在其它文件中或者在 postgresql.auto.conf 中，则这两个值将不准确。</p>
  </li>
  <li>
    <p>在编译 pg_rman 时，需要保证 BLCKSZ、XLOG_BLCKSZ 与服务器相同，因为需要做块的校验、读取 LSN 等操作，都与块大小有关，最好使用 pg_config 获取相同的配置，确保块大小一致。</p>
  </li>
  <li>
    <p>通过 pg_start_backup() 启动时，采用的是 exclusive 模式，所以同一时间，只能跑一次上述的命令。</p>
  </li>
</ul>


  <hr>
  <nav>
    <ul class="pager">
         <li class="previous"><a href="/post/influxdata-influxdb-introduce.html" title="InfluxDB">&larr; Older</a></li> 
         <li class="next"><a href="/post/grit-the-key-to-sucess.html" title="Grit - The key to success">Newer &rarr;</a></li> 
    </ul>
  </nav><br>
<!--
  <hr><div id="section-donate"><span>赏</span></div><br>
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p><br>
  <div class="row" style="text-align:center;" >
    <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
    <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
  </div><br><hr>
-->
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p>
  <div id="donate_module">
    <style type="text/css">
      .donate_bar a.btn_donate{
        display: inline-block;
        position:      relative;
        text-align:    center;
        width: 82px;
        height: 82px;
        background: url("/images/misc/btn_reward.gif") no-repeat;
        _background: url("/images/misc/btn_reward.gif") no-repeat;
        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
      }
      .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
      .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
      }
    </style>
    <div id="donate_board" class="donate_bar row" style="text-align:center;" >
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    </div>
    <div id="donate_guide" class="donate_bar center hidden">
      <div class="row" style="text-align:center;" >
        <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
        <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function(){
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
    </script>
  </div>

  <hr>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      id: '1474819200',
      owner: 'Jin-Yang',
      repo: 'jin-yang.github.com',
      oauth: {
          client_id: '6d89d48ce689192bf95d',
          client_secret: 'c9a720aafb8e3084e3feb46cadee80b03cdc792f',
      },
  });
  gitment.render('gitmentContainer');
  </script>

  <!-- 多说评论框 start -->
  <!--<div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>-->
  <!--
  <div class="ds-thread" data-thread-key="/post/postgresql-pg_rman_init.html" data-title="PG 备份" data-url="/post/postgresql-pg_rman_init.html"></div>
  -->
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <!--
  <script type="text/javascript">
      var duoshuoQuery = {short_name:"jinyangposts"};
      (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
  </script>
  -->
  <!-- 多说公共JS代码 end -->
</div>

    </div>
    <div class="col-lg-3 visible-lg blog-sidebar">
    <center><a href="/"><img src="/images/system/linux-liberty.png" width="200" /></a></center>
<h2>About This Blog</h2>
<div class="sidebar-module">
<p style="text-indent:0em;margin:0px;padding:0px;">This is a personal weblog ^_^ generated with Jekyll, if you like it or have some questions,
just feel free to contact me :)</p>
</div><!-- end of "node" "about" -->



<h2>Recent Posts</h2>
<div class="list-group">
  
    <a class="list-group-item" href="/post/linux-program-cpu-cache-introduce_init.html">CPU Cache</a>
  
    <a class="list-group-item" href="/post/artificial-intelligence-decision-tree-introduce.html">决策树</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-bcc-tools-introduce.html">BCC 工具使用</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-basic-usage-introduce.html">eBPF 简介</a>
  
    <a class="list-group-item" href="/post/math-monte-carlo-sample-introduce.html">采样算法</a>
  
</div>

<h2>Categories</h2>
<ul class="list-group" style="margin:0px;">
  
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#bash"> bash</a>
    <span class="badge">2</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#database"> database</a>
    <span class="badge">86</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#golang"> golang</a>
    <span class="badge">28</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#linux"> linux</a>
    <span class="badge">301</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#misc"> misc</a>
    <span class="badge">244</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#mysql"> mysql</a>
    <span class="badge">79</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#network"> network</a>
    <span class="badge">49</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#postgresql"> postgresql</a>
    <span class="badge">4</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#program"> program</a>
    <span class="badge">138</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#python"> python</a>
    <span class="badge">25</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#react"> react</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#rtems"> rtems</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#sql"> sql</a>
    <span class="badge">10</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#tools"> tools</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#webserver"> webserver</a>
    <span class="badge">25</span>
  </li>
  
</ul><!-- end of "node" "categories" -->

<h2>Related Links</h2>
<ul class="list-group" style="margin:0px">
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.rtems.org" title="To RTEMS"><img class="img-thumbnail img-responsive" src="/images/system/rtems.png"  alt="RTEMS"/></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>RTEMS</strong><br>
        <div class="sidebar-description">Real-Time Executive for Multiprocessor System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.gnu.org" title="To GNU">
       <img class="img-thumbnail img-responsive" src="/images/system/gnu.jpg" alt="GNU" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>GNU</strong><br>
        <div class="sidebar-description">A Unix-linux Operating System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://www.kernel.org" title="To Linux Kernel">
    <img class="img-thumbnail img-responsive" src="/images/system/linux.png"  alt="LINUX" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Linux Kernel</strong><br>
        <div class="sidebar-description">Maintained by Linux Kernel Organization</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://arduino.cc" title="To Arduino">
    <img class="img-thumbnail img-responsive" src="/images/system/arduino.png"  alt="ARDUINO" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Arduino</strong><br>
        <div class="sidebar-description">Open-source Electronic Prototyping Platform</div>
      </div>
    </div>
  </li>
</ul>

<h2>Search</h2>
<div class="sidebar-module">
  <form class="search" method="GET" action="https://www.google.com.hk/search">
    <input type="text" name="q" class="search-query" placeholder=" Search on Google">
    <input type="hidden" name="ie" value="utf-8">
    <input type="submit" name="sa" value="Search" />
  </form><br>
  <input type="text" class="search-field" placeholder=" Search This Site">
  <div class="search-results"></div>
</div>



    </div>
  </div>
<hr><p class="text-center">This Site was built by Jin Yang, generated with Jekyll, and hosted on GitHub Pages<br/> &copy;2013-2019 &ndash; Jin Yang</p><div class="footer-logo"></div>

</div>
</body>
</html>
