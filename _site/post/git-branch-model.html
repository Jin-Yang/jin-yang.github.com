<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <meta name="baidu-site-verification" content="B786jeR0MV" />
  <meta name="msvalidate.01" content="29F791E7F785800340E37AD7C714D2A7" />
  <meta name="google-site-verification" content="p7jJ5d3kF9yxRhpIo5GgHXAZ1ATKVyZhV2kf6mEGOv0" />
  <title>Git 分支管理|JinYang's Blog</title>
  <meta name="keywords" content="git,版本管理,branch,分支">
  <meta name="description" content="相比其它的版本管理软件，git 有很多优点，其中很重要的一个特性就是版本的分支 (branch) 和合并 (merge) 十分方便。git 分支并非生成一个物理代码拷贝，而是只生成一个指向当前版本的指针，又被称为 "快照" (snapshot) ，因此，处理起来是分快速，而且节省空间。接下来，就看看 git 的版本分支管理策略。">

  <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">
  !window.jQuery && document.write('<script src="/static/js/jquery.min.js"><\/script>');
  </script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  !$('body').popover && document.write('<script src="/static/js/bootstrap.min.js"><\/script>');
  </script>
  <script type="text/javascript" src="/static/js/main.js"></script>
  <!-- <link rel="stylesheet prefetch" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/bootstrap.min.css">
  <!-- <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/font-awesome.min.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/pygments.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/screen.css">
  <style type="text/css">
  
    .post-container > p {text-indent: 2em;}
  
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124556620-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124556620-1');
</script>

</head>

<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top navbar-wrapper">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/">Jin-Yang</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li  ><a href="/"> Home </a></li>
        <li  ><a href="/archives.html"> Archive </a></li>
        <li  ><a href="/categories.html"> Categories </a></li>
        <li  ><a href="/projects.html"> Projects </a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Others <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">常用网站</li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.rtems.org/">www.rtems.org</a></li>
            <li><a href="http://www.gnu.org/">www.gnu.org</a></li>
            <li><a href="https://www.kernel.org/">www.kernel.org</a></li>
            <li><a href="https://www.arduino.cc/">www.arduino.cc</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li  ><a href="/about.html"> About </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
    <li data-target="#myCarousel" data-slide-to="4"></li>
  </ol>
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>KISS</h1>
          <h2>Keep It Simple and Stupid.</h2>
          <!--<a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a>-->
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Seize The Day</h1><h1>And Get Busy Living</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Stay hungry</h1><h1>Stay foolish</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
	  <h2>Ever tried, ever failed</h2><h2>No matter, try again</h2><h2>Fail again, fail better</h2>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Nothing is true</h1><h1>Every is permitted</h1>
        </div>
      </div>
    </div>
  </div>
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div><!-- /.carousel -->

<div class="container">
  <div class="row">
    <div class="col-lg-9 blog-main" style="min-width: 500px">
    
<div class="post-container">
  <div class="blog-header">
    <h1>Git 分支管理</h1>
    <div class="post-description">
      <i class="fa fa-calendar"></i> 2015-08-23 Sunday &nbsp; &nbsp;
      <i class="fa fa-tags"></i>  linux ,  misc  
      
    </div>
  </div>
  <hr>
  <p>相比其它的版本管理软件，git 有很多优点，其中很重要的一个特性就是版本的分支 (branch) 和合并 (merge) 十分方便。</p>

<p>git 分支并非生成一个物理代码拷贝，而是只生成一个指向当前版本的指针，又被称为 “快照” (snapshot) ，因此，处理起来是分快速，而且节省空间。</p>

<p>接下来，就看看 git 的版本分支管理策略。</p>

<!-- more -->

<h2 id="分支">分支</h2>

<p>Git 版本的分支 (branch) 和合并 (merge) 十分方便，只生成一个指向当前版本的指针 (称为 “快照”)，而非生成一份现有代码的物理拷贝，所以非常快捷易用。</p>

<p>更加详细的内容可以查看 <a href="https://git-scm.com/book/en/v2/Git-Branching-Branches-in-a-Nutshell">Git Branching</a> 。</p>

<h3 id="追踪分支">追踪分支</h3>

<p>追踪分支是用与联系本地分支和远程分支，在追踪分支 (Tracking Branches) 上执行 push 或 pull 时，会自动关联到远程分支上；如果要经常从远程仓库里拉取分支到本地，而且想简单使用 <code>git pull</code> 命令，那么就应当使用 “追踪分支” 。</p>

<p>可以通过如下命令手动创建一个追踪分支。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git branch --track experimental origin/experimental</code></pre></figure>

<p>当运行 <code>git pull experimental</code> 命令时，会自动从 <code>origin/experimental</code> fetch 内容，然后再将该分支 merge 进本地的 <code>experimental</code> 分支。</p>

<p>当要把修改 push 到 origin 时, 它会将你本地的 <code>experimental</code> 分支中的修改推送到 <code>origin/experimental</code> 分支里，而且无需指定 origin 。</p>

<h3 id="fast-forward">fast-forward</h3>

<p>当前分支合并到另一分支时，当没分歧解决时就会直接移动文件指针，这就被叫做 fast-forward 。</p>

<p>举例来说，一直在 develop 分支开发，然后新建了一个 feature 分支，并在该分支上进行一系列提交，完成后，回到 develop 分支，此时，如果 develop 分支在创建 feature 分支后从未产生任何新的提交，此时的合并就叫 fast forward 。</p>

<p><strong>注意</strong>：可以看出这次合并完之后的视图为扁平状，看不出 feature 分支开发的任何信息。</p>

<p><img src="/images/misc/git-develop-model-no-ff-means.png" alt="git develop model no-ff means" title="git develop model no-ff means" class="pull-center" width="70%" /></p>

<p>另外，可以使用 <code>--no-ff</code> (no fast foward) 进行合并，使得每一次的合并都创建一个新的 commit 记录，并强制保留 feature 分支的开发记录，也就告诉后来者 <strong>一系列的提交都是为了同一个目的</strong> 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">[branch &quot;master&quot;]
mergeoptions = --no-commit --no-ff</code></pre></figure>

<p>如果远程和本地分支的提交线图有分叉，也即不能 fast-forwarded，git 会执行一次 merge 操作，也就是产生一次没意义的提交记录，从而造成提交日志比较混乱。</p>

<h4 id="rebase-vs-no-ff">rebase VS. no-ff</h4>

<p>pull 时可以使用 <code>git pull --rebase</code> 选项，也即当提交线图有分叉的话，git 会用 rebase 策略来代替默认的 merge 策略，可以通过 <code>man git-merge</code> 查看详细内容，其好处介绍如下。</p>

<p>假设提交线图在执行 pull 前是这样的：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">                 A---B---C  remotes/origin/master
                /
           D---E---F---G  master</code></pre></figure>

<p>如果是执行 <code>git pull</code> 后，提交线图会变成这样：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">                 A---B---C remotes/origin/master
                /         \
           D---E---F---G---H master</code></pre></figure>

<p>结果多出了 H 这个没必要的提交记录，如果执行 <code>git pull --rebase</code> 的话，提交线图会变成如下：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">                       remotes/origin/master
                           |
           D---E---A---B---C---F&#39;---G&#39;  master</code></pre></figure>

<p>F G 两个提交通过 rebase 方式重新拼接在 C 之后，多余的分叉去掉了，目的达到。大多数时候，使用 <code>git pull --rebase</code> 是为了使提交线图更好看，从而方便 code review 。</p>

<!--
不过，如果你对使用 git 还不是十分熟练的话，我的建议是 git pull --rebase 多练习几次之后再使用，因为 rebase 在 git 中，算得上是『危险行为』。
另外，还需注意的是，使用 git pull --rebase 比直接 pull 容易导致冲突的产生，如果预期冲突比较多的话，建议还是直接 pull。
-->

<h4 id="最佳实践">最佳实践</h4>

<p>在合并分支之前，例如要在本地将 feature 分支合并到 dev 分支，会先检查 feature 分支是否落后于远程 dev 分支：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git checkout dev
$ git fetch                   ← 更新dev分支，pull&lt;=&gt;fetch+merge
$ git log feature..dev</code></pre></figure>

<p>如果没有输出任何提交信息的话，即表示 feature 对于 dev 分支是 up-to-date 的，如果有输出的而马上执行了 <code>git merge --no-ff</code> 的话，提交线图会变成上图的左侧。</p>

<!--
所以这时在合并前，通常我会先执行：
git checkout feature
git rebase dev
这样就可以将 feature 重新拼接到更新了的 dev 之后，然后就可以合并了，最终得到一个干净舒服的提交线图。
再次提醒：像之前提到的，rebase 是『危险行为』，建议你足够熟悉 git 时才这么做，否则的话是得不偿失啊。
-->

<h3 id="常用场景">常用场景</h3>

<p>如上是从现有代码中 clone 并查看分支，进行开发。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 1. 克隆代码，可以指定分支或者tag，默认是master
$ git clone -b &lt;branch/tag&gt; https://github.com/master-dev.git

----- 2. 查看所有分支，有master(本地主分支)、origin/master(远程主分支)、其它(如origin/dev)
-----    默认两个master关联，保持同步；由于dev本地没有关联，从而无法在那里开发
$ git branch --all                    ← 查看包括本地以及远程分支
$ git branch                          ← 只查看本地分支

----- 3. 创建本地关联origin/dev的分支
-----    默认本地dev分支的初始代码和远程的dev分支代码一样
$ git checkout dev origin/dev

----- 4. 切换到dev分支进行开发
$ git checkout dev</code></pre></figure>

<p>接下来看看如何从无到有新建分支，并提交到远端。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 完整命令
$ git push &lt;remote-host&gt; &lt;local-branch&gt;:&lt;remote-branch&gt;

----- 1. 创建本地新的hello分支
$ git branch hello                    ← 创建本地分支
$ git branch                          ← 查看本地分支

----- 2. 将hello分支发布到远程仓库
$ git push origin dev:dev

----- 3. 删除远程分支
$ git branch -r -d origin/branch-name
$ git push origin :branch-name</code></pre></figure>

<p>实际上，第一步创建完本地分支后，该本地分支远程仓库并不知道，此时可以在本地分支开发，然后 merge 到 master ，使用 master 同步代码。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 1. 创建本地新的hello分支
$ git branch hello                    ← 创建本地分支

----- 2. 切换到hello分支开发代码
$ git checkout hello

----- 3. 开发完成后，合并主分支
$ git checkout master                 ← 切换到主分支
$ git merge hello                     ← 把hello分支的更改合并到master
$ git push                            ← 提交主分支代码远程

----- 4. 删除本地分支
$ git branch -d hello</code></pre></figure>

<p><strong>注意</strong>：在分支切换之前最好先commit全部的改变，除非你真的知道自己在做什么</p>

<h3 id="合并冲突">合并冲突</h3>

<p>作为分布式版本控制系统，所有修改操作都是基于本地的，在团队协作时，如果同时修改了相同的代码，而你同伴先于你 push 到远端，那么你必须先 pull 做本地合并，然后在 push 到远程。</p>

<p>当在合并的时候，可能会出现代码冲突。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 0. 尝试合并
$ git checkout master
$ git merge hello

----- 1. 发生冲突时，将会暂停合并，可以通过如下命令查看冲突文件
$ git status</code></pre></figure>

<p>当查看冲突的文件时，显示的内容如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:index.html
&lt;div id=&quot;footer&quot;&gt;contact : email.support@domain.com&lt;/div&gt;
=======
&lt;div id=&quot;footer&quot;&gt;
 please contact us at support@domain.com
&lt;/div&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; foobar:index.html</code></pre></figure>

<p>其中冲突的两个分支的内容通过 <code>======</code> 进行分割，解决冲突后，其内容如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&lt;div id=&quot;footer&quot;&gt;
 please contact us at support@domain.com
&lt;/div&gt;</code></pre></figure>

<p>然后，通过 <code>git add index.html</code> 命令标记下，表示现在已经解决了冲突；当然，也可以使用 <code>git mergetool</code> 工具。</p>

<h4 id="其它">其它</h4>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git branch -v
$ git branch --merged
$ git branch --no-merged

----- 获取某个分支
$ git clone http://github.com/project/foobar.git    # 只能获取默认的分支，一般是master，可以手动设置
$ git branch -a                                     # 查看所有分支
$ git checkout -b dev origin/dev                    # 获取其它分支</code></pre></figure>

<h2 id="经典-branch-工作模式">经典 branch 工作模式</h2>

<p>如下是一个不错的代码管理模式，详细的可以参考 <a href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a>，也可以查看 <a href="/reference/misc/A successful Git branching model.mht">本地文档</a> ，如下是一个简单介绍。</p>

<p><img src="/images/misc/git-develop-model.png" alt="git development model" title="git development model" class="pull-center" width="90%" /></p>

<p>从上图可以看到主要包含下面几个分支，简单介绍如下：</p>

<ul>
  <li>master: 主分支，用来版本发布，通常</li>
  <li>develop：日常开发分支，保存了开发的最新代码，用于每天的回归测试；</li>
  <li>feature：新的特性或者功能开发分支，只与 develop 分支交互；</li>
  <li>release：预发布分支，在特性开发基本测试完成后，准备发布前，用于发布前最后测试；</li>
  <li>hotfix：线上 bug 修复分支。</li>
</ul>

<p>接下来详细介绍。</p>

<blockquote>
  <p>NOTE: 如下的介绍中有个 bump-version.sh 脚本，该脚本的作用是，将源码中与版本号相关的内容替换为最新的值，然后用于发布。其中 Github 上有个相关的版本，可以参考 <a href="https://github.com/peritus/bumpversion">Github bumpversion</a> 。</p>
</blockquote>

<h3 id="main-branches">Main Branches</h3>

<p>含两个主分支 master 和 develop ，其中 origin/master 表示主分支， HEAD 始终是用于生产环境的代码。而 origin/develop 表示主开发分支，其中的 HEAD 表示最新提交的代码，这也就是每天用来编译测试的代码。</p>

<p><img src="/images/misc/git-master-develop.png" alt="git master develop" title="git master develop" class="pull-center" width="50%" /></p>

<p>当开发分支的代码趋于稳定之后，且准备发布时，只需要打个发布的版本号标签 (tag) 即可。</p>

<p>因此，每次提交到主干时，也就意味着这是一个新的生产版本的发布，那么可以通过一个 hook 自动编译，生成生产环境的安装包。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 新建一个仓库，默认会有一个master分支
$ git init
$ echo &#39;Hello World!&#39; &gt; README
$ git add README
$ git commit -m &#39;Initial Commit&#39;

----- 新建一个develop分支
$ git branch develop</code></pre></figure>

<p>上述的 main 和 develop 都可以称之为主干分支。</p>

<p>除了主干的分支外，还包括了一些其它分支，区别是这些分支有固定的生命周期，包括了 Feature Branches、Release Branches、Hotfix Branches 三种针对不同的场景，也对应了如何获取分支以及如何合并分支。</p>

<p>如上介绍的三种分支也可以被称为 Support Branches，接下来详细介绍这三种分支。</p>

<h3 id="feature-branches">Feature Branches</h3>

<p>特性分支用来开发一个新的特性，这一分支从 develop 创建，而且最终会合并到 develop 分支；当然，也有可能最终取消掉，这取决于最终产品的决策。</p>

<p><img src="/images/misc/git-develop-model-feature-branches.png" alt="git develop model feature branches" title="git develop model feature branches" class="pull-center" width="20%" /></p>

<p>接下来看看如何使用。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 0. 创建新的特性分支
$ git checkout -b feature-foobar develop

----- 1. 执行一些操作，多次提交
$ echo &quot;FOOBAR Feature 1&quot; &gt;&gt; README
$ git commit -a -m &quot;foobar feature 1&quot;
$ echo &quot;FOOBAR Feature 2&quot; &gt;&gt; README
$ git commit -a -m &quot;foobar feature 2&quot;

----- 2.1 开发完成，接下来准备合并，先切换到develop分支
$ git checkout develop

----- 2.2 合并到develop主分支
$ git merge --no-ff feature-foobar

----- 2.3 删除原来的分支
$ git branch -d feature-foobar

----- 2.4 提交到远程仓库
$ git push origin develop</code></pre></figure>

<p>另外，需要注意的是，上述合并到主分支的时候，采用的是 --no-ff 模式。</p>

<p><img src="/images/misc/git-develop-model-no-ff-means.png" alt="git develop model no-ff means" title="git develop model no-ff means" class="pull-center" width="70%" /></p>

<p>该参数的作用是强行关闭 fast-forward 方式，该方式就是当条件允许的时候，git 直接把 HEAD 指针指向合并分支的头，完成合并。不过如果删除分支，由于这个过程中没有创建 commit，则会丢失分支信息，使用该参数将保留分支 commit 历史。</p>

<p>实际上，通过 git log 查看时，使用 --on-ff 会强制添加 commit ，否则看不到合并的信息。</p>

<!--
git merge --squash 是用来把一些不必要commit进行压缩，比如说，你的feature在开发的时候写的commit很乱，那么我们合并的时候不希望把这些历史commit带过来，于是使用--squash进行合并，此时文件已经同合并后一样了，但不移动HEAD，不提交。需要进行一次额外的commit来“总结”一下，然后完成最终的合并。
-->

<p>另外，还有个参数 --squash，会把多次分支 commit 历史压缩为一次。</p>

<h3 id="release-branches">Release Branches</h3>

<p>用于正式发布前的最后测试，尽量减少 bug 数目，添加元信息 (版本号以及发布日期等)。该分支从 develop 创建，可以合并到 develop 或者 master 分支，其命名为 release-* 。</p>

<p>合并到 master 之后就可以用于发布了，而之所以合并到 develop ，是为了将最新修改合并到新的开发分支。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 1. 创建分支，并更新文件一些头部信息等，然后提交
$ git checkout -b release-1.2 develop
$ ./bump-version.sh 1.2
$ git commit -a -m &quot;Bumped version number to 1.2&quot;

----- 2. 测试没有问题后，准备正式发布
$ git checkout master
$ git merge --no-ff release-1.2
$ git tag -a 1.2

----- 3. 删除release分支
$ git checkout develop
$ git merge --no-ff release-1.2
$ git branch -d release-1.2</code></pre></figure>

<h3 id="hotfix-branches">Hotfix Branches</h3>

<p>该分支由于修复线上 bug，当线上代码出现 bug 时，从 master 开一个 hotfix 分支，修复 bug 之后再将 hotfix 分支合并到 master 分支并进行发布，同时也需要合并到 develop 分支上去。</p>

<p><img src="/images/misc/git-develop-model-hotfix-branch.png" alt="git develop model hotfix branch" title="git develop model hotfix branch" class="pull-center" width="50%" /></p>

<p>可以发现，hotfix 和 release 分支功能类似，两者好处是不会打断 develop 分支正常功能开发。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 1. 从master获取分支
$ git checkout -b hotfix-1.2.1 master
$ ./bump-version.sh 1.2.1
$ git commit -a -m &quot;Bumped version number to 1.2.1&quot;

----- 2. 然后修改代码修复bug，并提交
$ git commit -m &quot;Fixed severe production problem&quot;

----- 3. bug修复后，将该分支合并到master
$ git checkout master
$ git merge --no-ff hotfix-1.2.1
$ git tag -a 1.2.1

----- 4. 然后将hotfix合并到develop分支
$ git checkout develop
$ git merge --no-ff hotfix-1.2.1

----- 5. 删除hotfix分支
$ git branch -d hotfix-1.2.1</code></pre></figure>

<h2 id="git-flow">git-flow</h2>

<p><a href="https://github.com/nvie/gitflow">git-flow</a> 提供了很多不错的脚本，来支持上述的这种开发模式，不过它并没有提供重置 (rebase) 特性分支的能力，安装方式可以参考 <a href="https://github.com/nvie/gitflow/wiki/Installation">gitflow-installation</a> 。</p>

<p>该工具集成了一些常见的命令，每次操作实际都会提示一些操作记录。</p>

<h3 id="安装">安装</h3>

<p>可以直接从 <a href="https://raw.githubusercontent.com/nvie/gitflow/develop/contrib/gitflow-installer.sh">github gitflow/contrib/gitflow-installer.sh</a> 下载文件，然后执行如下命令即可。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 安装
$ wget --no-check-certificate -q https://raw.githubusercontent.com/.../gitflow-installer.sh
# bash gitflow-installer.sh install stable
$ rm gitflow-installer.sh

----- 删除
# bash gitflow-installer.sh uninstall</code></pre></figure>

<p>实际上很简单，只是将代码 clone 到本地，然后通过 install 命令安装；当然，也可以离线安装，该模块会依赖于 <a href="https://github.com/nvie/shFlags">github - nvie/shFlags</a>，直接将该代码下载并放置到源码的 shFlags 目录下即可。</p>

<p>最后，通过 <code>make install</code> 安装，也可以执行如下步骤，不过需要修改安装脚本的代码，注释掉下载代码的步骤。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ tar -xf gitflow-x.x.x.tar.gz shFlags-x.x.x.tar.gz
$ mv gitflow-x.x.x gitflow &amp;&amp; rm gitflow/shFlags -rf
$ mv shFlags-x.x.x gitflow/shFlags
# bash gitflow/contrib/gitflow-installer.sh</code></pre></figure>

<h3 id="初始化">初始化</h3>

<p>使用 git-flow 时，需要从初始化一个 git 库开始，其中命令如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow init
No branches exist yet. Base branches must be created now.
Branch name for production releases: [master]
Branch name for &quot;next release&quot; development: [develop]

How to name your supporting branch prefixes?
Feature branches? [feature/]
Release branches? [release/]
Hotfix branches? [hotfix/]
Support branches? [support/]
Version tag prefix? []</code></pre></figure>

<p>主要是回答几个关于分支的命名约定，建议使用默认值。</p>

<p>对于最后的 tag 选项，可以设置为软件的名称，例如 <code>foobar-</code>，然后 Release Branches 的名称使用类似 <code>v1.1.0</code> 名称，那么最终的 tag 名即为 <code>foobar-v1.1.0</code> 。</p>

<p>关于该 tag 的信息可以通过 <code>git show foobar-v1.1.0</code> 命令查看。</p>

<h3 id="新特性">新特性</h3>

<p>关于新特性的开发流程，为即将发布的版本开发新功能特性，这通常只存在开发者的库中。</p>

<h4 id="增加新特性">增加新特性</h4>

<p>新特性的开发是基于 ‘develop’ 分支的，可以通过下面的命令开始开发新特性：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow feature start MYFEATURE</code></pre></figure>

<p>这个操作创建了一个基于 ‘develop’ 的特性分支，并切换到这个分支之下。</p>

<h4 id="完成新特性">完成新特性</h4>

<p>完成开发新特性之后，执行下面的操作，主要是合并 MYFEATURE 分支到 ‘develop’，并删除这个新特性分支，然后切换回 ‘develop’ 分支。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow feature finish MYFEATURE</code></pre></figure>

<h4 id="发布新特性">发布新特性</h4>

<p>主要用于合作开发一新特性，将新特性分支发布到远程服务器，这样其他用户可以使用该分支。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow feature publish MYFEATURE</code></pre></figure>

<h4 id="取得新特性分支">取得新特性分支</h4>

<p>主要用于取得其他用户发布的新特性分支，并签出远程的变更，主要有如下的两种方式。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 签出特性分支变更
$ git flow feature pull origin MYFEATURE

----- 跟踪特性分支变更
$ git flow feature track MYFEATURE</code></pre></figure>

<h3 id="预发布版本">预发布版本</h3>

<p>该分支准备开始发布，用于支持一个新的用于生产环境的发布版本，允许修正小问题 (bug)，但不新增特性，并为发布版本准备元数据。</p>

<h4 id="准备">准备</h4>

<p>开始准备预发布版本，它从 ‘develop’ 分支开始创建一个 release 分支。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow release start RELEASE [BASE]</code></pre></figure>

<p>可以选择一个 [BASE] 参数，这是 ‘develop’ 分支提交记录的 hash 值。</p>

<p>创建 release 分支之后，可以立即发布到远端，从而允许其它用户向这个 release 分支提交代码，该命令十分类似发布新特性：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 提交到远端
$ git flow release publish RELEASE

----- 签出release版本的远程变更
$ git flow release track RELEASE</code></pre></figure>

<h4 id="完成预发布版本">完成预发布版本</h4>

<p>完成 release 版本分支操作，主要执行下面几个动作：A) 合并 release 分支到 master 分支；B) 用 release 分支名打 tag；C) 归并 release 分支到 develop；D) 移除 release 分支。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow release finish RELEASE</code></pre></figure>

<h3 id="紧急修复">紧急修复</h3>

<p>当生产环境的版本突然发现一个严重 bug 时，需要立即修正；此时，有可能是需要修正 master 分支上某个 tag 标记的生产版本。</p>

<h4 id="开始">开始</h4>

<p>像其它 git flow 命令一样, 可以通过如下命令创建一个紧急修复分支。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow hotfix start VERSION [BASENAME]</code></pre></figure>

<p>VERSION 参数标记着修正版本，可以从 [BASENAME] 开始，[BASENAME] 为 finish release 时填写的版本号。</p>

<h4 id="完成">完成</h4>

<p>当完成紧急修复分支后，代码归并回 develop 和 master 分支，相应地，master 分支打上修正版本的 tag 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ git flow hotfix finish VERSION</code></pre></figure>

<h3 id="其它-1">其它</h3>

<h5 id="unable-to-start-editor">unable to start editor</h5>

<p>可以通过 <code>git config --global core.editor "vim"</code> 命令设置。</p>

<h2 id="参考">参考</h2>

<p>关于 Git 的分支介绍可以参考 <a href="https://git-scm.com/doc">git-scm.com/doc</a> 中的介绍，另外，还有一本不错介绍 Git 的资料 <a href="http://git-scm.com/book/">Pro Git Book</a>；另外一个不错的文档 <a href="http://marklodato.github.io/visual-git-guide/index-zh-cn.html">图解Git</a>，或者 <a href="/reference/misc/git_graphs.mht">本地文档</a> 。</p>

<p>对于一种不错的 Git 分支管理模式，也即如上的介绍，可以参考 <a href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a> 或者 <a href="/reference/misc/A successful Git branching model.mht">本地文档</a> 。</p>

<!--
http://www.worldhello.net/gotgithub/index.html

http://www.cnblogs.com/zhangjing230/archive/2012/05/09/2489745.html

http://www.cnblogs.com/ctrlzhang/p/5195079.html

https://www.oschina.net/news/70368/git-advanced-commands

http://blog.csdn.net/wirelessqa/article/details/20152353

git-filter-branch.sh

https://github.com/git/git
-->


  <hr>
  <nav>
    <ul class="pager">
         <li class="previous"><a href="/post/centos-config-from-scratch.html" title="CentOS 安装与配置">&larr; Older</a></li> 
         <li class="next"><a href="/post/mysql-high-availability_init.html" title="MySQL 高可用">Newer &rarr;</a></li> 
    </ul>
  </nav><br>
<!--
  <hr><div id="section-donate"><span>赏</span></div><br>
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p><br>
  <div class="row" style="text-align:center;" >
    <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
    <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
  </div><br><hr>
-->
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p>
  <div id="donate_module">
    <style type="text/css">
      .donate_bar a.btn_donate{
        display: inline-block;
        position:      relative;
        text-align:    center;
        width: 82px;
        height: 82px;
        background: url("/images/misc/btn_reward.gif") no-repeat;
        _background: url("/images/misc/btn_reward.gif") no-repeat;
        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
      }
      .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
      .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
      }
    </style>
    <div id="donate_board" class="donate_bar row" style="text-align:center;" >
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    </div>
    <div id="donate_guide" class="donate_bar center hidden">
      <div class="row" style="text-align:center;" >
        <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
        <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function(){
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
    </script>
  </div>

  <hr>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      id: '1440259200',
      owner: 'Jin-Yang',
      repo: 'jin-yang.github.com',
      oauth: {
          client_id: '6d89d48ce689192bf95d',
          client_secret: 'c9a720aafb8e3084e3feb46cadee80b03cdc792f',
      },
  });
  gitment.render('gitmentContainer');
  </script>

  <!-- 多说评论框 start -->
  <!--<div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>-->
  <!--
  <div class="ds-thread" data-thread-key="/post/git-branch-model.html" data-title="Git 分支管理" data-url="/post/git-branch-model.html"></div>
  -->
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <!--
  <script type="text/javascript">
      var duoshuoQuery = {short_name:"jinyangposts"};
      (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
  </script>
  -->
  <!-- 多说公共JS代码 end -->
</div>

    </div>
    <div class="col-lg-3 visible-lg blog-sidebar">
    <center><a href="/"><img src="/images/system/linux-liberty.png" width="200" /></a></center>
<h2>About This Blog</h2>
<div class="sidebar-module">
<p style="text-indent:0em;margin:0px;padding:0px;">This is a personal weblog ^_^ generated with Jekyll, if you like it or have some questions,
just feel free to contact me :)</p>
</div><!-- end of "node" "about" -->



<h2>Recent Posts</h2>
<div class="list-group">
  
    <a class="list-group-item" href="/post/linux-program-cpu-cache-introduce_init.html">CPU Cache</a>
  
    <a class="list-group-item" href="/post/artificial-intelligence-decision-tree-introduce.html">决策树</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-bcc-tools-introduce.html">BCC 工具使用</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-basic-usage-introduce.html">eBPF 简介</a>
  
    <a class="list-group-item" href="/post/math-monte-carlo-sample-introduce.html">采样算法</a>
  
</div>

<h2>Categories</h2>
<ul class="list-group" style="margin:0px;">
  
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#bash"> bash</a>
    <span class="badge">2</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#database"> database</a>
    <span class="badge">86</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#golang"> golang</a>
    <span class="badge">28</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#linux"> linux</a>
    <span class="badge">301</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#misc"> misc</a>
    <span class="badge">244</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#mysql"> mysql</a>
    <span class="badge">79</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#network"> network</a>
    <span class="badge">49</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#postgresql"> postgresql</a>
    <span class="badge">4</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#program"> program</a>
    <span class="badge">138</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#python"> python</a>
    <span class="badge">25</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#react"> react</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#rtems"> rtems</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#sql"> sql</a>
    <span class="badge">10</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#tools"> tools</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#webserver"> webserver</a>
    <span class="badge">25</span>
  </li>
  
</ul><!-- end of "node" "categories" -->

<h2>Related Links</h2>
<ul class="list-group" style="margin:0px">
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.rtems.org" title="To RTEMS"><img class="img-thumbnail img-responsive" src="/images/system/rtems.png"  alt="RTEMS"/></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>RTEMS</strong><br>
        <div class="sidebar-description">Real-Time Executive for Multiprocessor System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.gnu.org" title="To GNU">
       <img class="img-thumbnail img-responsive" src="/images/system/gnu.jpg" alt="GNU" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>GNU</strong><br>
        <div class="sidebar-description">A Unix-linux Operating System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://www.kernel.org" title="To Linux Kernel">
    <img class="img-thumbnail img-responsive" src="/images/system/linux.png"  alt="LINUX" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Linux Kernel</strong><br>
        <div class="sidebar-description">Maintained by Linux Kernel Organization</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://arduino.cc" title="To Arduino">
    <img class="img-thumbnail img-responsive" src="/images/system/arduino.png"  alt="ARDUINO" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Arduino</strong><br>
        <div class="sidebar-description">Open-source Electronic Prototyping Platform</div>
      </div>
    </div>
  </li>
</ul>

<h2>Search</h2>
<div class="sidebar-module">
  <form class="search" method="GET" action="https://www.google.com.hk/search">
    <input type="text" name="q" class="search-query" placeholder=" Search on Google">
    <input type="hidden" name="ie" value="utf-8">
    <input type="submit" name="sa" value="Search" />
  </form><br>
  <input type="text" class="search-field" placeholder=" Search This Site">
  <div class="search-results"></div>
</div>



    </div>
  </div>
<hr><p class="text-center">This Site was built by Jin Yang, generated with Jekyll, and hosted on GitHub Pages<br/> &copy;2013-2019 &ndash; Jin Yang</p><div class="footer-logo"></div>

</div>
</body>
</html>
