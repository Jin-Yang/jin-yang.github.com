<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <meta name="baidu-site-verification" content="B786jeR0MV" />
  <meta name="msvalidate.01" content="29F791E7F785800340E37AD7C714D2A7" />
  <meta name="google-site-verification" content="p7jJ5d3kF9yxRhpIo5GgHXAZ1ATKVyZhV2kf6mEGOv0" />
  <title>TMUX 简介|JinYang's Blog</title>
  <meta name="keywords" content="linux,工具,tmux">
  <meta name="description" content="TMUX 类似于 screen，是一个窗口管理器，而且功能更加强大，提供了强劲的、易于使用的命令行界面，可横向和纵向分割窗口，支持 UTF-8 编码及 256 色终端等特性。">

  <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">
  !window.jQuery && document.write('<script src="/static/js/jquery.min.js"><\/script>');
  </script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  !$('body').popover && document.write('<script src="/static/js/bootstrap.min.js"><\/script>');
  </script>
  <script type="text/javascript" src="/static/js/main.js"></script>
  <!-- <link rel="stylesheet prefetch" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/bootstrap.min.css">
  <!-- <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/font-awesome.min.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/pygments.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/screen.css">
  <style type="text/css">
  
    .post-container > p {text-indent: 2em;}
  
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124556620-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124556620-1');
</script>

</head>

<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top navbar-wrapper">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/">Jin-Yang</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li  ><a href="/"> Home </a></li>
        <li  ><a href="/archives.html"> Archive </a></li>
        <li  ><a href="/categories.html"> Categories </a></li>
        <li  ><a href="/projects.html"> Projects </a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Others <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">常用网站</li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.rtems.org/">www.rtems.org</a></li>
            <li><a href="http://www.gnu.org/">www.gnu.org</a></li>
            <li><a href="https://www.kernel.org/">www.kernel.org</a></li>
            <li><a href="https://www.arduino.cc/">www.arduino.cc</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li  ><a href="/about.html"> About </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
    <li data-target="#myCarousel" data-slide-to="4"></li>
  </ol>
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>KISS</h1>
          <h2>Keep It Simple and Stupid.</h2>
          <!--<a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a>-->
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Seize The Day</h1><h1>And Get Busy Living</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Stay hungry</h1><h1>Stay foolish</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
	  <h2>Ever tried, ever failed</h2><h2>No matter, try again</h2><h2>Fail again, fail better</h2>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Nothing is true</h1><h1>Every is permitted</h1>
        </div>
      </div>
    </div>
  </div>
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div><!-- /.carousel -->

<div class="container">
  <div class="row">
    <div class="col-lg-9 blog-main" style="min-width: 500px">
    
<div class="post-container">
  <div class="blog-header">
    <h1>TMUX 简介</h1>
    <div class="post-description">
      <i class="fa fa-calendar"></i> 2014-05-21 Wednesday &nbsp; &nbsp;
      <i class="fa fa-tags"></i>  linux  
      
    </div>
  </div>
  <hr>
  <p>TMUX 类似于 screen，是一个窗口管理器，而且功能更加强大，提供了强劲的、易于使用的命令行界面，可横向和纵向分割窗口，支持 UTF-8 编码及 256 色终端等特性。</p>

<p>接下来简单介绍下 TMUX 的使用。</p>

<!-- more -->

<h2 id="简介">简介</h2>

<p>如上所述 tmux 是一个终端复用软件，类似于 GUN Screen，tmux 可以在终端中使用，同时可以在 ssh 中使用，其中可以开启多个控制台。</p>

<p><img src="/images/linux/tmux-examples.png" alt="tmux examples" class="pull-center" width="95%" /></p>

<p>上图是官网上的一个截图，将屏幕分为了多个窗口，方便进行管理。</p>

<p>tmux 使用 C/S 模型构建，分为以下单元模块：</p>

<ul>
  <li>
    <p>Server，服务器。一个 tmux 命令执行后启动一个 tmux 服务；</p>
  </li>
  <li>
    <p>Session，会话。一个 tmux 服务可以拥有多个 session ，一个 session 可以看作是 tmux 管理下的伪终端的一个集合；</p>
  </li>
  <li>
    <p>Window，窗口。一个 session 可能会有多个 window 与之关联，每个 window 都是一个伪终端，会占据整个屏幕；</p>
  </li>
  <li>
    <p>Pane，面板。一个 window 可以被分割成多个 pane ，每个都是一个 pty ，可以通过 tty 命令查看。</p>
  </li>
</ul>

<p>基本结构如下图所示。</p>

<p><img src="/images/linux/tmux-session-window-pane.jpg" alt="network" class="pull-center" /></p>

<p>tmux 所支持的特性包括了：</p>

<ul>
  <li>
    <p>支持 UTF-8 编码及 256 色终端。</p>
  </li>
  <li>
    <p>可在多个缓冲区进行复制和粘贴。</p>
  </li>
  <li>
    <p>可通过交互式菜单来选择窗口、会话及客户端。</p>
  </li>
  <li>
    <p>支持跨窗口搜索。</p>
  </li>
  <li>
    <p>支持自动及手动锁定窗口。</p>
  </li>
</ul>

<p>另外，通过 libevent 提供高性能。</p>

<h3 id="安装">安装</h3>

<p>在 CentOS 中可以通过 yum 安装，也可以按照如下方式，采用源码安装。先从 <a href="http://tmux.sourceforge.net/">tmux.sourceforge.net</a> 上下载源码。tmux 需要有 ncurses 和 libevent 的支持，需要 libevent-2.0 版本，而通过 yum 只能安装低版本的，所以使用源码编译，安装过程如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># yum install ncurses-devel         # 安装 ncurses 和 libevent 库
$ cd ~/libevent2
$ ./configure --prefix=/usr/local
$ make
# make install

$ cd ~/tmux                              # 编译安装 tmux
$ LDFLAGS=&quot;-L/usr/local/lib -Wl,-rpath=/usr/local/lib&quot; ./configure --prefix=/usr/local
$ make
# make install</code></pre></figure>

<p>在 Ubuntu 中可以通过 apt-get install tmux 直接安装。</p>

<h3 id="启动">启动</h3>

<p>第一次会产生一个新的 session 和 window ，在下方会显示其状态，如果意外断开 (detach) 连接，session 仍会在后台运行，每个窗口可以分为多个 pane 。</p>

<p>启动时的参数选项有：</p>

<ul>
  <li>-2: 强制 tmux 假设终端支持 256 色。</li>
  <li>-8: 类似于 -2 ，不过是强制 tmux 假设终端支持 88 色。</li>
  <li>-c shell-command: 使用默认的 shell 执行命令，主要用于当 tmux 作为 login shell 时使用。</li>
  <li>-f file: 指定配置文件，默认检查 /etc/tmux.conf、~/.tmux.conf，如果有命令错误，则会直接退出。</li>
  <li>-V: 查看版本号。</li>
</ul>

<p>默认 tmux 会创建的匿名的 session ，可以通过如下命令创建一个命名的 session ， Ctrl-b 是命令前缀(Command prefix)，通过前缀告知 tmux 下面的命令是发给 tmux 的，而非终端。常见的操作如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ tmux new-session -s basic    # 创建一个名为 basic 的 session
$ tmux new -s basic -d         # 同上，但是不会连接到终端，在后台运行
$ tmux new -s basic -n win     # 同上，并将第一个窗口命令为 win
[Ctrl-b d]                     # detach

$ tmux ls                      # 列出现在的 sessions ，等同 tmux list-sessioin
$ tmux attach                  # 如果只有一个 session
$ tmux attach -t basic         # 指定名称，-t 表示 target

$ tmux kill-session -t basic   # 关闭一个 session</code></pre></figure>

<p>如下是各种常用的命令。</p>

<h2 id="常用快捷键">常用快捷键</h2>

<p>默认采用 Ctrl-b 作为 prefix，用于激活控制台。</p>

<h3 id="常见操作">常见操作</h3>

<p>如何在 tmux 内新建会话。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">?                                 → 列出所有快捷键，按q返回
r                                 → 强制重绘未脱离的会话口，等同于刷新
~                                 → 列出提示信息缓存；包含了tmux返回的各种提示信息
source-file ~/.tmux.conf          → 重新设置完配置文件后，使用该命令刷新
:                                 → 进入命令行模式，如kill-server可以关闭服务器

d                                 → 脱离(detach)当前会话，仍在后台运行
D                                 → 通过列表选择需要退出的会话
$ tmux attach -t work             → 通过attach命令重新连接

s                                 → 列出所有会话，选择切换会话
(                                 → 切换到前一个Session
)                                 → 切换到后一个Session

:resize-pane -L|D|R|U [NUM]       → 将pane左|下|右|上移动NUM行，默认是1行
:set-option -g status-interval 40 → 设置状态栏的更新时间，单位为秒</code></pre></figure>

<!--
[  进入复制模式；此时的操作与vi/emacs相同，按q/Esc退出，修改为y</li><li>
:new-windos
/new-session -n name ["command"] 新建一个窗口，并在窗口中执行 command 命令；如果指定命令，当命令退出时，窗口同样关闭。</li><li>
-->

<h3 id="窗口windows操作">窗口(Windows)操作</h3>

<p>如果窗口没有命名，会以当前命令作为窗口名。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">c                                 → 创建新窗口
&amp;                                 → 关闭当前窗口，也可以使用exit命令
,                                 → 重命名当前窗口，这样便于识别
.                                 → 修改当前窗口编号，相当于窗口重新排序
p                                 → 切换至上一窗口
n                                 → 切换至下一窗口
&lt;NUM&gt;                             → 切换至指定窗口，每个窗口默认从0开始编号
f                                 → 通过名称切换窗口，窗口必须之前已经命名
w                                 → 通过窗口列表切换窗口，此时会列出所有的窗口</code></pre></figure>

<h3 id="面板panes操作">面板(Panes)操作</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&quot;                                 → 将当前面板平分为上下两块，修改为-
%                                 → 将当前面板平分为左右两块，修改为|
x                                 → 关闭当前面板，会提示是否关闭

o                                 → 在当前窗口中选择下一面板
方向键                             → 移动光标以选择面板
;                                 → 切换到最后一个使用的面板
q                                 → 显示面板编号，输入编号调转到相应面板

Alt+o                             → 逆时针旋转当前窗口的面板
Ctrl+o                            → 顺时针旋转当前窗口的面板
{                                 → 向前置换当前面板
}                                 → 向后置换当前面板

!                                 → 当前面板置于新窗口，仅包含当前面板内容

Alt+方向键                         → 以5个单元格为单位移动边缘以调整当前面板大小</code></pre></figure>

<p>另外，可以通过 &lt;prefix&gt;+space 在预置的面板布局中循环切换；依次包括 even-horizontal (横向平铺)、even-vertical(垂直平铺)、main-horizontal(大的 panes 在顶部，底部会有很多小的 panes )、main-vertical(大的 pane 在左边，右边很多小的 panes )、tiled(平均分配各个窗口) 。</p>

<h3 id="其它">其它</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">t                                 → 显示时间，回车返回</code></pre></figure>

<h2 id="定制-tmux">定制 tmux</h2>

<p>tmux 的系统级配置文件为 /etc/tmux.conf ，用户级配置文件为 ~/.tmux.conf 。</p>

<p>有些资料中建议修改 Prefix 组合键，如 CapsLock 和 A 相邻，可以将 CapsLock 映射为 Ctrl （需要使用操作系统的键盘映射），并将 Prefix 的 Ctrl-b 重定义为 Ctrl-a ，这样的话可以非常方便的使用。</p>

<p>但是在 Linux 操作中会与 Bash 的 Ctrl-A 冲突，因此没有修改该键，主要是因为 Prefix 只有在调整 tmux 才会使用。如上的配置，可以在命令行中执行如下命令查看：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ tmux show-options -g
$ tmux show-window-options -g</code></pre></figure>

<p>如下是常用的配置文件示例。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">set -g prefix C-a                # 设置Prefix为Ctrl-a而非默认Ctrl-b，-g表示全局，set为set-option的简写
unbind C-b                       # 解除 Ctrl-b 与 Prefix 的对应关系

set-option -g display-time 5000  # 提示信息的持续时间，单位为毫秒
set-option -g repeat-time 1000   # 通过&lt;prefix&gt;激活控制台后持续时间，避免每次都要先激活控制台，单位为毫秒
set-option -g status-keys vi     # 操作状态栏时的默认键盘布局；可以设置为vi或emacs

set -sg escape-time 1      # tmux在发送命令时，会添加了一个延迟，可能会对其它软件如vim造成干扰
                           # 该选项可以增加其响应速度，单位毫秒

set -g base-index 1        # 将session中的窗口序列初始值设置为从1开始
setw -g pane-base-index 1  # 将panes的开始设置为1，setw是set-window-option的缩写

bind r source-file ~/.tmux.conf\; display &quot;Reloaded!&quot;
                           # 将PREFIX r设置为执行命令source-file ~/.tmux.conf，并回显Reload!
                           # 多条命令之间可以通过\; 进行分割。bind是bind-key的缩写

bind-key -n C-r source-file ~/.tmux.conf
                           # 不使用PREFIX，只使用Ctrl-r，可能对其它造成影响
bind C-a send-prefix       # 通过Prefix + Ctrl-a ，将Prefix发送给应用程序

bind | split-window -h     # 垂直分开panes
bind - split-window -v     # 水平，-v画个水平线，即垂直分配

bind h select-pane -L      # 切换panes，用于替换方向键，使用hjkl代替
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind -r C-h select-window -t :-   # 实现PREFIX Ctrl-h或PRFIX Ctrl-l的循环切换
bind -r C-l select-window -t :+

bind H resize-pane -L 5    # 调整 panes 的大小
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5

bind -r H resize-pane -L 5 # 调整 panes 的大小，可以在一定时间内连续按 H ，-r 表示 repeatable
bind -r J resize-pane -D 5 # 可以通过 repeat-time 设置时间，默认是 500 毫秒。
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

setw -g mode-mouse on            # 响应鼠标的事件，包括选中 pane ，使用滚轮查看 buffer
set -g mouse-select-pane on      # 可以选择 pane ，如果要关闭直接使用上一句即可
set -g mouse-resize-pane on      # 可以调整 pane 大小
set -g mouse-select-window on    # 可以通过窗口列表选择窗口

set -g default-terminal &quot;screen-256color&quot; # 设置使用 256 色
set -g status-fg white           # 设置状态栏的前景色和后景色
set -g status-bg black
setw -g window-status-fg cyan
setw -g window-status-bg default # default 表示从状态栏继承
setw -g window-status-attr dim
setw -g window-status-current-fg white   # 改变当前窗口
setw -g window-status-current-bg red
setw -g window-status-current-attr bright
set -g pane-border-fg green      # 设置 pane 的边框
set -g pane-border-bg black
set -g pane-active-border-fg white
set -g pane-active-border-bg yellow
set -g message-fg white          # 设置消息栏，包括命令栏
set -g message-bg black
set -g message-attr bright

set -g status-left-length 40     # 设置左状态栏的长度
set -g status-left &quot;#[fg=green]#S #[fg=yellow]#I #[fg=cyan]#P&quot;       # 设置左状态栏
set -g status-right &quot;#[fg=cyan]%d %b %R&quot;  # 时间格式可以通过 strftime() 设置
set -g status-utf8 on            # 设置状态栏
set -g status-interval 60        # 设置状态栏的更新间隔时间，单位为秒
set -g status-justify centre     # 将窗口列表居中显示
setw -g monitor-activity on      # 设置监控其它窗口
set -g visual-activity on        # 当其他窗口有消息时会提示

setw -g mode-keys vi                    # 使用 vi 的快捷键

bind h select-layout even-horizontal    # 将当前面板布局切换为 even-horizontal
bind v select-layout even-vertical      # 将当前面板布局切换为 even-vertical</code></pre></figure>

<h3 id="定制-tmux-启动脚本">定制 tmux 启动脚本</h3>

<p>tmux 脚本，可以参考 <a href="/reference/linux/tmux_basic">tmux_basic</a> 脚本，实际上是一个 shell 脚本，可以通过如下命令的进行不同的组合。也就是通过运行该脚本，生成最终的 tmux 初始环境。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">### 1. 创建一个可执行文件
$ touch ~/development &amp;&amp; chmod +x ~/development

### 2. 判断是否存在basic会话，否则下面命令将会出错
tmux has-session -t basic

### 3. 创建一个新session名称为basic，新窗口为名为editor，并detach
tmux new-session -s basic -n editor -d

### 4. 向指定pane发送命令，C-m表示回车，使用session:window:pane指定特定的pane
tmux send-keys -t basic &#39;cd ~&#39; C-m

### 5. 将窗口分为上下两部分，-h分为左右两部分，并通过-p指定比例，下和右所占比例
tmux split-window -v -p 10 -t basic

### 6. 也可以选择一个默认的分布
tmux select-layout -t basic main-horizontal

### 7. 创建一个新的窗口
tmux new-window -n editor -t basic

### 8. 选择一个默认窗口
tmux select-window -t basic:1

### 9. 最后连接到basic
tmux attach -t basic</code></pre></figure>

<p>实际是一个 Shell 脚本，当然 tmux 的配置文件也可以进行相同的设置。</p>

<p>可以将上述的命令放置到 tmux.conf 配置文件中，此时将会自动执行，也可以将其放置到不同的文件中，然后通过 tmux -f 指定相应的配置文件，第一行中指定需要加载默认配置文件。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># ~/.tmux/aiduppconf
source-file ~/.tmux.conf      # 加载默认的配置选项，非强制，但是建议使用
........ your commands</code></pre></figure>

<p>tmux 的默认行为是新建一个 session ，因此如果没有使用 attach 选项，那么实际会再新建一个 session ，此时会导致有两个 session 。</p>

<!--
<br><h2>复制/滚屏模式</h2><p>

    Prefix # 列出所有buffers；Prefix = 列出并选择相应的buffer

	在 tmux 中可以查看缓冲区的内容，并且可以进行复制、粘贴。可以通过yum install xclip安装xclip。<br><br>

	滚屏，即查看缓冲区的内容，需要进入 copy-mode ，即 PREFIX+[ ，然后就可以用上下键来滚动屏幕，配置了 vi 快捷键模式，就可以像操作 vi 一样来滚动屏幕，即 hjkl ，非常的方便，退出直接按 q 键或 Enter 即可。<br><br>

	之前已经设定好了使用 vi 模式，因此，可以通过 w 跳转到下一个单词，b 跳转回上一个单词；f+char 向前跳转到 char 字符处，F+char 向后跳转到 char 字符处。使用 g 跳转到 buffer 的首部，G 跳转到末尾；Ctrl-b 向后一页，Ctrl-f 向前翻页。同时可以使用 ? 和 / 向上和向下搜索，n 查找下一个，N 查找上一个。<br><br><br>


	PREFIX [ 进入复制模式，将光标移动到需要复制 buffer 的地方，按 space 开始复制，移动光标选择复制区域；按 Enter 复制并退出 copy-mode；需要粘贴时，按 PREIFX ] 粘贴。<br><br>

	可以使用 PREFIX : 并输入 capture-pane 命令复制一个 pane 的所有内容，然后再使用 Prefix-] 复制。<br><br>

	可以在终端通过 tmux show-buffer 查看 buffer 的内容，在 tmux 的命令行中通过 show-buffer 查看；当然也可以在 Shell 中通过 tmux capture-pane && tmux save buffer.txt 将 buffer 保存在 buffer.txt 文件中，在 tmux 中使用 capture-pane;save-buffer buffer.txt 保存。<br><br>

	tmux 维护了一个堆栈用于保存缓存，每次都会将新的缓存保存在栈顶。在 tmux 中通过 list-buffers 可以查看所有的 buffers 。如果有多个 buffer ，Prefix-] 默认使用第一条，可以通过 choose-buffer 选择相应的 buffer ，然后通过 Enter 插入到制定pane。<br><br>

	可以通过如下的设置，使得操作时更像 vi 。Escape 切换到复制模式，y (yank) 将内容复制到 buffers ，v 切换到选择模式，p 用于粘贴文本。
<pre>unbind [
bind Escape copy-mode
unbind p
bind p paste-buffer
bind -t vi-copy 'v' begin-selection
bind -t vi-copy 'y' copy-selection</pre><br>

	tmux 也可以通过 xclip 与系统的粘贴板进行交互，在 Linux 中通过如下命令安装 apt-get install xclip/yum install xclip 。通过第一行的命令将 tmux 当前的 buffer 输出到 xclip ；第二行将系统粘贴板的内容复制到 tmux 中。
<pre>bind C-c run "tmux save-buffer - | xclip -i -sel clipboard"<br>bind C-v run "tmux set-buffer \"$(xclip -o -sel clipboard)\"; tmux paste-buffer"</pre>

    当打开mode-mouse时，可以使用“Shift+鼠标”选中文字；Ctrl+Shift+c复制，Ctrl+Shift+v粘贴。
-->

<h3 id="颜色设置">颜色设置</h3>

<p>可以从 <a href="http://www.vim.org/scripts/download_script.php?src_id=4568">colortest</a> 上下载该文件，也可以使用 <a href="/reference/linux/tmux_colortest">本地文档</a>，通过如下命令测试终端；并在 ~/.bashrc 添加如下内容，此时只会在 TMUX 外设置 TERM ，而 TMUX 会设置自己的终端。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ perl colortest -w

### 在 ~/.bashrc 中添加如下内容
[ -z &quot;$TMUX&quot; ] &amp;&amp; export TERM=xterm-256color</code></pre></figure>

<p>tmux 支持指定特定的颜色，包括了 black, red, green, yellow, blue, magenta, cyan 和 white，也可以使用 colour0 到 colour255 ，可以简单的通过如下命令查看。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">for i in {0..255}; do printf &quot;\x1b[38;5;${i}mcolour${i}  &quot;; done</code></pre></figure>

<p>tmux 的各个组件可以通过前景色和后景色进行设置。</p>

<p>在 Putty 中，右击 -&gt; Change Settings… -&gt; Window -&gt; Colours 选中， Allow terminal to specify ANSI colours 和 Allow terminal to use xterm 256-colour mode ，并在 Indicate bolded text by changing: The colour 。</p>

<p>tmux 启动时可以使用 -2 参数，此时 tmux 会强制假设终端支持 256 色。</p>

<h3 id="设置状态栏">设置状态栏</h3>

<p>状态栏由三部分组成：右面板、窗口列表、左面板。左右面板可以使用文本和变量，常见变量如下所示。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">#H                主机名
#h                主机名，不含域名
#F                当前窗口的 flag
#I                当前窗口的序号
#P                当前面板的序号
#S                当前 session 名
#T                当前窗口的 title
#W                当前窗口的名称
##                字符 #
#(shell-command)  shell 命令输出的第一行
#[attributs]      改变颜色或者属性</code></pre></figure>

<h3 id="合作">合作</h3>

<p>通过 tmux 可以两个人进行合作，在一个窗口上的操作可以被另一个人看到。最简单的是同一个用户 (Shared Account)，此时一个人创建一个窗口，另一个人 attach 即可。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ tmux new-session -s Pairing     # 一个用户
$ tmux attach -t Pairing          # 另一个用户</code></pre></figure>

<p>使用同一个用户 (Shared Account) 和分类会话 (Grouped Sessions) ，此时与上述的相似，不过当一个用户切换时，另一个用户不会看到。这样的话，当两个人需要使用不同的编辑器进行编译时，可以各自创建一个新的窗口，各自不会影响。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ tmux new-session -s Pairing     # 一个用户
$ tmux attach -t Pairing -s my    # 另一个用户</code></pre></figure>

<p>使用不同的用户，假设为 foo 和 bar 。这种情况下，两个人可以使用不同的配置选项，如快捷键、状态栏等属性。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ sudo adduser ted            # 添加用户
$ sudo adduser barney

$ sudo addgroup tmux          # 添加用户组
$ sudo mkdir /var/tmux

$ sudo chgrp tmux /var/tmux   # 修改用户组

$ sudo chmod g+ws /var/tmux   # 修改属性

$ sudo usermod -aG tmux ted   # 添加到用户组
$ sudo usermod -aG tmux barney

$ tmux -S /var/tmux/pairing   # 一个用户在创建时指定 Sockets
$ tmux -S /var/tmux/pairing attach # 另一个用户连接</code></pre></figure>

<h2 id="其它-1">其它</h2>

<h4 id="1-pane-转为-window">1. pane 转为 window</h4>

<p>通过 Prefix ! 可以将一个 pane 转作 window。</p>

<h4 id="2-pane-合并到-window">2. pane 合并到 window</h4>

<p>如果想将一个 pane 合并到 window ，可以在 tmux 中通过如下命令执行。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">join-pane -s 1.0 -t 2</code></pre></figure>

<p>如果没有通过 -t 指定目标，那么默认为当前的 window ，在指定 pane 时，目标通过 [session_name]:[window].[pane] 指定。</p>

<h4 id="3-判断是否存在-session">3. 判断是否存在 session</h4>

<p>在一个 Bash 脚本中，可以通过如下的命令查看是否存在一个 Session 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">if ! tmux has-session -t remote; then
   exec tmux new-session -s development -d
   # other setup commands before attaching....
fi
exec tmux attach -t development</code></pre></figure>

<!--
有时候我们希望将一个 pane 放大，然后查看其内容，最后将其恢复。通常可以通过 break-pane 然后使用 join-pane 将其取回，这样做会有一些麻烦，下面通过一个临时的 window 作为容器进行操作。

unbind Up        ## 将 pane 放大
bind Up new-window -d -n tmp \; swap-pane -s tmp.1 \; select-window -t tmp
unbind Down      ## 将窗口恢复
bind Down last-window \; swap-pane -s tmp.1 \; kill-window -t tmp




之前曾经通过 send-keys 执行某一个命令，同样可以通过如下的方式执行，不过当 ssh 退出时，pane 或者 window 同样会关闭。

$ tmux new-session -s servers -d "ssh deploy@burns"
$ tmux split-window -v "ssh dba@smithers"
$ tmux attach -t servers
-->

<h4 id="4-设置默认-bash">4. 设置默认 bash</h4>

<p>tmux 默认使用的是 bash ，如果要使用其它的终端，可以在 tmux.conf 中通过如下的命令指定。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">set -g default-command /bin/zsh
set -g default-shell /bin/zsh</code></pre></figure>

<h4 id="5-term设置">5. TERM设置</h4>

<p>当 tmux 运行时，会将 TERM 变量设置为 “screen” 或者配置文件中 default-terminal 指定的值，在 .bashrc 中可以通过判断该变量来确定现在是否在 tmux 中。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">if [[ &quot;$TERM&quot; != &quot;screen-256color&quot; ]]
then
   tmux attach-session -t &quot;$USER&quot; || tmux new-session -s &quot;$USER&quot;
   exit
fi</code></pre></figure>

<p>如果不在 tmux 中，那么首先尝试连接 $USER ，也就是 Session 为用户名；如果链接失败则会尝试新建一个，然后退出脚本。</p>

<p>当启动 tmux 时，仍会执行配置文件，但是由于这次在 tmux 中，因此跳过这段指令。</p>

<h4 id="6-窗口切换">6. 窗口切换</h4>

<p>将窗口在 Session 之间进行切换，使用时通过  Prefix . ，并在命令行中输入想要切换的 Session。当热也可以通过如下的命令执行</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ tmux move-window -s processes:1 -t editor</code></pre></figure>

<p>将 processes 的第一个 window 移动到 editor 。</p>

<!--
之前曾介绍过通过 capture-pane + save-buffer 的方式保存终端的输出信息。此处介绍通过 pipe-pane ，通过这个命令我们可以控制开关，可以在一个命令已经执行的时候保存输出。在配置文件中添加如下的内容。
<pre>bind P pipe-pane -o "cat >>~/#W.log" \; display "Toggled logging to ~/#W.log"</pre>
通过 Prefix P 进行切换，-o 指定输出。
-->

<h3 id="putty-乱码设置">putty 乱码设置</h3>

<p>在通过 putty 链接 tmux 时，可能会出现乱码，此时需要设置字符集。[右键] =&gt; [Change Settings…] =&gt; [Windows/Translation] =&gt; [Remote character set:] 改为 UTF-8 。</p>

<h2 id="参考">参考</h2>

<p>详细内容可以参考官方网站 <a href="http://tmux.github.io/">tmux.github.io</a>，详细的文档可以参考 <a href="/reference/linux/Pragmatic.tmux.Feb.2012.pdf">tmux Productive Mouse-Free Development</a>，版权归作者所有。</p>

<p>当然也可以通过 <a href="https://github.com/erikw/tmux-powerline">tmux-powerline</a> 配置状态栏；关于按键的绑定可以参考 <a href="https://www.emacswiki.org/emacs/MovingTheCtrlKey">Moving The Ctrl Key</a>，以及参考配置文件 <a href="/reference/linux/tmux.conf">tmux.conf</a> 。</p>

<!--
set -g status-utf8 on
Mouse Settings
set the default bash
set -g utf8
set-window-option -g utf8 on
-->


  <hr>
  <nav>
    <ul class="pager">
         <li class="previous"><a href="/post/network-wireshark-introduce.html" title="Linux Wireshark">&larr; Older</a></li> 
         <li class="next"><a href="/post/details-about-dstat.html" title="dstat 使用及其原理">Newer &rarr;</a></li> 
    </ul>
  </nav><br>
<!--
  <hr><div id="section-donate"><span>赏</span></div><br>
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p><br>
  <div class="row" style="text-align:center;" >
    <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
    <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
  </div><br><hr>
-->
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p>
  <div id="donate_module">
    <style type="text/css">
      .donate_bar a.btn_donate{
        display: inline-block;
        position:      relative;
        text-align:    center;
        width: 82px;
        height: 82px;
        background: url("/images/misc/btn_reward.gif") no-repeat;
        _background: url("/images/misc/btn_reward.gif") no-repeat;
        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
      }
      .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
      .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
      }
    </style>
    <div id="donate_board" class="donate_bar row" style="text-align:center;" >
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    </div>
    <div id="donate_guide" class="donate_bar center hidden">
      <div class="row" style="text-align:center;" >
        <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
        <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function(){
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
    </script>
  </div>

  <hr>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      id: '1400601600',
      owner: 'Jin-Yang',
      repo: 'jin-yang.github.com',
      oauth: {
          client_id: '6d89d48ce689192bf95d',
          client_secret: 'c9a720aafb8e3084e3feb46cadee80b03cdc792f',
      },
  });
  gitment.render('gitmentContainer');
  </script>

  <!-- 多说评论框 start -->
  <!--<div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>-->
  <!--
  <div class="ds-thread" data-thread-key="/post/tmux-introduce.html" data-title="TMUX 简介" data-url="/post/tmux-introduce.html"></div>
  -->
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <!--
  <script type="text/javascript">
      var duoshuoQuery = {short_name:"jinyangposts"};
      (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
  </script>
  -->
  <!-- 多说公共JS代码 end -->
</div>

    </div>
    <div class="col-lg-3 visible-lg blog-sidebar">
    <center><a href="/"><img src="/images/system/linux-liberty.png" width="200" /></a></center>
<h2>About This Blog</h2>
<div class="sidebar-module">
<p style="text-indent:0em;margin:0px;padding:0px;">This is a personal weblog ^_^ generated with Jekyll, if you like it or have some questions,
just feel free to contact me :)</p>
</div><!-- end of "node" "about" -->



<h2>Recent Posts</h2>
<div class="list-group">
  
    <a class="list-group-item" href="/post/linux-program-cpu-cache-introduce_init.html">CPU Cache</a>
  
    <a class="list-group-item" href="/post/artificial-intelligence-decision-tree-introduce.html">决策树</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-bcc-tools-introduce.html">BCC 工具使用</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-basic-usage-introduce.html">eBPF 简介</a>
  
    <a class="list-group-item" href="/post/math-monte-carlo-sample-introduce.html">采样算法</a>
  
</div>

<h2>Categories</h2>
<ul class="list-group" style="margin:0px;">
  
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#bash"> bash</a>
    <span class="badge">2</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#database"> database</a>
    <span class="badge">86</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#golang"> golang</a>
    <span class="badge">28</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#linux"> linux</a>
    <span class="badge">301</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#misc"> misc</a>
    <span class="badge">244</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#mysql"> mysql</a>
    <span class="badge">79</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#network"> network</a>
    <span class="badge">49</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#postgresql"> postgresql</a>
    <span class="badge">4</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#program"> program</a>
    <span class="badge">138</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#python"> python</a>
    <span class="badge">25</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#react"> react</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#rtems"> rtems</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#sql"> sql</a>
    <span class="badge">10</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#tools"> tools</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#webserver"> webserver</a>
    <span class="badge">25</span>
  </li>
  
</ul><!-- end of "node" "categories" -->

<h2>Related Links</h2>
<ul class="list-group" style="margin:0px">
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.rtems.org" title="To RTEMS"><img class="img-thumbnail img-responsive" src="/images/system/rtems.png"  alt="RTEMS"/></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>RTEMS</strong><br>
        <div class="sidebar-description">Real-Time Executive for Multiprocessor System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.gnu.org" title="To GNU">
       <img class="img-thumbnail img-responsive" src="/images/system/gnu.jpg" alt="GNU" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>GNU</strong><br>
        <div class="sidebar-description">A Unix-linux Operating System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://www.kernel.org" title="To Linux Kernel">
    <img class="img-thumbnail img-responsive" src="/images/system/linux.png"  alt="LINUX" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Linux Kernel</strong><br>
        <div class="sidebar-description">Maintained by Linux Kernel Organization</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://arduino.cc" title="To Arduino">
    <img class="img-thumbnail img-responsive" src="/images/system/arduino.png"  alt="ARDUINO" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Arduino</strong><br>
        <div class="sidebar-description">Open-source Electronic Prototyping Platform</div>
      </div>
    </div>
  </li>
</ul>

<h2>Search</h2>
<div class="sidebar-module">
  <form class="search" method="GET" action="https://www.google.com.hk/search">
    <input type="text" name="q" class="search-query" placeholder=" Search on Google">
    <input type="hidden" name="ie" value="utf-8">
    <input type="submit" name="sa" value="Search" />
  </form><br>
  <input type="text" class="search-field" placeholder=" Search This Site">
  <div class="search-results"></div>
</div>



    </div>
  </div>
<hr><p class="text-center">This Site was built by Jin Yang, generated with Jekyll, and hosted on GitHub Pages<br/> &copy;2013-2019 &ndash; Jin Yang</p><div class="footer-logo"></div>

</div>
</body>
</html>
