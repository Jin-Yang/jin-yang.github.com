<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <meta name="baidu-site-verification" content="B786jeR0MV" />
  <meta name="msvalidate.01" content="29F791E7F785800340E37AD7C714D2A7" />
  <meta name="google-site-verification" content="p7jJ5d3kF9yxRhpIo5GgHXAZ1ATKVyZhV2kf6mEGOv0" />
  <title>MySQL 复制源码解析|JinYang's Blog</title>
  <meta name="keywords" content="mysql,复制,源码">
  <meta name="description" content="MySQL 的主从复制是通过 binlog 完成的，从库通过 dump 协议来交互数据的，binlog 复制的基本逻辑处理单元为 event 。在本文中，我们看看源码是如何执行的。">

  <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">
  !window.jQuery && document.write('<script src="/static/js/jquery.min.js"><\/script>');
  </script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  !$('body').popover && document.write('<script src="/static/js/bootstrap.min.js"><\/script>');
  </script>
  <script type="text/javascript" src="/static/js/main.js"></script>
  <!-- <link rel="stylesheet prefetch" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/bootstrap.min.css">
  <!-- <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/font-awesome.min.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/pygments.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/screen.css">
  <style type="text/css">
  
    .post-container > p {text-indent: 2em;}
  
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124556620-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124556620-1');
</script>

</head>

<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top navbar-wrapper">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/">Jin-Yang</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li  ><a href="/"> Home </a></li>
        <li  ><a href="/archives.html"> Archive </a></li>
        <li  ><a href="/categories.html"> Categories </a></li>
        <li  ><a href="/projects.html"> Projects </a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Others <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">常用网站</li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.rtems.org/">www.rtems.org</a></li>
            <li><a href="http://www.gnu.org/">www.gnu.org</a></li>
            <li><a href="https://www.kernel.org/">www.kernel.org</a></li>
            <li><a href="https://www.arduino.cc/">www.arduino.cc</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li  ><a href="/about.html"> About </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
    <li data-target="#myCarousel" data-slide-to="4"></li>
  </ol>
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>KISS</h1>
          <h2>Keep It Simple and Stupid.</h2>
          <!--<a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a>-->
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Seize The Day</h1><h1>And Get Busy Living</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Stay hungry</h1><h1>Stay foolish</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
	  <h2>Ever tried, ever failed</h2><h2>No matter, try again</h2><h2>Fail again, fail better</h2>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Nothing is true</h1><h1>Every is permitted</h1>
        </div>
      </div>
    </div>
  </div>
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div><!-- /.carousel -->

<div class="container">
  <div class="row">
    <div class="col-lg-9 blog-main" style="min-width: 500px">
    
<div class="post-container">
  <div class="blog-header">
    <h1>MySQL 复制源码解析</h1>
    <div class="post-description">
      <i class="fa fa-calendar"></i> 2015-08-15 Saturday &nbsp; &nbsp;
      <i class="fa fa-tags"></i>  mysql ,  database  
      
    </div>
  </div>
  <hr>
  <p>MySQL 的主从复制是通过 binlog 完成的，从库通过 dump 协议来交互数据的，binlog 复制的基本逻辑处理单元为 event 。</p>

<p>在本文中，我们看看源码是如何执行的。</p>

<!-- more -->

<p><img src="/images/databases/mysql/replicatioin-sourcecode-logo.jpg" alt="gtid source code" title="gtid source code" class="pull-center" /></p>

<!--
## 简介

如下，是与复制相关的代码文件的简介。


<figure class="highlight"><pre><code class="language-text" data-lang="text">slave.(h|cc)
    IO/SQL 线程的实现，主要是 slave 的管理逻辑实现，不含从网络 dump 数据、解析 relay 日志等底层处理逻辑。
log.(h|cc)
    对event的排序，以及创建、写入、删除 binlog 的高级日志机制，也包含 binlog 的部分回调函数。
log_event.(h|cc)
    包含 log_event 类及其子类，用于所有 event 的创建、写入、输出等底层操作，基本是对数据的序列化。
rpl_rli.(h|cc)
    relay_log_info 数据结构的实现，主要用于 SQL 线程，同时也包含部分 SQL 线程的方法，另一部分在 slave.cc 中。
rpl_mi.(h|cc)
    master_info 数据结构的实现，主要用于 IO 线程。
sql_repl.cc
    主的 dump 线程的实现，主要用于将 binlog 发送到备，同时也包含大部分命令的实现。
sql_binlog.cc
    binlog 语句的执行实现。
rpl_record.(h|cc)
    编码以及解码 row 模式下的 row event 格式的工具方法。
rpl_failsafe.(h|cc)
    备机初始化以及注册到主的实现。
rpl_constants.h
    复制事件的定义。</code></pre></figure>

-->

<h2 id="执行命令">执行命令</h2>

<p>配置主备复制时，都是通过各种的 SQL 指令配置的；所以呢，首先看看这些命令的入口，以及命令是如何执行的。</p>

<p>其中，与复制相关的命令主要包括了如下几个：<code>change master</code>、<code>show slave stat</code>、<code>show master stat</code>、<code>start slave</code>、<code>stop slave</code> 等命令。</p>

<p>如下是上述命令在源码中的实际入口，可以根据不同命令入口查看。</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">mysql_execute_command</span><span class="p">(</span><span class="n">THD</span> <span class="o">*</span><span class="n">thd</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">first_level</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span> <span class="p">...</span>
<span class="cp">#ifdef HAVE_REPLICATION</span>
  <span class="k">case</span> <span class="nl">SQLCOM_CHANGE_MASTER</span><span class="p">:</span>
  <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">check_global_access</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="n">SUPER_ACL</span><span class="p">))</span>
      <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">res</span><span class="o">=</span> <span class="n">change_master_cmd</span><span class="p">(</span><span class="n">thd</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">case</span> <span class="nl">SQLCOM_SHOW_SLAVE_STAT</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="cm">/* Accept one of two privileges */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">check_global_access</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="n">SUPER_ACL</span> <span class="o">|</span> <span class="n">REPL_CLIENT_ACL</span><span class="p">))</span>
      <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">res</span><span class="o">=</span> <span class="n">show_slave_status_cmd</span><span class="p">(</span><span class="n">thd</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">case</span> <span class="nl">SQLCOM_SHOW_MASTER_STAT</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="cm">/* Accept one of two privileges */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">check_global_access</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="n">SUPER_ACL</span> <span class="o">|</span> <span class="n">REPL_CLIENT_ACL</span><span class="p">))</span>
      <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">show_master_status</span><span class="p">(</span><span class="n">thd</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">case</span> <span class="nl">SQLCOM_SLAVE_START</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="n">res</span><span class="o">=</span> <span class="n">start_slave_cmd</span><span class="p">(</span><span class="n">thd</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">case</span> <span class="nl">SQLCOM_SLAVE_STOP</span><span class="p">:</span>
  <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">    If the client thread has locked tables, a deadlock is possible.</span>
<span class="cm">    Assume that</span>
<span class="cm">    - the client thread does LOCK TABLE t READ.</span>
<span class="cm">    - then the master updates t.</span>
<span class="cm">    - then the SQL slave thread wants to update t,</span>
<span class="cm">      so it waits for the client thread because t is locked by it.</span>
<span class="cm">    - then the client thread does SLAVE STOP.</span>
<span class="cm">      SLAVE STOP waits for the SQL slave thread to terminate its</span>
<span class="cm">      update t, which waits for the client thread because t is locked by it.</span>
<span class="cm">    To prevent that, refuse SLAVE STOP if the</span>
<span class="cm">    client thread has locked tables</span>
<span class="cm">  */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">thd</span><span class="o">-&gt;</span><span class="n">locked_tables_mode</span> <span class="o">||</span>
      <span class="n">thd</span><span class="o">-&gt;</span><span class="n">in_active_multi_stmt_transaction</span><span class="p">()</span> <span class="o">||</span> <span class="n">thd</span><span class="o">-&gt;</span><span class="n">global_read_lock</span><span class="p">.</span><span class="n">is_acquired</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">my_message</span><span class="p">(</span><span class="n">ER_LOCK_OR_ACTIVE_TRANSACTION</span><span class="p">,</span>
               <span class="n">ER</span><span class="p">(</span><span class="n">ER_LOCK_OR_ACTIVE_TRANSACTION</span><span class="p">),</span> <span class="n">MYF</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">res</span><span class="o">=</span> <span class="n">stop_slave_cmd</span><span class="p">(</span><span class="n">thd</span><span class="p">);</span>
  <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* HAVE_REPLICATION */</span><span class="cp"></span>
  <span class="p">...</span> <span class="p">...</span>
<span class="p">}</span></code></pre></figure>

<p>注意下面的命令 COM_REGISTER_SLAVE 会直接在 dispatch_command() 函数中执行。</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="nf">dispatch_command</span><span class="p">(</span><span class="n">THD</span> <span class="o">*</span><span class="n">thd</span><span class="p">,</span> <span class="k">const</span> <span class="n">COM_DATA</span> <span class="o">*</span><span class="n">com_data</span><span class="p">,</span>
                      <span class="k">enum</span> <span class="n">enum_server_command</span> <span class="n">command</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span> <span class="p">...</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="p">...</span>
  <span class="k">case</span> <span class="nl">COM_REGISTER_SLAVE</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="c1">// TODO: access of protocol_classic should be removed</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">register_slave</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span>
      <span class="n">thd</span><span class="o">-&gt;</span><span class="n">get_protocol_classic</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">get_raw_packet</span><span class="p">(),</span>
      <span class="n">thd</span><span class="o">-&gt;</span><span class="n">get_protocol_classic</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">get_packet_length</span><span class="p">()))</span>
      <span class="n">my_ok</span><span class="p">(</span><span class="n">thd</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">...</span> <span class="p">...</span>
<span class="p">}</span></code></pre></figure>

<h2 id="启动备库">启动备库</h2>

<p>首先，在会在备库执行 <code>change master</code> 函数，将主库信息写入到备库。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">mysql_execute_command()
 |-check_global_access()          ← 查看用户是否有权限
 |-change_master_cmd()            ← 判断是否创建channel，调用如下函数
   |-change_master()              ← 命令的实际入口函数</code></pre></figure>

<p>在编译源码的时候需要开启 HAVE_REPLICATION 的宏定义，在备库上执行 <code>start slave</code> 命令后，会在 sql_parse.cc 中执行 SQLCOM_SLAVE_START 分支，实际执行的是 start_slave() 函数。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">mysql_execute_command()
 |-start_slave_cmd()
   |-start_slave()
     |-start_slave_threads()
       |-start_slave_thread()                ← 先启动IO线程，无误再启动SQL线程
       | |-handle_slave_io()                 ← IO线程处理函数
       |
       |-start_slave_thread()
         |-handle_slave_sql()                ← SQL线程处理函数</code></pre></figure>

<p>备库中有两类处理线程，也就对应了两个函数 handle_slave_sql() 和 handle_slave_io()，分别用于从主库读取数据，以及将主库数据写入到备库。</p>

<p>接下来依次查看这两类处理线程。</p>

<h2 id="连接主库">连接主库</h2>

<p>首先，查看下 Slave 如何注册并请求 Master 的 binlog，也就是对应备库的 IO 线程。其中 Slave IO 线程对应的入口函数为 handle_slave_io()，大致处理流程为：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">handle_slave_io()
  |-my_thread_init()                ← 0) 线程初始化
  |-init_slave_thread()
  |-RUN_HOOK()                      ←    调用relay_io-&gt;thread_start钩子函数
  |
  |-safe_connect()                  ← 1) 以标准的连接方式连上master
  |-get_master_version_and_clock()       并获取主库的所需信息
  |-get_master_uuid()
  |-io_thread_init_commands()
  |
  |-register_slave_on_master()      ← 2) 把自己注册到master上去
  | |-net_store_data()              ←    设置数据包
  | |-simple_command()              ←    S把自己的ID、IP、端口、用户名提交给M，用于注册
  | |                               ←    **上述会发送COM_REGISTER_SLAVE命令**
  |
  |                                 ###1BEGIN while循环中检测io_slave_killed()
  |
  |-request_dump()                  ← 3) 开始请求数据，向master请求binlog数据
  | |-RUN_HOOK()                    ←    调用relay_io-&gt;before_request_transmit()
  | |-int2store()                   ←    会根据是否为GTID作区分
  | |-simple_command()              ←    发送dump数据请求
  | |                               ←    **执行COM_BINLOG_DUMP_GTID/COM_BINLOG_DUMP命令**
  |
  |                                 ###2BEGIN while循环中检测io_slave_killed()
  |
  |-read_event()                    ← 4) 读取event并存放到本地relay log中
  | |-cli_safe_read()               ←    等待主库将binlog数据发过来
  |   |-my_net_read()
  |-RUN_HOOK()                      ←    调用relay_io-&gt;after_read_event()
  |
  |-queue_event()                   ← 5) 将接收到的event保存在relaylog中
  |-RUN_HOOK()                      ←    调用relay_io-&gt;after_queue_event()
  |-flush_master_info()
  |
  |                                 ###2END
  |                                 ###1END</code></pre></figure>

<p>如上所述，当备库注册到主库时，会发送 COM_REGISTER_SLAVE 命令；请求 binlog 日志时则会根据是否使用 GTID，发送 COM_BINLOG_DUMP_GTID/COM_BINLOG_DUMP 命令。</p>

<p>接下来看下主库是如何处理备库的 binlog 请求，这里相关的命令都会在 dispatch_command() 函数中进行处理，其核心的内容为。</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">bool</span> <span class="nf">dispatch_command</span><span class="p">(</span><span class="n">THD</span> <span class="o">*</span><span class="n">thd</span><span class="p">,</span> <span class="k">const</span> <span class="n">COM_DATA</span> <span class="o">*</span><span class="n">com_data</span><span class="p">,</span>
                      <span class="k">enum</span> <span class="n">enum_server_command</span> <span class="n">command</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span> <span class="p">...</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">...</span> <span class="p">...</span>
<span class="cp">#ifdef HAVE_REPLICATION</span>
      <span class="k">case</span> <span class="nl">COM_REGISTER_SLAVE</span><span class="p">:</span>    <span class="c1">// 注册slave</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">register_slave</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="p">(</span><span class="n">uchar</span><span class="o">*</span><span class="p">)</span><span class="n">packet</span><span class="p">,</span> <span class="n">packet_length</span><span class="p">))</span>
              <span class="n">my_ok</span><span class="p">(</span><span class="n">thd</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef EMBEDDED_LIBRARY</span>
      <span class="k">case</span> <span class="nl">COM_BINLOG_DUMP_GTID</span><span class="p">:</span>
          <span class="n">error</span><span class="o">=</span> <span class="n">com_binlog_dump_gtid</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="n">packet</span><span class="p">,</span> <span class="n">packet_length</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="nl">COM_BINLOG_DUMP</span><span class="p">:</span>
          <span class="n">error</span><span class="o">=</span> <span class="n">com_binlog_dump</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="n">packet</span><span class="p">,</span> <span class="n">packet_length</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
      <span class="p">...</span> <span class="p">...</span>
  <span class="p">}</span>
  <span class="p">...</span> <span class="p">...</span>
<span class="p">}</span></code></pre></figure>

<p>下面以 COM_BINLOG_DUMP 为例介绍 master 是怎么发送 binlog event 给 slave 的。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">dispatch_command()
 |-com_binlog_dump_gtid()           ← COM_BINLOG_DUMP_GTID
 |-com_binlog_dump()                ← COM_BINLOG_DUMP
   |-kill_zombie_dump_threads()     ← 如果同一个备库注册，会移除跟该备库匹配的binlog dump线程
   |-mysql_binlog_send()            ← 上述两个命令都会执行到此处
     |                              ← 会打开文件，在指定位置读取文件，将event按照顺序发给备库
     |-Binlog_sender::run()         ← 调用rpl_binlog_sender.cc中的发送
       |-init()
       | |-init_heartbeat_period()  ← 启动心跳
       | |-transmit_start()         ← RUN_HOOK()，binlog_transmit_delegate
       |
       |-###BEGIN while()循环，只要没有错误，线程未被杀死，则一直执行
       |-open_binlog_file()
       |-send_binlog()              ← 发送二进制日志
       | |-send_events()
       |   |-after_send_hook()
       |     |-RUN_HOOK()           ← 调用binlog_transmit-&gt;after_send_event()钩子函数
       |
       |-set_last_file()
       |-end_io_cache()
       |-mysql_file_close()
       |-###END</code></pre></figure>

<p>综上所述，MySQL 复制需要 Slave 先注册到 Master，再向 Master 提交 binlog 和 POS，请求发送 binlog；Master 接收到请求后，先做一系列验证，打开本地 binlog 文件，按照内部 event 的顺序，依序发给 slave。</p>

<h2 id="备库应用日志">备库应用日志</h2>

<p>我们知道，在主库中会利用多线程机制并发执行，而复制时，在 5.6 之前只会有一个 SQL 线程，就导致复制延迟成为 MySQL 最为诟病的问题之一。</p>

<p>在 5.6 版本中，MySQL 提供了基于 schema 或者说是数据库的并行复制功能，不过对于很多单库的应用场景下，性能提升有限；5.7 开始，提供了基于组提交的并行复制技术，基本可以被认为是真正意义上的并行复制技术。</p>

<h3 id="源码解析">源码解析</h3>

<p>与 MySQL 备库中提供的多线程并发机制相关的，有两个函数的入口：handle_slave_worker() 和 handle_slave_sql()；前者为真正的工作函数，后者作为协调器会启动和分配 worker 线程。</p>

<p>其中，handle_slave_sql() 主要调用了 slave_worker_exec_job_group() ，该函数会利用 C++ 的多态性，调用相应 event 的 do_apply_event() 虚函数，以便将不同的 event 操作在备机上重做一遍。</p>

<p>如下是 handle_slave_sql() 函数的调用逻辑。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">handle_slave_sql()                              ← ###作为协调线程
 |-my_thread_init()
 |-init_slave_thread()
 |-slave_start_workers()                          MTS(Multi-Threaded Slave)
 | |-init_hash_workers()
 | |-slave_start_single_worker()
 |   |-Rpl_info_factory::create_worker()
 |   |-###                                      ← 如下操作是在一个线程里
 |   |-handle_slave_worker()                    ← ###对于复制的并行执行线程
 |     |-my_thread_init()
 |     |-init_slave_thread()
 |     |                                        ← 在while循环中执行
 |     |-slave_worker_exec_job_group()
 |       |-pop_jobs_item()                      ← 获取具体的event(ev)，会阻塞等待==&lt;&lt;&lt;==
 |       |                                      ← 在while循环中执行
 |       |-is_gtid_event()
 |       |-worker-&gt;slave_worker_exec_event(ev)
 |         |-ev-&gt;do_apply_event_worker()        ← 调用该函数应用event
 |           |-do_apply_event()                 ← 利用C++多态性执行对应的event
 |
 |-### 如下从IO线程中读取数据
 |-sql_slave_killed()                           ← 只要线程未kill则一直执行
   |-exec_relay_log_event()
     |-next_event()                             ← 从cache或者relaylog中读取event
     | |-sql_slave_killed()                     ← 只要线程未kill则一直执行
     | |-Log_event::read_log_event()            ← 读取记录，第一参数为IO_CACHE
     |   |-my_b_read()                          ← 从磁盘读取头部，并检查头部信息是否合法
     |   |-Log_event::read_log_event()          ← 处理读取到缓存中的数据，第一个参数为char*
     |     | ... ...
     |     |-Write_rows_log_event()             ← 根据不同的event类型，创建ev对象
     |     |-Update_rows_log_event()
     |     |-Delete_rows_log_event()
     |     | ... ...
     |
     |-apply_event_and_update_pos()             ← 执行event并修改当前读的位置
       |-append_item_to_jobs()                  ← 发送给workers线程==&gt;&gt;&gt;==</code></pre></figure>

<p>首先，看下 SQL 线程的处理流程，也就是从 read_log_event() 函数中读取处理；这里会根据事件的类型来调用相应的构造函数，这里只关心 ROW 模式的事件处理：</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">Log_event</span><span class="o">*</span> <span class="n">Log_event</span><span class="o">::</span><span class="n">read_log_event</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="n">uint</span> <span class="n">event_len</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">error</span><span class="p">,</span>
                                     <span class="k">const</span> <span class="n">Format_description_log_event</span> <span class="o">*</span><span class="n">description_event</span><span class="p">,</span>
                                     <span class="n">my_bool</span> <span class="n">crc_check</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span> <span class="p">...</span>
    <span class="k">switch</span><span class="p">(</span><span class="n">event_type</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span> <span class="p">...</span>
<span class="cp">#if defined(HAVE_REPLICATION)</span>
    <span class="k">case</span> <span class="n">binary_log</span><span class="o">::</span><span class="nl">WRITE_ROWS_EVENT</span><span class="p">:</span>
      <span class="n">ev</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Write_rows_log_event</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">event_len</span><span class="p">,</span> <span class="n">description_event</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">binary_log</span><span class="o">::</span><span class="nl">UPDATE_ROWS_EVENT</span><span class="p">:</span>
      <span class="n">ev</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Update_rows_log_event</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">event_len</span><span class="p">,</span> <span class="n">description_event</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">binary_log</span><span class="o">::</span><span class="nl">DELETE_ROWS_EVENT</span><span class="p">:</span>
      <span class="n">ev</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Delete_rows_log_event</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">event_len</span><span class="p">,</span> <span class="n">description_event</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">binary_log</span><span class="o">::</span><span class="nl">TRANSACTION_CONTEXT_EVENT</span><span class="p">:</span>
      <span class="n">ev</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction_context_log_event</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">event_len</span><span class="p">,</span> <span class="n">description_event</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">binary_log</span><span class="o">::</span><span class="nl">VIEW_CHANGE_EVENT</span><span class="p">:</span>
      <span class="n">ev</span> <span class="o">=</span> <span class="k">new</span> <span class="n">View_change_log_event</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">event_len</span><span class="p">,</span> <span class="n">description_event</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="p">...</span> <span class="p">...</span>
    <span class="p">};</span>
    <span class="p">...</span> <span class="p">...</span>
<span class="p">}</span></code></pre></figure>

<p>如下是 do_apply_event_worker() 函数的代码，event 是 binlog 的最小单元，所有的 event 的父类是 Log_event(抽象基类)，它定义了一系列虚函数，其中就包括我们这里调用的函数。</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kr">inline</span> <span class="kt">int</span> <span class="n">Log_event</span><span class="o">::</span><span class="n">do_apply_event_worker</span><span class="p">(</span><span class="n">Slave_worker</span> <span class="o">*</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">DBUG_EXECUTE_IF</span><span class="p">(</span><span class="s">&quot;crash_in_a_worker&quot;</span><span class="p">,</span>
                  <span class="p">{</span>
                    <span class="cm">/* we will crash a worker after waiting for</span>
<span class="cm">                    2 seconds to make sure that other transactions are</span>
<span class="cm">                    scheduled and completed */</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="p">{</span>
                      <span class="n">DBUG_SET</span><span class="p">(</span><span class="s">&quot;-d,crash_in_a_worker&quot;</span><span class="p">);</span>
                      <span class="n">my_sleep</span><span class="p">(</span><span class="mi">2000000</span><span class="p">);</span>
                      <span class="n">DBUG_SUICIDE</span><span class="p">();</span>
                    <span class="p">}</span>
                  <span class="p">});</span>
  <span class="k">return</span> <span class="nf">do_apply_event</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>对于 do_apply_event() 实现可以查看 sql/log_event.cc 文件内容。</p>

<h2 id="事件简介">事件简介</h2>

<p>在 INSERT、UPDATE、DELETE 事件中，实际执行父类 <code>Rows_log_event::do_apply_event()</code>，接下来，简单说明下数据是怎么应用到备库。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Write_rows_log_event
Update_rows_log_event
Delete_rows_log_event
    如上三个事件都是调用其基类Rows_log_event::do_apply_event()；</code></pre></figure>

<p>其中 Rows_log_event::do_apply_event() 函数的部分调用代码逻辑如下。</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">Rows_log_event</span><span class="o">::</span><span class="n">do_apply_event</span><span class="p">(</span><span class="n">Relay_log_info</span> <span class="k">const</span> <span class="o">*</span><span class="n">rli</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span> <span class="p">...</span>
  <span class="n">table</span><span class="o">=</span>
    <span class="n">m_table</span><span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="n">Relay_log_info</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">rli</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">m_table_map</span><span class="p">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">m_table_id</span><span class="p">);</span>
  <span class="p">...</span> <span class="p">...</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">table</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="p">...</span> <span class="p">...</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">m_rows_lookup_algorithm</span> <span class="o">!=</span> <span class="n">ROW_LOOKUP_NOT_NEEDED</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="n">is_any_column_signaled_for_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m_cols</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">error</span><span class="o">=</span> <span class="n">HA_ERR_END_OF_FILE</span><span class="p">;</span>
      <span class="k">goto</span> <span class="n">AFTER_MAIN_EXEC_ROW_LOOP</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">m_rows_lookup_algorithm</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">case</span> <span class="nl">ROW_LOOKUP_HASH_SCAN</span><span class="p">:</span>
        <span class="n">do_apply_row_ptr</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">Rows_log_event</span><span class="o">::</span><span class="n">do_hash_scan_and_update</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="nl">ROW_LOOKUP_INDEX_SCAN</span><span class="p">:</span>
        <span class="n">do_apply_row_ptr</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">Rows_log_event</span><span class="o">::</span><span class="n">do_index_scan_and_update</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="nl">ROW_LOOKUP_TABLE_SCAN</span><span class="p">:</span>
        <span class="n">do_apply_row_ptr</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">Rows_log_event</span><span class="o">::</span><span class="n">do_table_scan_and_update</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="nl">ROW_LOOKUP_NOT_NEEDED</span><span class="p">:</span>
        <span class="n">DBUG_ASSERT</span><span class="p">(</span><span class="n">get_general_type_code</span><span class="p">()</span> <span class="o">==</span> <span class="n">binary_log</span><span class="o">::</span><span class="n">WRITE_ROWS_EVENT</span><span class="p">);</span>

        <span class="cm">/* No need to scan for rows, just apply it */</span>
        <span class="n">do_apply_row_ptr</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">Rows_log_event</span><span class="o">::</span><span class="n">do_apply_row</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">default</span><span class="o">:</span>
        <span class="n">DBUG_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">error</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">AFTER_MAIN_EXEC_ROW_LOOP</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">do</span> <span class="p">{</span>

      <span class="n">error</span><span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;*</span><span class="n">do_apply_row_ptr</span><span class="p">)(</span><span class="n">rli</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">handle_idempotent_and_ignored_errors</span><span class="p">(</span><span class="n">rli</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">))</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="cm">/* this advances m_curr_row */</span>
      <span class="n">do_post_row_operations</span><span class="p">(</span><span class="n">rli</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">m_curr_row</span> <span class="o">!=</span> <span class="n">m_rows_end</span><span class="p">));</span>
    <span class="p">...</span> <span class="p">...</span>
  <span class="p">}</span>
  <span class="p">...</span> <span class="p">...</span>
<span class="p">}</span></code></pre></figure>

<p>首先，通过 get_table() 调用，从 table map 中获得对应的 table 信息，然后根据不同的类型通过 do_apply_row_ptr 函数指针指向的函数，将事件对应操作应用到备库。</p>

<p>如上代码所示，do_apply_row_ptr 函数指针可能指向以下几种不同的函数：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">do_hash_scan_and_update
do_index_scan_and_update
do_table_scan_and_update
do_apply_row</code></pre></figure>

<p>对于 insert 操作，不用查找数据，会直接调用 do_apply_row() ，调用逻辑如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">do_apply_row()
 |-do_exec_row()
   |-write_row()
     |-ha_start_bulk_insert()</code></pre></figure>

<p>也就是说，它直接把这一行数据交给了存储引擎，让存储引擎把数据给插进去。</p>

<!--

<figure class="highlight"><pre><code class="language-text" data-lang="text">Log_event::print_base64()                        下面的调用只有这一个路径
Rows_log_event::print_verbose()
Rows_log_event::print_verbose_one_row()
 |-log_event_print_value()</code></pre></figure>

-->

<h2 id="参考">参考</h2>

<p>MySQL 中与复制相关的内容，可以参考官方文档 <a href="http://dev.mysql.com/doc/refman/en/replication.html">MySQL Reference Manual - Replication</a>。</p>


  <hr>
  <nav>
    <ul class="pager">
         <li class="previous"><a href="/post/mysql-replication.html" title="MySQL 复制方式">&larr; Older</a></li> 
         <li class="next"><a href="/post/program-c-tips.html" title="C 语言的奇技淫巧">Newer &rarr;</a></li> 
    </ul>
  </nav><br>
<!--
  <hr><div id="section-donate"><span>赏</span></div><br>
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p><br>
  <div class="row" style="text-align:center;" >
    <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
    <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
  </div><br><hr>
-->
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p>
  <div id="donate_module">
    <style type="text/css">
      .donate_bar a.btn_donate{
        display: inline-block;
        position:      relative;
        text-align:    center;
        width: 82px;
        height: 82px;
        background: url("/images/misc/btn_reward.gif") no-repeat;
        _background: url("/images/misc/btn_reward.gif") no-repeat;
        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
      }
      .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
      .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
      }
    </style>
    <div id="donate_board" class="donate_bar row" style="text-align:center;" >
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    </div>
    <div id="donate_guide" class="donate_bar center hidden">
      <div class="row" style="text-align:center;" >
        <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
        <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function(){
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
    </script>
  </div>

  <hr>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      id: '1439568000',
      owner: 'Jin-Yang',
      repo: 'jin-yang.github.com',
      oauth: {
          client_id: '6d89d48ce689192bf95d',
          client_secret: 'c9a720aafb8e3084e3feb46cadee80b03cdc792f',
      },
  });
  gitment.render('gitmentContainer');
  </script>

  <!-- 多说评论框 start -->
  <!--<div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>-->
  <!--
  <div class="ds-thread" data-thread-key="/post/mysql-replication-sourcecode.html" data-title="MySQL 复制源码解析" data-url="/post/mysql-replication-sourcecode.html"></div>
  -->
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <!--
  <script type="text/javascript">
      var duoshuoQuery = {short_name:"jinyangposts"};
      (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
  </script>
  -->
  <!-- 多说公共JS代码 end -->
</div>

    </div>
    <div class="col-lg-3 visible-lg blog-sidebar">
    <center><a href="/"><img src="/images/system/linux-liberty.png" width="200" /></a></center>
<h2>About This Blog</h2>
<div class="sidebar-module">
<p style="text-indent:0em;margin:0px;padding:0px;">This is a personal weblog ^_^ generated with Jekyll, if you like it or have some questions,
just feel free to contact me :)</p>
</div><!-- end of "node" "about" -->



<h2>Recent Posts</h2>
<div class="list-group">
  
    <a class="list-group-item" href="/post/linux-program-cpu-cache-introduce_init.html">CPU Cache</a>
  
    <a class="list-group-item" href="/post/artificial-intelligence-decision-tree-introduce.html">决策树</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-bcc-tools-introduce.html">BCC 工具使用</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-basic-usage-introduce.html">eBPF 简介</a>
  
    <a class="list-group-item" href="/post/math-monte-carlo-sample-introduce.html">采样算法</a>
  
</div>

<h2>Categories</h2>
<ul class="list-group" style="margin:0px;">
  
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#bash"> bash</a>
    <span class="badge">2</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#database"> database</a>
    <span class="badge">86</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#golang"> golang</a>
    <span class="badge">28</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#linux"> linux</a>
    <span class="badge">301</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#misc"> misc</a>
    <span class="badge">244</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#mysql"> mysql</a>
    <span class="badge">79</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#network"> network</a>
    <span class="badge">49</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#postgresql"> postgresql</a>
    <span class="badge">4</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#program"> program</a>
    <span class="badge">138</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#python"> python</a>
    <span class="badge">25</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#react"> react</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#rtems"> rtems</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#sql"> sql</a>
    <span class="badge">10</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#tools"> tools</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#webserver"> webserver</a>
    <span class="badge">25</span>
  </li>
  
</ul><!-- end of "node" "categories" -->

<h2>Related Links</h2>
<ul class="list-group" style="margin:0px">
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.rtems.org" title="To RTEMS"><img class="img-thumbnail img-responsive" src="/images/system/rtems.png"  alt="RTEMS"/></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>RTEMS</strong><br>
        <div class="sidebar-description">Real-Time Executive for Multiprocessor System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.gnu.org" title="To GNU">
       <img class="img-thumbnail img-responsive" src="/images/system/gnu.jpg" alt="GNU" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>GNU</strong><br>
        <div class="sidebar-description">A Unix-linux Operating System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://www.kernel.org" title="To Linux Kernel">
    <img class="img-thumbnail img-responsive" src="/images/system/linux.png"  alt="LINUX" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Linux Kernel</strong><br>
        <div class="sidebar-description">Maintained by Linux Kernel Organization</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://arduino.cc" title="To Arduino">
    <img class="img-thumbnail img-responsive" src="/images/system/arduino.png"  alt="ARDUINO" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Arduino</strong><br>
        <div class="sidebar-description">Open-source Electronic Prototyping Platform</div>
      </div>
    </div>
  </li>
</ul>

<h2>Search</h2>
<div class="sidebar-module">
  <form class="search" method="GET" action="https://www.google.com.hk/search">
    <input type="text" name="q" class="search-query" placeholder=" Search on Google">
    <input type="hidden" name="ie" value="utf-8">
    <input type="submit" name="sa" value="Search" />
  </form><br>
  <input type="text" class="search-field" placeholder=" Search This Site">
  <div class="search-results"></div>
</div>



    </div>
  </div>
<hr><p class="text-center">This Site was built by Jin Yang, generated with Jekyll, and hosted on GitHub Pages<br/> &copy;2013-2019 &ndash; Jin Yang</p><div class="footer-logo"></div>

</div>
</body>
</html>
