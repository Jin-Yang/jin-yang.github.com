<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <meta name="baidu-site-verification" content="B786jeR0MV" />
  <meta name="msvalidate.01" content="29F791E7F785800340E37AD7C714D2A7" />
  <meta name="google-site-verification" content="p7jJ5d3kF9yxRhpIo5GgHXAZ1ATKVyZhV2kf6mEGOv0" />
  <title>React 简明教程|JinYang's Blog</title>
  <meta name="keywords" content="react,introduce">
  <meta name="description" content="React 起源于 Facebook 的内部项目，据说是因为该对市场上 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram 的网站，做出来以后，发现这套东西很好用，就在 2013 年 5 月开源了。其设计思想极其独特，属于革命性创新，性能出众，代码逻辑却非常简单。这里简单介绍其使用方法。">

  <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">
  !window.jQuery && document.write('<script src="/static/js/jquery.min.js"><\/script>');
  </script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  !$('body').popover && document.write('<script src="/static/js/bootstrap.min.js"><\/script>');
  </script>
  <script type="text/javascript" src="/static/js/main.js"></script>
  <!-- <link rel="stylesheet prefetch" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/bootstrap.min.css">
  <!-- <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/font-awesome.min.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/pygments.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/screen.css">
  <style type="text/css">
  
    .post-container > p {text-indent: 2em;}
  
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124556620-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124556620-1');
</script>

</head>

<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top navbar-wrapper">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/">Jin-Yang</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li  ><a href="/"> Home </a></li>
        <li  ><a href="/archives.html"> Archive </a></li>
        <li  ><a href="/categories.html"> Categories </a></li>
        <li  ><a href="/projects.html"> Projects </a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Others <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">常用网站</li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.rtems.org/">www.rtems.org</a></li>
            <li><a href="http://www.gnu.org/">www.gnu.org</a></li>
            <li><a href="https://www.kernel.org/">www.kernel.org</a></li>
            <li><a href="https://www.arduino.cc/">www.arduino.cc</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li  ><a href="/about.html"> About </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
    <li data-target="#myCarousel" data-slide-to="4"></li>
  </ol>
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>KISS</h1>
          <h2>Keep It Simple and Stupid.</h2>
          <!--<a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a>-->
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Seize The Day</h1><h1>And Get Busy Living</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Stay hungry</h1><h1>Stay foolish</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
	  <h2>Ever tried, ever failed</h2><h2>No matter, try again</h2><h2>Fail again, fail better</h2>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Nothing is true</h1><h1>Every is permitted</h1>
        </div>
      </div>
    </div>
  </div>
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div><!-- /.carousel -->

<div class="container">
  <div class="row">
    <div class="col-lg-9 blog-main" style="min-width: 500px">
    
<div class="post-container">
  <div class="blog-header">
    <h1>React 简明教程</h1>
    <div class="post-description">
      <i class="fa fa-calendar"></i> 2018-01-13 Saturday &nbsp; &nbsp;
      <i class="fa fa-tags"></i>  misc  
      
    </div>
  </div>
  <hr>
  <p>React 起源于 Facebook 的内部项目，据说是因为该对市场上 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram 的网站，做出来以后，发现这套东西很好用，就在 2013 年 5 月开源了。</p>

<p>其设计思想极其独特，属于革命性创新，性能出众，代码逻辑却非常简单。</p>

<p>这里简单介绍其使用方法。</p>

<!-- more -->

<p><img src="/images/react-logo.png" alt="react logo" title="react logo " class="pull-center" width="70%" /></p>

<h2 id="1-安装使用">1. 安装使用</h2>

<p>React 的安装包可以从 <a href="https://reactjs.org/">官网</a> 下载，简单的示例可以参考 <a href="https://reactjs.org/docs/try-react.html">Try React</a>，其中 <a href="https://raw.githubusercontent.com/reactjs/reactjs.org/master/static/html/single-file-example.html">Single File Example</a> 是一个单页的示例。</p>

<p>关于发布版本可以查看 <a href="https://github.com/facebook/react/releases">Github React Release</a> 。</p>

<h2 id="2-html-模版">2. HTML 模版</h2>

<p>最简单的可以参考如上的 <a href="https://raw.githubusercontent.com/reactjs/reactjs.org/master/static/html/single-file-example.html">Single File Example</a> ，将其中的 JS 从 <a href="https://github.com/facebook/react/releases">Github React Release</a> 下载后，可以简化如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&lt;!DOCTYPE html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;meta charset=&quot;UTF-8&quot; /&gt;
		&lt;title&gt;Hello World&lt;/title&gt;
		&lt;script src=&quot;../build/react.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;../build/react-dom.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;../build/browser.min.js&quot;&gt;&lt;/script&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;div id=&quot;example&quot;&gt;&lt;/div&gt;
		&lt;script type=&quot;text/babel&quot;&gt;
			ReactDOM.render(&lt;h1&gt;Hello, world!&lt;/h1&gt;, document.getElementById(&#39;root&#39;));
		&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre></figure>

<p>需要注意的是，在最后一个 <code>&lt;script&gt;</code> 标签的 <code>type</code> 属性为 <code>text/babel</code>，这是因为 React 独有的 JSX 语法，跟 JavaScript 不兼容。</p>

<p>这里供用到了三个库：A) react.js 是 React 的核心库；B) react-dom.js 是提供与 DOM 相关的功能；C) browser.js 的作用是将 JSX 语法转为 JavaScript 语法，这一步很消耗时间，实际上线的时候，应该将它放到服务器完成。</p>

<!--
可以如下命令将 src 子目录的 js 文件进行语法转换，转码后的文件全部放在 build 子目录。


<figure class="highlight"><pre><code class="language-text" data-lang="text">$ babel src --out-dir build</code></pre></figure>

-->

<p>其中 <code>ReactDOM.render()</code> 是最基本用法，用于将模板转为 HTML 语言，并插入指定的 DOM 节点。</p>

<h2 id="3-jmx-语法">3. JMX 语法</h2>

<p>如上，HTML 语言直接写在 JavaScript 语言之中，不加任何引号，这就是 JSX 的语法，它允许 HTML 与 JavaScript 的混写。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var names = [&#39;Alice&#39;, &#39;Emily&#39;, &#39;Kate&#39;];

ReactDOM.render(
    &lt;div&gt;
    {
        names.map(function (name, index) {
            return &lt;div key={index}&gt;Hello, {name}!&lt;/div&gt;
        })
    }
    &lt;/div&gt;,
    document.getElementById(&#39;example&#39;)
);</code></pre></figure>

<p>如上是 JSX 的基本语法规则，遇到 HTML 标签 (以 <code>&lt;</code> 开头)，就用 HTML 规则解析；遇到代码块 (以 <code>{</code> 开头)，就用 JavaScript 规则解析。</p>

<p>实际上，JSX 允许直接在模板插入 JavaScript 变量，如果这个变量是一个数组，则会展开这个数组的所有成员。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var arr = [
    &lt;h1 key=&quot;1&quot;&gt;Hello world!&lt;/h1&gt;,
    &lt;h2 key=&quot;2&quot;&gt;React is awesome&lt;/h2&gt;,
];
ReactDOM.render(
    &lt;div&gt;{arr}&lt;/div&gt;,
    document.getElementById(&#39;example&#39;)
);</code></pre></figure>

<p>上面代码的arr变量是一个数组，结果 JSX 会把它的所有成员，添加到模板。</p>

<h2 id="4-组件">4. 组件</h2>

<p>允许将代码封装成组件，并像插入普通 HTML 标签一样，在网页中插入组件，<code>React.createClass</code> 方法就用于生成一个组件类。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var HelloMessage = React.createClass({
    render: function() {
        return &lt;h1&gt;Hello {this.props.name}&lt;/h1&gt;;
    }
});

ReactDOM.render(
    &lt;HelloMessage name=&quot;John&quot; /&gt;,
    document.getElementById(&#39;example&#39;)
);</code></pre></figure>

<p>上面代码中，变量 <code>HelloMessage</code> 就是一个组件类，当模板插入 <code>&lt;HelloMessage /&gt;</code> 时，会自动生成 <code>HelloMessage</code> 的一个实例，所有组件类都必须有自己的 render 方法，用于输出组件。</p>

<p><strong>注意</strong> 组件类的第一个字母必须大写，而且只能包含一个顶层标签，否则会报错，例如如下代码包含了两个顶层标签 <code>h1</code> 和 <code>p</code> 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var HelloMessage = React.createClass({
    render: function() {
        return &lt;h1&gt;
            Hello {this.props.name}
        &lt;/h1&gt;&lt;p&gt;
            some text
        &lt;/p&gt;;
    }
});</code></pre></figure>

<p>组件的用法与原生的 HTML 标签完全一致，可以任意加入属性，比如 <code>&lt;HelloMessage name="John"&gt;</code> ，就是 HelloMessage 组件加入一个 name 属性，值为 John。组件的属性可以在组件类的 <code>this.props</code> 对象上获取，比如 name 属性就可以通过 <code>this.props.name</code> 读取。</p>

<p>添加组件属性，需要注意 <code>class</code> 属性需要写成 <code>className</code> ，<code>for</code> 属性需要写成 <code>htmlFor</code> ，这是因为 <code>class</code> 和 <code>for</code> 是 <code>JavaScript</code> 的保留字。</p>

<h2 id="5-thispropschildren">5. this.props.children</h2>

<p><code>this.props</code> 对象的属性与组件的属性一一对应，但是有一个例外，就是 <code>this.props.children</code> 属性，它表示组件的所有子节点。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var NotesList = React.createClass({
    render: function() {
        return (
            &lt;ol&gt;
                {
                    React.Children.map(this.props.children, function (child) {
                        return &lt;li&gt;{child}&lt;/li&gt;;
                    })
                }
            &lt;/ol&gt;
        );
    }
});

ReactDOM.render(
    &lt;NotesList&gt;
        &lt;span&gt;hello&lt;/span&gt;
        &lt;span&gt;world&lt;/span&gt;
    &lt;/NotesList&gt;,
    document.getElementById(&#39;root&#39;)
);</code></pre></figure>

<p>上面代码的 <code>NoteList</code> 组件有两个 <code>span</code> 子节点，它们都可以通过 <code>this.props.children</code> 读取。</p>

<p><strong>注意</strong> <code>this.props.children</code> 的值有三种可能：A) 如果当前组件没有子节点，它就是 undefined；B) 如果有一个子节点，数据类型是 object；C) 如果有多个子节点，数据类型就是 array 。</p>

<p>为此提供一个工具方法 <code>React.Children</code> 来处理 <code>this.props.children</code>，可用 <code>React.Children.map</code> 来遍历子节点，而不用担心 <code>this.props.children</code> 的数据类型。</p>

<!--
https://reactjs.org/docs/react-api.html#react.children
-->

<h2 id="6-proptypes">6. PropTypes</h2>

<p>组件的属性可以接受任意值，字符串、对象、函数等等都可以；有时需要一种机制，验证别人使用组件时，提供的参数是否符合要求。</p>

<p>组件类的 <code>PropTypes</code> 属性，就是用来验证组件实例的属性是否符合要求。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var data = 123;

var MyTitle = React.createClass({
    propTypes: {
        title: React.PropTypes.string.isRequired,
    },

    render: function() {
        return &lt;h1&gt; {this.props.title} &lt;/h1&gt;;
    }
});

ReactDOM.render(
    &lt;MyTitle title={data} /&gt;,
    document.getElementById(&#39;example&#39;)
);</code></pre></figure>

<p>上面的 <code>Mytitle</code> 组件包含一个 title 属性，且通过 <code>PropTypes</code> 告诉 React，这个 title 属性是必须的，而且它的值必须是字符串，如上设置为了数值那么就会报错。</p>

<p>此时，控制台会显示一行错误信息。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Warning: Failed propType: Invalid prop `title` of type `number` supplied to `MyTitle`, expected `string`.</code></pre></figure>

<p>更多的 PropTypes 设置，可以查看<a href="https://reactjs.org/docs/components-and-props.html">官方文档</a>。</p>

<p>此外，可以通过 <code>getDefaultProps()</code> 方法可以用来设置组件属性的默认值。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var MyTitle = React.createClass({
    getDefaultProps : function () {
        return {
            title : &#39;Hello World&#39;
        };
    },

    render: function() {
        return &lt;h1&gt; {this.props.title} &lt;/h1&gt;;
    }
});

ReactDOM.render(
    &lt;MyTitle /&gt;,
    document.body
);</code></pre></figure>

<p>上面代码会输出 <code>Hello World</code>。</p>

<h2 id="7-获取真实的dom节点">7. 获取真实的DOM节点</h2>

<p>组件并不是真实的 DOM 节点，而是存在于内存之中的一种数据结构，叫做虚拟 DOM (virtual DOM)，只有当它插入文档以后，才会变成真实的 DOM 。</p>

<p>所有 DOM 变动都先发生在虚拟 DOM，然后再将实际发生变动的部分，反映在真实 DOM 上，该算法叫做 DOM diff ，可以提高网页性能。</p>

<p>但是，有时需要从组件获取真实 DOM 的节点，这时就要用到 ref 属性。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var MyComponent = React.createClass({
    handleClick: function() {
        this.refs.myTextInput.focus();
    },
    render: function() {
        return (
            &lt;div&gt;
                &lt;input type=&quot;text&quot; ref=&quot;myTextInput&quot; /&gt;
                &lt;input type=&quot;button&quot; value=&quot;Focus the text input&quot; onClick={this.handleClick} /&gt;
            &lt;/div&gt;
        );
    }
});

ReactDOM.render(
    &lt;MyComponent /&gt;,
    document.getElementById(&#39;root&#39;)
);</code></pre></figure>

<p>上面代码中，组件 <code>MyComponent</code> 的子节点有一个文本输入框，用于获取用户的输入，这时就必须获取真实的 DOM 节点，虚拟 DOM 是拿不到用户输入的。</p>

<p>为了做到这一点，文本输入框必须有一个 ref 属性，然后 <code>this.refs.[refName]</code> 就会返回这个真实的 DOM 节点。</p>

<!--
需要注意的是，由于 this.refs.[refName] 属性获取的是真实 DOM ，所以必须等到虚拟 DOM 插入文档以后，才能使用这个属性，否则会报错。上面代码中，通过为组件指定 Click 事件的回调函数，确保了只有等到真实 DOM 发生 Click 事件之后，才会读取 this.refs.[refName] 属性。

-->

<p>React 组件支持很多事件，除了 <code>Click</code> 事件以外，还有 <code>KeyDown</code>、<code>Copy</code>、<code>Scroll</code> 等，完整的事件清单请查看 <a href="https://reactjs.org/docs/events.html#supported-events">官方文档</a> 。</p>

<h2 id="8-thisstate">8. this.state</h2>

<p>组件免不了要与用户互动，React 的一大创新，就是将组件看成是一个状态机，一开始有一个初始状态，然后用户互动，导致状态变化，从而触发重新渲染 UI 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var LikeButton = React.createClass({
    getInitialState: function() {
        return {liked: false};
    },
    handleClick: function(event) {
        this.setState({liked: !this.state.liked});
    },
    render: function() {
        var text = this.state.liked ? &#39;like&#39; : &#39;haven\&#39;t liked&#39;;
        return (
            &lt;p onClick={this.handleClick}&gt;
                You {text} this. Click to toggle.
            &lt;/p&gt;
        );
    }
});

ReactDOM.render(
    &lt;LikeButton /&gt;,
    document.getElementById(&#39;root&#39;)
);</code></pre></figure>

<p>上面代码是一个 <code>LikeButton</code> 组件，其中 <code>getInitialState()</code> 用于定义初始状态，也就是一个对象，这个对象可以通过 <code>this.state</code> 属性读取。</p>

<p>用户点击组件状态发生变化，<code>this.setState()</code> 修改状态值，每次修改后会自动调用 <code>this.render()</code> 再次渲染组件。</p>

<p>其中 <code>this.props</code> 和 <code>this.state</code> 都用于描述组件特性，易混淆，简单区分方法是：A) <code>this.props</code> 表示那些一旦定义，就不再改变的特性；B) <code>this.state</code> 会随用户互动而产生变化的特性。</p>

<h2 id="9-表单">9. 表单</h2>

<p>用户在表单填入的内容，属于用户跟组件的互动，所以不能用 <code>this.props</code> 读取。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var Input = React.createClass({
    getInitialState: function() {
        return {value: &#39;Hello!&#39;};
    },
    handleChange: function(event) {
        this.setState({value: event.target.value});
    },
    render: function () {
        var value = this.state.value;
        return (
            &lt;div&gt;
                &lt;input type=&quot;text&quot; value={value} onChange={this.handleChange} /&gt;
                &lt;p&gt;{value}&lt;/p&gt;
            &lt;/div&gt;
        );
    }
});

ReactDOM.render(&lt;Input/&gt;, document.getElementById(&#39;root&#39;));</code></pre></figure>

<p>上面代码中，文本输入框的值，不能用 <code>this.props.value</code> 读取，而要定义一个 <code>onChange()</code> 事件的回调函数，通过 <code>event.target.value</code> 读取用户输入的值。</p>

<!--
textarea 元素、select元素、radio元素都属于这种情况，更多介绍请参考官方文档。
https://reactjs.org/docs/forms.html
-->

<h2 id="10-组件的生命周期">10. 组件的生命周期</h2>

<p>组件的生命周期分成三个状态。</p>

<!--
        Mounting：已插入真实 DOM
        Updating：正在被重新渲染
        Unmounting：已移出真实 DOM
-->

<p>React 为每个状态都提供了两种处理函数，will 函数在进入状态之前调用，did 函数在进入状态之后调用，三种状态共计五种处理函数。</p>

<!--
        componentWillMount()
        componentDidMount()
        componentWillUpdate(object nextProps, object nextState)
        componentDidUpdate(object prevProps, object prevState)
        componentWillUnmount()

此外，React 还提供两种特殊状态的处理函数。

        componentWillReceiveProps(object nextProps)：已加载组件收到新的参数时调用
        shouldComponentUpdate(object nextProps, object nextState)：组件判断是否重新渲染时调用
-->

<p>下面是一个例子。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var Hello = React.createClass({
    getInitialState: function () {
        return { opacity: 1.0 };
    },

    componentDidMount: function () {
        this.timer = setInterval(function () {
            var opacity = this.state.opacity;
            opacity -= .05;
            if (opacity &lt; 0.1) {
                    opacity = 1.0;
            }
            this.setState({
                opacity: opacity
            });
        }.bind(this), 100);
    },

    render: function () {
        return (
            &lt;div style= { { opacity: this.state.opacity } }&gt;
                Hello {this.props.name}
            &lt;/div&gt;
        );
    }
});

ReactDOM.render(
    &lt;Hello name=&quot;world&quot;/&gt;,
    document.getElementById(&#39;root&#39;)
);</code></pre></figure>

<p>上面代码在 <code>Hello</code> 组件加载以后，通过 <code>componentDidMount()</code> 设置一个定时器，每隔 100 毫秒，就重新设置组件的透明度，从而引发重新渲染。</p>

<p>另外，组件的 style 属性的设置方式也值得注意，不能写成 <code>style="opacity:{this.state.opacity};"</code> 而要写成 <code>style= { { opacity: this.state.opacity } }</code> 这是因为 React 组件样式是一个对象，所以第一重大括号表示这是 JavaScript 语法，第二重大括号表示样式对象。</p>

<h2 id="11-ajax">11. AJAX</h2>

<p>组件的数据来源，通常是通过 AJAX 请求从服务器获取，可以使用 <code>componentDidMount()</code> 设置 AJAX 请求，等到请求成功，再用 <code>this.setState()</code> 方法重新渲染 UI 。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var UserGist = React.createClass({
    getInitialState: function() {
        return {
            username: &#39;&#39;,
            lastGistUrl: &#39;&#39;
        };
    },

    componentDidMount: function() {
        $.get(this.props.source, function(result) {
            var lastGist = result[0];
            this.setState({
                username: lastGist.owner.login,
                lastGistUrl: lastGist.html_url
            });
        }.bind(this));
    },

    render: function() {
        return (
            &lt;div&gt;
                {this.state.username}&#39;s last gist is &lt;a href={this.state.lastGistUrl}&gt;here&lt;/a&gt;.
            &lt;/div&gt;
        );
    }
});

ReactDOM.render(
    &lt;UserGist source=&quot;https://api.github.com/users/octocat/gists&quot; /&gt;,
    document.getElementById(&#39;root&#39;)
);</code></pre></figure>

<p>另外一个示例如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">var RepoList = React.createClass({
    getInitialState: function() {
        return {
            loading: true,
            error: null,
            data: null
        };
    },

    componentDidMount() {
        this.props.promise.then(
            value =&gt; this.setState({loading: false, data: value}),
            error =&gt; this.setState({loading: false, error: error})
        );
    },

    render: function() {
        if (this.state.loading) {
            return &lt;span&gt;Loading...&lt;/span&gt;;
        } else if (this.state.error !== null) {
            return &lt;span&gt;Error: {this.state.error.message}&lt;/span&gt;;
        } else {
            var repos = this.state.data.items;
            var repoList = repos.map(function (repo, index) {
                return (
                    &lt;li key={index}&gt;&lt;a href={repo.html_url}&gt;{repo.name}&lt;/a&gt;
                    ({repo.stargazers_count} stars) &lt;br/&gt; {repo.description}&lt;/li&gt;
                );
            });
            return (
                &lt;main&gt;
                    &lt;h1&gt;Most Popular JavaScript Projects in Github&lt;/h1&gt;
                    &lt;ol&gt;{repoList}&lt;/ol&gt;
                &lt;/main&gt;
            );
        }
    }
});

ReactDOM.render(
    &lt;RepoList promise={$.getJSON(&#39;https://api.github.com/search/repositories?q=javascript&amp;sort=stars&#39;)} /&gt;,
    document.getElementById(&#39;example&#39;)
);</code></pre></figure>

<h2 id="组件生命周期">组件生命周期</h2>

<p><img src="/images/javascripts/react/component-lifecycle.jpg" alt="react lifecycle" title="react lifecycle" class="pull-center" width="90%" /></p>

<!--
getDefaultProps

object getDefaultProps()

执行过一次后，被创建的类会有缓存，映射的值会存在this.props,前提是这个prop不是父组件指定的
这个方法在对象被创建之前执行，因此不能在方法内调用this.props ，另外，注意任何getDefaultProps()返回的对象在实例中共享，不是复制
getInitialState

object getInitialState()

控件加载之前执行，返回值会被用于state的初始化值
componentWillMount

void componentWillMount()

执行一次，在初始化render之前执行，如果在这个方法内调用setState，render()知道state发生变化，并且只执行一次
render

ReactElement render()

render的时候会调用render()会被调用
调用render()方法时，首先检查this.props和this.state返回一个子元素，子元素可以是DOM组件或者其他自定义复合控件的虚拟实现
如果不想渲染可以返回null或者false，这种场景下，React渲染一个<noscript>标签，当返回null或者false时，ReactDOM.findDOMNode(this)返回null
render()方法是很纯净的，这就意味着不要在这个方法里初始化组件的state，每次执行时返回相同的值，不会读写DOM或者与服务器交互，如果必须如服务器交互，在componentDidMount()方法中实现或者其他生命周期的方法中实现，保持render()方法纯净使得服务器更准确，组件更简单
componentDidMount

void componentDidMount()

在初始化render之后只执行一次，在这个方法内，可以访问任何组件，componentDidMount()方法中的子组件在父组件之前执行

从这个函数开始，就可以和 JS 其他框架交互了，例如设置计时 setTimeout 或者 setInterval，或者发起网络请求
shouldComponentUpdate

boolean shouldComponentUpdate(
  object nextProps, object nextState
)

    1
    2
    3

这个方法在初始化render时不会执行，当props或者state发生变化时执行，并且是在render之前，当新的props或者state不需要更新组件时，返回false

shouldComponentUpdate: function(nextProps, nextState) {
  return nextProps.id !== this.props.id;
}

    1
    2
    3

当shouldComponentUpdate方法返回false时，讲不会执行render()方法，componentWillUpdate和componentDidUpdate方法也不会被调用

默认情况下，shouldComponentUpdate方法返回true防止state快速变化时的问题，但是如果·state不变，props只读，可以直接覆盖shouldComponentUpdate用于比较props和state的变化，决定UI是否更新，当组件比较多时，使用这个方法能有效提高应用性能
componentWillUpdate

void componentWillUpdate(
  object nextProps, object nextState
)

    1
    2
    3

当props和state发生变化时执行，并且在render方法之前执行，当然初始化render时不执行该方法，需要特别注意的是，在这个函数里面，你就不能使用this.setState来修改状态。这个函数调用之后，就会把nextProps和nextState分别设置到this.props和this.state中。紧接着这个函数，就会调用render()来更新界面了
componentDidUpdate

void componentDidUpdate(
  object prevProps, object prevState
)

    1
    2
    3

组件更新结束之后执行，在初始化render时不执行
componentWillReceiveProps

void componentWillReceiveProps(
  object nextProps
)

    1
    2
    3

当props发生变化时执行，初始化render时不执行，在这个回调函数里面，你可以根据属性的变化，通过调用this.setState()来更新你的组件状态，旧的属性还是可以通过this.props来获取,这里调用更新状态是安全的，并不会触发额外的render调用

componentWillReceiveProps: function(nextProps) {
  this.setState({
    likesIncreasing: nextProps.likeCount > this.props.likeCount
  });
}

    1
    2
    3
    4
    5

componentWillUnmount

void componentWillUnmount()

当组件要被从界面上移除的时候，就会调用componentWillUnmount(),在这个函数中，可以做一些组件相关的清理工作，例如取消计时器、网络请求等
总结

React Native的生命周期就介绍完了，其中最上面的虚线框和右下角的虚线框的方法一定会执行，左下角的方法根据props state是否变化去执行，其中建议只有在componentWillMount,componentDidMount,componentWillReceiveProps方法中可以修改state值
-->

<h2 id="参考">参考</h2>

<p>这里大部分是参考阮一峰的 <a href="http://www.ruanyifeng.com/blog/2015/03/react.html">React 入门实例教程</a> 。</p>

<!--
https://reactjs.org/

https://github.com/ruanyf

http://recharts.org/#/zh-CN
https://react-bootstrap.github.io/

https://ui-router.github.io/react/

Admin antd
https://github.com/zuiidea/antd-admin
https://github.com/ant-design/ant-design-pro

Admin on rest
https://github.com/marmelab/admin-on-rest-demo
https://github.com/api-platform/admin

Adminite
https://github.com/zksailor534/react-adminlte-dash
https://github.com/booleanhunter/ReactJS-AdminLTE

CoreUI
https://github.com/mrholek/CoreUI-Free-Bootstrap-Admin-Template
https://github.com/mrholek/coreui-free-react-admin-template

Blur Admin
https://github.com/knledg/react-blur-admin

https://github.com/MacKentoch/react-director-admin-template
https://github.com/rafaelhz/react-material-admin-template
https://github.com/jtg2078/campaign-admin
https://github.com/vaclav-zeman/dashboard-react-template
-->


  <hr>
  <nav>
    <ul class="pager">
         <li class="previous"><a href="/post/program-c-elf-symbol-section.html" title="ELF 符号表">&larr; Older</a></li> 
         <li class="next"><a href="/post/message-queue-beanstalk-introduce.html" title="Beanstalk 使用简介">Newer &rarr;</a></li> 
    </ul>
  </nav><br>
<!--
  <hr><div id="section-donate"><span>赏</span></div><br>
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p><br>
  <div class="row" style="text-align:center;" >
    <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
    <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
  </div><br><hr>
-->
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p>
  <div id="donate_module">
    <style type="text/css">
      .donate_bar a.btn_donate{
        display: inline-block;
        position:      relative;
        text-align:    center;
        width: 82px;
        height: 82px;
        background: url("/images/misc/btn_reward.gif") no-repeat;
        _background: url("/images/misc/btn_reward.gif") no-repeat;
        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
      }
      .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
      .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
      }
    </style>
    <div id="donate_board" class="donate_bar row" style="text-align:center;" >
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    </div>
    <div id="donate_guide" class="donate_bar center hidden">
      <div class="row" style="text-align:center;" >
        <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
        <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function(){
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
    </script>
  </div>

  <hr>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      id: '1515772800',
      owner: 'Jin-Yang',
      repo: 'jin-yang.github.com',
      oauth: {
          client_id: '6d89d48ce689192bf95d',
          client_secret: 'c9a720aafb8e3084e3feb46cadee80b03cdc792f',
      },
  });
  gitment.render('gitmentContainer');
  </script>

  <!-- 多说评论框 start -->
  <!--<div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>-->
  <!--
  <div class="ds-thread" data-thread-key="/post/react-practice-examples.html" data-title="React 简明教程" data-url="/post/react-practice-examples.html"></div>
  -->
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <!--
  <script type="text/javascript">
      var duoshuoQuery = {short_name:"jinyangposts"};
      (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
  </script>
  -->
  <!-- 多说公共JS代码 end -->
</div>

    </div>
    <div class="col-lg-3 visible-lg blog-sidebar">
    <center><a href="/"><img src="/images/system/linux-liberty.png" width="200" /></a></center>
<h2>About This Blog</h2>
<div class="sidebar-module">
<p style="text-indent:0em;margin:0px;padding:0px;">This is a personal weblog ^_^ generated with Jekyll, if you like it or have some questions,
just feel free to contact me :)</p>
</div><!-- end of "node" "about" -->



<h2>Recent Posts</h2>
<div class="list-group">
  
    <a class="list-group-item" href="/post/linux-program-cpu-cache-introduce_init.html">CPU Cache</a>
  
    <a class="list-group-item" href="/post/artificial-intelligence-decision-tree-introduce.html">决策树</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-bcc-tools-introduce.html">BCC 工具使用</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-basic-usage-introduce.html">eBPF 简介</a>
  
    <a class="list-group-item" href="/post/math-monte-carlo-sample-introduce.html">采样算法</a>
  
</div>

<h2>Categories</h2>
<ul class="list-group" style="margin:0px;">
  
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#bash"> bash</a>
    <span class="badge">2</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#database"> database</a>
    <span class="badge">86</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#golang"> golang</a>
    <span class="badge">28</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#linux"> linux</a>
    <span class="badge">301</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#misc"> misc</a>
    <span class="badge">244</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#mysql"> mysql</a>
    <span class="badge">79</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#network"> network</a>
    <span class="badge">49</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#postgresql"> postgresql</a>
    <span class="badge">4</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#program"> program</a>
    <span class="badge">138</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#python"> python</a>
    <span class="badge">25</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#react"> react</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#rtems"> rtems</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#sql"> sql</a>
    <span class="badge">10</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#tools"> tools</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#webserver"> webserver</a>
    <span class="badge">25</span>
  </li>
  
</ul><!-- end of "node" "categories" -->

<h2>Related Links</h2>
<ul class="list-group" style="margin:0px">
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.rtems.org" title="To RTEMS"><img class="img-thumbnail img-responsive" src="/images/system/rtems.png"  alt="RTEMS"/></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>RTEMS</strong><br>
        <div class="sidebar-description">Real-Time Executive for Multiprocessor System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.gnu.org" title="To GNU">
       <img class="img-thumbnail img-responsive" src="/images/system/gnu.jpg" alt="GNU" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>GNU</strong><br>
        <div class="sidebar-description">A Unix-linux Operating System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://www.kernel.org" title="To Linux Kernel">
    <img class="img-thumbnail img-responsive" src="/images/system/linux.png"  alt="LINUX" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Linux Kernel</strong><br>
        <div class="sidebar-description">Maintained by Linux Kernel Organization</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://arduino.cc" title="To Arduino">
    <img class="img-thumbnail img-responsive" src="/images/system/arduino.png"  alt="ARDUINO" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Arduino</strong><br>
        <div class="sidebar-description">Open-source Electronic Prototyping Platform</div>
      </div>
    </div>
  </li>
</ul>

<h2>Search</h2>
<div class="sidebar-module">
  <form class="search" method="GET" action="https://www.google.com.hk/search">
    <input type="text" name="q" class="search-query" placeholder=" Search on Google">
    <input type="hidden" name="ie" value="utf-8">
    <input type="submit" name="sa" value="Search" />
  </form><br>
  <input type="text" class="search-field" placeholder=" Search This Site">
  <div class="search-results"></div>
</div>



    </div>
  </div>
<hr><p class="text-center">This Site was built by Jin Yang, generated with Jekyll, and hosted on GitHub Pages<br/> &copy;2013-2019 &ndash; Jin Yang</p><div class="footer-logo"></div>

</div>
</body>
</html>
