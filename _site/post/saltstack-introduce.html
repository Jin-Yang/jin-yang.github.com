<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <meta name="baidu-site-verification" content="B786jeR0MV" />
  <meta name="msvalidate.01" content="29F791E7F785800340E37AD7C714D2A7" />
  <meta name="google-site-verification" content="p7jJ5d3kF9yxRhpIo5GgHXAZ1ATKVyZhV2kf6mEGOv0" />
  <title>SaltStack 简介|JinYang's Blog</title>
  <meta name="keywords" content="hello world,示例,sample,markdown">
  <meta name="description" content="SaltStack 是一个轻量级的运维工具，具备配置管理、远程执行、监控等功能，类似于 Puppet 和 Chef，不过这两者是用 Ruby 写的，而 Salt Stack 用的是 Python。">

  <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">
  !window.jQuery && document.write('<script src="/static/js/jquery.min.js"><\/script>');
  </script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  !$('body').popover && document.write('<script src="/static/js/bootstrap.min.js"><\/script>');
  </script>
  <script type="text/javascript" src="/static/js/main.js"></script>
  <!-- <link rel="stylesheet prefetch" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/bootstrap.min.css">
  <!-- <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/font-awesome.min.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/pygments.css">
  <link type="text/css" rel="stylesheet prefetch" href="/static/css/screen.css">
  <style type="text/css">
  
    .post-container > p {text-indent: 2em;}
  
  </style>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124556620-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124556620-1');
</script>

</head>

<body>
<nav class="navbar navbar-default navbar-inverse navbar-fixed-top navbar-wrapper">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button><a class="navbar-brand" href="/">Jin-Yang</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li  ><a href="/"> Home </a></li>
        <li  ><a href="/archives.html"> Archive </a></li>
        <li  ><a href="/categories.html"> Categories </a></li>
        <li  ><a href="/projects.html"> Projects </a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Others <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">常用网站</li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.rtems.org/">www.rtems.org</a></li>
            <li><a href="http://www.gnu.org/">www.gnu.org</a></li>
            <li><a href="https://www.kernel.org/">www.kernel.org</a></li>
            <li><a href="https://www.arduino.cc/">www.arduino.cc</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li  ><a href="/about.html"> About </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
    <li data-target="#myCarousel" data-slide-to="4"></li>
  </ol>
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>KISS</h1>
          <h2>Keep It Simple and Stupid.</h2>
          <!--<a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a>-->
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Seize The Day</h1><h1>And Get Busy Living</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Stay hungry</h1><h1>Stay foolish</h1>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
	  <h2>Ever tried, ever failed</h2><h2>No matter, try again</h2><h2>Fail again, fail better</h2>
        </div>
      </div>
    </div>
    <div class="item">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
      <div class="container">
        <div class="carousel-caption">
          <h1>Nothing is true</h1><h1>Every is permitted</h1>
        </div>
      </div>
    </div>
  </div>
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div><!-- /.carousel -->

<div class="container">
  <div class="row">
    <div class="col-lg-9 blog-main" style="min-width: 500px">
    
<div class="post-container">
  <div class="blog-header">
    <h1>SaltStack 简介</h1>
    <div class="post-description">
      <i class="fa fa-calendar"></i> 2016-01-02 Saturday &nbsp; &nbsp;
      <i class="fa fa-tags"></i>  misc ,  linux ,  python  
      
    </div>
  </div>
  <hr>
  <p>SaltStack 是一个轻量级的运维工具，具备配置管理、远程执行、监控等功能，类似于 Puppet 和 Chef，不过这两者是用 Ruby 写的，而 Salt Stack 用的是 Python。</p>

<p>结下来看看具体的使用。</p>

<!-- more -->

<h2 id="简介">简介</h2>

<p>SaltStack 基于 Python 写的经典 C/S 框架的自动化部署平台，由 Master 和 Minion 构成，使用了一系列成熟的工具，比如网络模型采用 ZeroMQ、授权加密采用了 AES、串行化采用了 msgpack、配置文件采用 <a href="http://www.yaml.org/">YAML</a> 标记语言等。</p>

<h3 id="安装测试">安装测试</h3>

<p>在 CentOS7 中可以通过如下方式在单机安装测试。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 直接通过YUM安装相关的依赖包
# yum --enablerep=epel install salt salt-master salt-minion salt-ssh
# systemctl start salt-master                # 启动master
# salt-master -d                             # 同上，直接通过命令行启动，指定后台运行
# netstat -ltunp | grep python               # 查看打开的端口，默认为4505/4506
# lsof -i:4505                               # 同上，查看使用4505端口的程序

# cat /etc/salt/minion                       # 修改配置文件
master: localhost   # master的IP地址
id: foobar          # 指定minion的ID
# systemctl start salt-minion                # 启动minion

$ salt --version                             # 查看版本号
$ salt --versions-report                     # 查看其它依赖模块的版本号

----- 测试，常见的使用方式
# salt-key -A                                # 添加本地节点
# salt &quot;*&quot; test.ping                         # 测试节点
# salt &quot;*&quot; cmd.run &#39;uptime&#39;                  # 执行命令
# salt -G &quot;os:Centos&quot; test.ping              # 根据被控主机的grains信息过滤
# salt &quot;*&quot; grains.item os                    # 查看操作系统类型
--- 执行代码，等同于python -c &#39;import sys; print sys.version&#39;
# salt &#39;*&#39; cmd.exec_code python &#39;import sys; print sys.version&#39;</code></pre></figure>

<p>实际上 master/minion 只会安装少数的文件，主要文件在 salt 安装包中。</p>

<p>SaltStack master 启动后默认监听 4505 和 4506 两个端口，其中 4505(publish_port) 为 salt 的消息发布系统，4506 (ret_port) 为 salt 客户端与服务端通信的端口。</p>

<h2 id="masterminion-的认证和链接">Master/Minion 的认证和链接</h2>

<p>SaltStack 主控端是依靠 openssl 证书来与受控端主机认证通讯的，受控端启动后会发送给主控端一个公钥证书文件，在主控端用 salt-key 命令来管理证书。</p>

<p>认证过程如下。</p>

<ol>
  <li>
    <p>在安装 minion 之后，需要在配置文件中定义参数 master，也就是指定 master 端的 IP 地址；</p>
  </li>
  <li>
    <p>启动 minion 服务后会在本地生成一个密钥对；</p>
  </li>
  <li>
    <p>接着 minion 会去连接 master，并尝试把公钥发送给 master，这时在 master 端可以使用 salt-key 来查看当前已经接收到的认证。</p>
  </li>
</ol>

<p>在 master 接受 minion 认证之后，两者即可通讯了，可以通过 state 模块来配置管理 minion，也可以通过 cmd.run 远程对 minion 执行命令。</p>

<p>详细来说，minion 在第一次启动时，会在配置文件 (默认为/etc/salt/minion) 中的配置项 pki_dir 指定目录下（默认为 /etc/salt/pki/minion/）下自动生成 minion.pem (private key) 和 minion.pub (public key)，然后将 minion.pub 发送给 master。</p>

<p>master 在接收到 minion 的 public key 后，通过 salt-key 命令 accept minion public key，这样在 master 的 /etc/salt/pki/master/minions 下的将会存放以 minion id 命名的 public key，然后 master 就能对 minion 发送指令了。</p>

<p>常见的命令有：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt-key -L                                # 查看所有节点，包括未认证的节点
# salt-key -A                                # 添加所有未认证的节点
# salt-key -a node*                          # 支持单个节点、以及通配符
# salt-key -d node                           # 删除对某个节点的认证
# salt-key -D                                # 删除所有证书</code></pre></figure>

<h2 id="执行命令">执行命令</h2>

<p>SaltStack 执行命令的格式如下。</p>

<p><img src="/images/network/saltstack/cmd-syntax.png" alt="SaltStack Commands Syntax" title="SaltStack Commands Syntax" class="pull-center" /></p>

<p>常用的命令如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; sys.doc                      # 查看所有文档
# salt &#39;*&#39; sys.doc pkg.install          # 查看pkg.install对应的文档

# salt &#39;*&#39; cmd.run &#39;ls -l /bin/ls&#39;      # 直接执行终端命令
# salt &#39;*&#39; disk.usage                   # 查看磁盘使用情况
# salt &#39;*&#39; network.interfaces           # 查看网络设备

# salt &#39;*&#39; pkg.install coreutils        # 安装软件</code></pre></figure>

<p>在 SaltStack 中，目前有 5 种方式来指定目标机器。</p>

<ol>
  <li>
    <p>匹配 minion id，可以使用 shell 通配符 (Globbing)、正则表达式(Perl风格)、minion 列表。</p>
  </li>
  <li>
    <p>Grains，包括客户端配置文件中定义 Grains。</p>
  </li>
  <li>
    <p>指定列表 (Lists)，节点分组 (Node Groups)，复合匹配 (Compound Matcher)，批量执行 (Batch Size)。</p>
  </li>
</ol>

<p>可以参考如下的示例。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; test.ping                                    # 所有的minions
# salt &#39;*.example.*&#39; test.ping                          # 可以使用shell中的* ? []通配符
# salt &#39;web?&#39; test.ping                                 # 匹配web1、web2等
# salt &#39;web-[x-z]&#39; test.ping                            # 匹配web-x、web-y、web-z

# salt -E &#39;web1-(prod|devel)&#39; test.ping                 # 使用正则表达式

# salt -L &#39;web1,web2,web3&#39; test.ping                    # 指定列表

# salt -G &#39;os:CentOS&#39; test.ping                         # 使用Grains

# salt -N group1 test.ping                              # 指定分组节点node group

# salt -C &#39;web? and G@os:CentOS or E@web.*&#39; test.ping   # 使用组合模式

# salt &#39;*&#39; -b 10 test.ping                              # 使用批量模式
# salt -G &#39;os:RedHat&#39; --batch-size 25% test.ping</code></pre></figure>

<p>在不指定 minion id，则会通过 socket.getfqdn() 获取，可以通过如下命令查看，同时该值会缓存在 /etc/salt/minion_id 中。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ python -c &#39;import socket; print socket.getfqdn(socket.gethostname())&#39;</code></pre></figure>

<p>节点分组可以在 master 配置文件中进行设置，如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">nodegroups:
  group1: &#39;L@foo.domain.com,bar.domain.com,baz.domain.com or bl*.domain.com&#39;
  group2: &#39;G@os:Debian and foo.domain.com&#39;</code></pre></figure>

<p>复合匹配是通过布尔操作符连接的多个目标条件，可以使用上述的几种方式匹配，默认采用 Globbing。另外，not 不能用于第一个条件，需要使用如下的命令 salt -C ‘* and not G@os:CentOS’ test.ping 。</p>

<p>相关匹配规则的语法可以参考 <a href="https://docs.saltstack.com/en/latest/topics/targeting/compound.html">staltstack docs - Compoud Matchers</a> 。</p>

<h2 id="salt-state-sls">Salt State, SLS</h2>

<p>State 用于描述系统的目标状态，SLS 代表 SaLt State 文件，是 Salt State 系统的核心；SLS 描述了系统的目标状态，采用最简单易读的序列化数据格式 YAML。</p>

<p>其中根路径在 master 的配置文件中通过 file_roots 指定，其中 base 必须存在，而且 base 环境中通常包含 Salt 的入口 top 文件，也即 top.sls 。注意，sls 文件需要同时在 master 和 minion 都存在。</p>

<p>最简单的配置文件如下，用于检查 coreutils 是否已经安装，与 state 相关的源码保存在 salt/states 目录下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># cat top.sls
base:
  &#39;*&#39;:
    - coreutils
# cat coreutils.sls
coreutils:                       # ID声明
   pkg:                          # state声明
      - installed                # 定义的function</code></pre></figure>

<p>在配置文件中，可以通过 salt:// 代替配置文件中 file_roots 指定的根路径，入口文件默认为 top.sls，可以通过 state_top 配置。</p>

<!--
对于机器的匹配方式可以有多种。

<pre style="font-size:0.8em; face:arial;">
base:
  'web1-(prod|devel)':                                 # 匹配minion-id
    - match: pcre                                      # 设置匹配方式
    - webserver

base:
  group1:
    - match: nodegroup                                 # 通过节点分组匹配
    - webserver

base:
  'webserv* and G@os:Debian or E@web-dc1-srv.*':       # 使用组合模式
    - match: compound
    - webserver
</pre>
-->

<h2 id="pillar-vs-grains">Pillar VS. Grains</h2>

<p>Pillar 和 Grains 非常容易混淆，其中 Grain 的数据是在 minion 启动时产生的，通常是类似于 OS、CPU、磁盘的静态信息；而 Pillar 信息保存在 master 中。</p>

<p>Salt在 0.9.8 版本中引入了 Pillar，Pillar 是一个非常重要的组件，用于给特定的 minion 定义任何需要的数据，这些数据可以被 Salt 的其他组件使用。Pillar 解析后，是一个嵌套的字典结构，最上层的 key 是 minion ID，也就是说 Pillar 数据是与特定 minion 关联的，每一个 minion 只能看到自己的数据。</p>

<p>Pillar 使用独立的加密 session，所以 Pillar 可以用来传递敏感数据，如 ssh key、加密证书等。</p>

<p>默认情况下，master 配置文件中的所有数据都添加到 Pillar 中，且对所有 minion 可用，如果要禁用这一默认值，可以添加 pillar_opts: False 配置。Pillar 使用与 State 相似的 SLS 文件，其根目录通过 master 配置文件中 pillar_roots 指定，而且 Pillar 也有 top file。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; pillar.data                         # 或者pillar.raw
# salt &#39;*&#39; saltutil.refresh_pillar             # 修改Pillar文件后刷新minion上的数据</code></pre></figure>

<p>对于 Grains 常见的操作如下。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; grains.ls                           # 列出所有grains的名字
# salt &#39;*&#39; grains.items                        # 列出名字以及内容
# salt &#39;*&#39; grains.item os                      # 查看具体选项</code></pre></figure>

<p>可以在 minion 的配置文件中 (默认为/etc/salt/minion) 设置 Grains 的静态信息。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">grains:
  roles:
    - webserver
    - memcache
  deployment: datacenter4</code></pre></figure>

<p>另外，可在 master 中定义模块，可以将脚本放置在 file_roots 下的 _grains 目录中，当执行 state.highstate、saltutil.sync_grains、saltutil.sync_all 时，会将 _grains 中的文件分发到客户端上。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># mkdir /srv/salt/_grains
# cat /srv/salt/_grains/custom_grain.py
    def custom_grains():
        grains = {&#39;role&#39; : &#39;LB&#39;}
        return grains
# salt &#39;*&#39; saltutil.sync_grains
# salt &#39;*&#39; grains.item role</code></pre></figure>

<p>上述的脚本会作为模块导入，因此不需要 #!/usr/bin/env python，也不需要有执行权限。</p>

<h2 id="模块">模块</h2>

<p>一些常见的模块会保存在安装目录下的 salt/modules 下，如果通过 YUM 安装，通常为：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ ls /usr/lib/python2.7/site-packages/salt/modules</code></pre></figure>

<p>在 Python 中，如果要添加模块也非常简单，可以直接在安装目录的 modules 子目录下添加如下文件。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># cat /usr/lib/python2.7/site-packages/salt/modules/foobar.py
def hello():
    return &#39;hello world&#39;</code></pre></figure>

<p>然后可以通过 salt ‘*’ foobar.hello 执行。</p>

<h3 id="常用模块介绍">常用模块介绍</h3>

<p>下面看下一些常见的模块，除此之外还有 grains、pillar、states、modules、returner、runners、reactor 等模块。</p>

<h4 id="cp模块">cp模块</h4>

<p>实现远程文件、目录的复制，以及下载URL文件等操作。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">----- 将主服务器file_roots base指定目录下的文件复制到被控主机
# cat /etc/salt/master
file_roots:
  base:
    - /srv/salt
# echo &quot;This is test file with saltstack module &#39;cp.get_file&#39;&quot; &gt; /srv/salt/foobar.txt
# salt &#39;*&#39; cp.get_file salt://foobar.txt /tmp/foobar.txt

----- 将目录下的文件复制到被控主机
# mkdir /srv/salt/dir &amp;&amp; mv /srv/salt/foobar.txt /srv/salt/dir/
# salt &#39;*&#39; cp.get_dir salt://dir /tmp

----- 下载指定URL内容到被控主机指定位置
# salt &#39;*&#39; cp.get_url http://justkidding.com/download/files.tgz /tmp/files.tgz

----- 根据grains选择目标
# salt &#39;*&#39; cp.get_file &quot;salt:///vimrc&quot; /etc/vimrc template=test</code></pre></figure>

<p>该模块有几个常用的参数：</p>

<ul>
  <li>
    <p>gzip=9，使用gzip的方式进行压缩，数字越大，压缩率就越高，9代表最大的压缩率。</p>
  </li>
  <li>
    <p>makedirs=True，当分发的位置在目标主机上不存在时，自动创建该目录。</p>
  </li>
</ul>

<p>模板渲染功能可以同时在源和目标文件中使用。</p>

<h4 id="cmd-模块">cmd 模块</h4>

<p>实现远程的命令行调用执行。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; cmd.run &#39;uptime&#39;</code></pre></figure>

<h4 id="file模块">file模块</h4>

<p>被控主机文件常见操作，包括文件读写、权限、查找、校验等。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; file.get_sum /etc/resolv.conf md5
# salt &#39;*&#39; file.stats /etc/resolv.conf</code></pre></figure>

<h4 id="pkg-包管理模块">pkg 包管理模块</h4>

<p>被控主机程序包管理，如yum、apt-get等。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; pkg.install coreutils
# salt &#39;*&#39; pkg.file_list coreutils</code></pre></figure>

<h4 id="network模块">network模块</h4>

<p>返回被控主机网络信息。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; network.ip_addrs
# salt &#39;*&#39; network.interfaces</code></pre></figure>

<h4 id="service-服务模块">service 服务模块</h4>

<p>被控主机程序包服务管理。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># salt &#39;*&#39; service.start crond
# salt &#39;*&#39; service.status crond</code></pre></figure>

<!--
## salt-api

https://docs.saltstack.com/en/latest/ref/clients/


<figure class="highlight"><pre><code class="language-text" data-lang="text"># -*- coding:utf-8 -*-
import salt.config

# 获取master配置文件
master_ops = salt.config.client_config(&#39;/etc/salt/master&#39;)#returns a dictionary

# 获取minion配置文件
minion_opts = salt.config.minion_config(&#39;/etc/salt/minion&#39;)#returns a dictionary

# 获取grain值
import salt.loader
opts = salt.config.minion_config(&#39;/etc/salt/minion&#39;)
grains = salt.loader.grains(opts)
print grains[&#39;id&#39;]

# 执行salt命令的函数，一般返回字典
import salt.client
local = salt.client.LocalClient()
print local.cmd(&#39;*&#39;, &#39;test.ping&#39;, [])</code></pre></figure>

-->

<h2 id="配置文件">配置文件</h2>

<figure class="highlight"><pre><code class="language-text" data-lang="text">interface: 0.0.0.0                    # 监听IP
publish_port: 4505                    # 消息发布端口
user: root                            # 默认用户
max_open_files: 100000                # 最大打开文件数
worker_threads: 5                     # 工作线程数，不能小于3
ret_port: 4506                        # master和minion使用的通讯端口
pidfile: /var/run/salt-master.pid     # PID文件

root_dir
pki_dir: /etc/salt/pki/master        # 存放公钥的目录
    cachedir
    keep_jobs
    job_cache
    ext_job_cache
    minion_data_cache
    enforce_mine_cache
    sock_dir</code></pre></figure>

<h2 id="参考">参考</h2>

<p>相关的文档可以查看 <a href="https://docs.saltstack.com/en/latest/contents.html">docs.saltstack.com</a>，也可以直接下载 PDF 文档，内容比较多，有 2K+ 页。其它的一些常用网址可以参考： <a href="http://www.saltstack.cn/">中文社区(www.saltstack.cn)</a>、<a href="http://www.saltstack.com">官方网址(www.saltstack.com)</a>、<a href="https://pypi.python.org/pypi/salt">Python官方</a> 。</p>


  <hr>
  <nav>
    <ul class="pager">
         <li class="previous"><a href="/post/network-wireless-hack_init.html" title="Linux 无线网络">&larr; Older</a></li> 
         <li class="next"><a href="/post/mysql-gtid.html" title="MySQL GTID 简介">Newer &rarr;</a></li> 
    </ul>
  </nav><br>
<!--
  <hr><div id="section-donate"><span>赏</span></div><br>
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p><br>
  <div class="row" style="text-align:center;" >
    <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
    <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
  </div><br><hr>
-->
  <p style="text-indent:0px;text-align:center;">如果喜欢这里的文章，而且又不差钱的话，欢迎打赏个早餐 ^_^</p>
  <div id="donate_module">
    <style type="text/css">
      .donate_bar a.btn_donate{
        display: inline-block;
        position:      relative;
        text-align:    center;
        width: 82px;
        height: 82px;
        background: url("/images/misc/btn_reward.gif") no-repeat;
        _background: url("/images/misc/btn_reward.gif") no-repeat;
        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
      }
      .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
      .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
      }
    </style>
    <div id="donate_board" class="donate_bar row" style="text-align:center;" >
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
    </div>
    <div id="donate_guide" class="donate_bar center hidden">
      <div class="row" style="text-align:center;" >
        <div class="col-md-6"><img src="/images/system/barcode-pay-alipay.jpg" style="width:150px;height:150px;" title="支付宝捐赠" /><br>支付宝打赏</div>
        <div class="col-md-6"><img src="/images/system/barcode-pay-wechat.jpg" style="width:150px;height:150px;" title="微信捐赠" /><br>微信打赏</div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function(){
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
    </script>
  </div>

  <hr>

  <div id="gitmentContainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
      id: '1451664000',
      owner: 'Jin-Yang',
      repo: 'jin-yang.github.com',
      oauth: {
          client_id: '6d89d48ce689192bf95d',
          client_secret: 'c9a720aafb8e3084e3feb46cadee80b03cdc792f',
      },
  });
  gitment.render('gitmentContainer');
  </script>

  <!-- 多说评论框 start -->
  <!--<div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>-->
  <!--
  <div class="ds-thread" data-thread-key="/post/saltstack-introduce.html" data-title="SaltStack 简介" data-url="/post/saltstack-introduce.html"></div>
  -->
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <!--
  <script type="text/javascript">
      var duoshuoQuery = {short_name:"jinyangposts"};
      (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
  </script>
  -->
  <!-- 多说公共JS代码 end -->
</div>

    </div>
    <div class="col-lg-3 visible-lg blog-sidebar">
    <center><a href="/"><img src="/images/system/linux-liberty.png" width="200" /></a></center>
<h2>About This Blog</h2>
<div class="sidebar-module">
<p style="text-indent:0em;margin:0px;padding:0px;">This is a personal weblog ^_^ generated with Jekyll, if you like it or have some questions,
just feel free to contact me :)</p>
</div><!-- end of "node" "about" -->



<h2>Recent Posts</h2>
<div class="list-group">
  
    <a class="list-group-item" href="/post/linux-program-cpu-cache-introduce_init.html">CPU Cache</a>
  
    <a class="list-group-item" href="/post/artificial-intelligence-decision-tree-introduce.html">决策树</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-bcc-tools-introduce.html">BCC 工具使用</a>
  
    <a class="list-group-item" href="/post/linux-ebpf-basic-usage-introduce.html">eBPF 简介</a>
  
    <a class="list-group-item" href="/post/math-monte-carlo-sample-introduce.html">采样算法</a>
  
</div>

<h2>Categories</h2>
<ul class="list-group" style="margin:0px;">
  
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#bash"> bash</a>
    <span class="badge">2</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#database"> database</a>
    <span class="badge">86</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#golang"> golang</a>
    <span class="badge">28</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#linux"> linux</a>
    <span class="badge">301</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#misc"> misc</a>
    <span class="badge">244</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#mysql"> mysql</a>
    <span class="badge">79</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#network"> network</a>
    <span class="badge">49</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#postgresql"> postgresql</a>
    <span class="badge">4</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#program"> program</a>
    <span class="badge">138</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#python"> python</a>
    <span class="badge">25</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#react"> react</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#rtems"> rtems</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#sql"> sql</a>
    <span class="badge">10</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#tools"> tools</a>
    <span class="badge">1</span>
  </li>
  
    <li style="margin-left:0em" class="list-group-item"><a href="/categories.html#webserver"> webserver</a>
    <span class="badge">25</span>
  </li>
  
</ul><!-- end of "node" "categories" -->

<h2>Related Links</h2>
<ul class="list-group" style="margin:0px">
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.rtems.org" title="To RTEMS"><img class="img-thumbnail img-responsive" src="/images/system/rtems.png"  alt="RTEMS"/></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>RTEMS</strong><br>
        <div class="sidebar-description">Real-Time Executive for Multiprocessor System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
       <a href="http://www.gnu.org" title="To GNU">
       <img class="img-thumbnail img-responsive" src="/images/system/gnu.jpg" alt="GNU" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>GNU</strong><br>
        <div class="sidebar-description">A Unix-linux Operating System</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://www.kernel.org" title="To Linux Kernel">
    <img class="img-thumbnail img-responsive" src="/images/system/linux.png"  alt="LINUX" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Linux Kernel</strong><br>
        <div class="sidebar-description">Maintained by Linux Kernel Organization</div>
      </div>
    </div>
  </li>
  <li style="margin-left:0em" class="list-group-item">
    <div class="row">
      <div class="col-xs-4">
    <a href="http://arduino.cc" title="To Arduino">
    <img class="img-thumbnail img-responsive" src="/images/system/arduino.png"  alt="ARDUINO" /></a>
      </div>
      <div class="col-xs-8 center-block" style="padding:0px;">
        <strong>Arduino</strong><br>
        <div class="sidebar-description">Open-source Electronic Prototyping Platform</div>
      </div>
    </div>
  </li>
</ul>

<h2>Search</h2>
<div class="sidebar-module">
  <form class="search" method="GET" action="https://www.google.com.hk/search">
    <input type="text" name="q" class="search-query" placeholder=" Search on Google">
    <input type="hidden" name="ie" value="utf-8">
    <input type="submit" name="sa" value="Search" />
  </form><br>
  <input type="text" class="search-field" placeholder=" Search This Site">
  <div class="search-results"></div>
</div>



    </div>
  </div>
<hr><p class="text-center">This Site was built by Jin Yang, generated with Jekyll, and hosted on GitHub Pages<br/> &copy;2013-2019 &ndash; Jin Yang</p><div class="footer-logo"></div>

</div>
</body>
</html>
